<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>迷途</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-07-31T10:35:49.820Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>迷途</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ros2笔记</title>
    <link href="http://example.com/2022/07/28/ros2/"/>
    <id>http://example.com/2022/07/28/ros2/</id>
    <published>2022-07-28T15:43:08.000Z</published>
    <updated>2022-07-31T10:35:49.820Z</updated>
    
    <content type="html"><![CDATA[<div class="story post-story"><h2 id="ros2基础"><a href="#ros2基础" class="headerlink" title="ros2基础"></a>ros2基础</h2><h3 id="ros2节点"><a href="#ros2节点" class="headerlink" title="ros2节点"></a>ros2节点</h3><h3 id="通过节点查看节点信息"><a href="#通过节点查看节点信息" class="headerlink" title="通过节点查看节点信息"></a>通过节点查看节点信息</h3><ol><li><p>运行节点  ros2 run 包名 节点名</p></li><li><p>查看节点列表  ros2 node list</p></li><li><p>查看节点信息  ros2 node info 节点名</p></li><li><p>重映射节点  ros2 run turtlesim turtlesim_node –ros-args –remap __node:&#x3D;my_turtle</p></li></ol><h4 id="功能包"><a href="#功能包" class="headerlink" title="功能包"></a>功能包</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ./src</span><br><span class="line">sudo apt install ros-foxy-包名</span><br></pre></td></tr></table></figure><h4 id="相关指令"><a href="#相关指令" class="headerlink" title="相关指令"></a>相关指令</h4><ol><li>创建功能包ros2 pkg create 包名  –build-type  {cmake,ament_cmake,ament_python}  –dependencies &lt;依赖名字&gt;</li><li>列出可执行文件 ros2 pkg 包名 功能包名</li><li>列出所有的包 ros2 pkg list</li><li>输出包所在路径前缀 ros2 pkg prefix  包名</li></ol><h3 id="colcon"><a href="#colcon" class="headerlink" title="colcon"></a>colcon</h3><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><ol><li>全部编译 source install&#x2F;setup.bash</li><li>编译一个包 colcon build –packages-select 包名</li></ol><p>ros2 pkg create village_li 需间隔两个空 –build-type ament_python –dependencies rclpy </p><p>ros2 pkg list | grep vill 将包含vill的结果输出</p><h3 id="使用c-编写"><a href="#使用c-编写" class="headerlink" title="使用c++编写"></a>使用c++编写</h3><p>创建功能包</p><p>&#x3D;&#x3D;ros2 pkg create village_wang –dependencies rclcpp&#x3D;&#x3D;</p><p>编写代码</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// &quot;&quot;&quot; </span></span><br><span class="line"><span class="comment">//     1. 导入库文件</span></span><br><span class="line"><span class="comment">//     2. 初始化客户端库</span></span><br><span class="line"><span class="comment">//     3. 新建节点</span></span><br><span class="line"><span class="comment">//     4. spin循环节点</span></span><br><span class="line"><span class="comment">//     5. 关闭客户端库</span></span><br><span class="line"><span class="comment">//  &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">    <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;rclcpp::Node&gt;(<span class="string">&quot;wang2&quot;</span>);</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(node-&gt;<span class="built_in">get_logger</span>(),<span class="string">&quot;大家好，我是单身沟王而&quot;</span>);</span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改cmakelist文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add_executable(wang2_node src/wang2_pop.cpp)</span><br><span class="line">ament_target_dependencies(wang2_node rclcpp)</span><br><span class="line"></span><br><span class="line">install(TARGETS</span><br><span class="line">  wang2_node</span><br><span class="line">  DESTINATION lib/$&#123;PROJECT_NAME&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>编译运行节点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">colcon build</span><br><span class="line">ros2 run village_wang wang2_node</span><br></pre></td></tr></table></figure><h3 id="使用python编写"><a href="#使用python编写" class="headerlink" title="使用python编写"></a>使用python编写</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;&quot;&quot; </span></span><br><span class="line"><span class="comment">#     1. 导入库文件</span></span><br><span class="line"><span class="comment">#     2. 初始化客户端库</span></span><br><span class="line"><span class="comment">#     3. 新建节点</span></span><br><span class="line"><span class="comment">#     4. spin循环节点</span></span><br><span class="line"><span class="comment">#     5. 关闭客户端库</span></span><br><span class="line"><span class="comment">#  &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment"># 入口函数</span></span><br><span class="line">    <span class="comment"># 2. 初始化客户端库</span></span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line">    <span class="comment"># 3. 新建节点</span></span><br><span class="line">    li4_node = WriteNode(<span class="string">&quot;li4&quot;</span>)</span><br><span class="line">    <span class="comment"># li4_node.get_logger().info(&quot;大家好,我是作家li4&quot;)</span></span><br><span class="line">    rclpy.spin(li4_node)</span><br><span class="line">    rclpy.shutdown</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="话题介绍"><a href="#话题介绍" class="headerlink" title="话题介绍"></a>话题介绍</h2><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ol><li>ros2 topic list  返回系统中当前活动的所有主题的列表</li><li>ros2 topic list -t 增加消息类型</li><li>ros2 topic echo &#x2F;chatter 打印实时话题内容</li><li>ros2 topic info  &#x2F;chatter  查看主题信息</li><li>ros2 interface show std_msgs&#x2F;msg&#x2F;String  查看消息类型</li><li>ros2 topic pub &#x2F;chatter std_msgs&#x2F;msg&#x2F;String ‘data: “123”‘  手动发布命令</li></ol><h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import rclpy</span></span><br><span class="line"><span class="comment"># from rclpy.node import Node</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;&quot;&quot; </span></span><br><span class="line"><span class="comment">#     1. 导入库文件</span></span><br><span class="line"><span class="comment">#     2. 初始化客户端库</span></span><br><span class="line"><span class="comment">#     3. 新建节点</span></span><br><span class="line"><span class="comment">#     4. spin循环节点</span></span><br><span class="line"><span class="comment">#     5. 关闭客户端库</span></span><br><span class="line"><span class="comment">#  &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def main(args=None):</span></span><br><span class="line"><span class="comment">#     # 入口函数</span></span><br><span class="line"><span class="comment">#     # 2. 初始化客户端库</span></span><br><span class="line"><span class="comment">#     rclpy.init(args=args)</span></span><br><span class="line"><span class="comment">#     # 3. 新建节点</span></span><br><span class="line"><span class="comment">#     li4_node = Node(&quot;li4&quot;)</span></span><br><span class="line"><span class="comment">#     li4_node.get_logger().info(&quot;大家好,我是作家li4&quot;)</span></span><br><span class="line"><span class="comment">#     rclpy.spin(li4_node)</span></span><br><span class="line"><span class="comment">#     rclpy.shutdown</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String,UInt32</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    导入消息类型</span></span><br><span class="line"><span class="string">    声明并创建发布者</span></span><br><span class="line"><span class="string">    编写发布者逻辑发布数据</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    1. 导入库文件</span></span><br><span class="line"><span class="string">    2. 初始化客户端库</span></span><br><span class="line"><span class="string">    3. 新建节点</span></span><br><span class="line"><span class="string">    4. spin循环节点</span></span><br><span class="line"><span class="string">    5. 关闭客户端库</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WriteNode</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        self.get_logger().info(<span class="string">&quot;大家好，我是作家%s&quot;</span> % name)</span><br><span class="line">        <span class="comment"># 声明并创建发布者</span></span><br><span class="line">        self.pub_novel = self.create_publisher(String,<span class="string">&quot;sexy_girl&quot;</span>,<span class="number">10</span>)</span><br><span class="line">        self.count = <span class="number">0</span></span><br><span class="line">        self.timer_period = <span class="number">5</span></span><br><span class="line">        self.timer = self.create_timer(self.timer_period,self.timer_callback)</span><br><span class="line">        </span><br><span class="line">        self.account = <span class="number">80</span></span><br><span class="line">        self.sub_money = self.create_subscription(UInt32,<span class="string">&quot;sexy_girl_money&quot;</span>,self.recv_money_callback,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">timer_callback</span>(<span class="params">self</span>):</span><br><span class="line">        msg = String()</span><br><span class="line">        msg.data = <span class="string">&quot;年此外%d&quot;</span> % self.count</span><br><span class="line">        self.pub_novel.publish(msg)</span><br><span class="line">        self.get_logger().info(<span class="string">&quot;发布了一个消息%s&quot;</span> % msg.data)</span><br><span class="line">        self.count +=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv_money_callback</span>(<span class="params">self,money</span>):</span><br><span class="line">        self.account += money.data</span><br><span class="line">        self.get_logger().info(<span class="string">&quot;收到%d的稿费，现在账户里有%d的钱&quot;</span> % (money.data,self.account))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment"># 入口函数</span></span><br><span class="line">    <span class="comment"># 2. 初始化客户端库</span></span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line">    <span class="comment"># 3. 新建节点</span></span><br><span class="line">    li4_node = WriteNode(<span class="string">&quot;li4&quot;</span>)</span><br><span class="line">    <span class="comment"># li4_node.get_logger().info(&quot;大家好,我是作家li4&quot;)</span></span><br><span class="line">    rclpy.spin(li4_node)</span><br><span class="line">    rclpy.shutdown</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="c"><a href="#c" class="headerlink" title="c++"></a>c++</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// &quot;&quot;&quot; </span></span><br><span class="line"><span class="comment">//     1. 导入库文件</span></span><br><span class="line"><span class="comment">//     2. 初始化客户端库</span></span><br><span class="line"><span class="comment">//     3. 新建节点</span></span><br><span class="line"><span class="comment">//     4. spin循环节点</span></span><br><span class="line"><span class="comment">//     5. 关闭客户端库</span></span><br><span class="line"><span class="comment">//  &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="comment">// // 导入消息类型</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/msg/string.hpp&quot;</span></span></span><br><span class="line"><span class="comment">// 导入发布者的消息接口类型</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/msg/u_int32.hpp&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1;</span><br><span class="line"><span class="keyword">using</span> std::placeholders::_2;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleDogNode</span>: <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/* data */</span></span><br><span class="line">    <span class="comment">// /声明订阅者</span></span><br><span class="line">    rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr sub_novel;</span><br><span class="line">    <span class="comment">// 声明话题发布者</span></span><br><span class="line">    rclcpp::Publisher&lt;std_msgs::msg::UInt32&gt;::SharedPtr pub_money;</span><br><span class="line">    <span class="comment">// 创建回调函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">novel_callback</span><span class="params">(<span class="type">const</span> std_msgs::msg::String::SharedPtr novels)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 编写发布逻辑发布数据</span></span><br><span class="line">        std_msgs::msg::UInt32 money;</span><br><span class="line">        money.data = <span class="number">10</span>;</span><br><span class="line">        pub_money-&gt;<span class="built_in">publish</span>(money);</span><br><span class="line">        <span class="comment">//编写回调处理逻辑</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">&quot;已阅%s&quot;</span>,novels-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SingleDogNode</span>(std::string name):<span class="built_in">Node</span>(name) &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">&quot;大家好，我是单身沟%s&quot;</span>,name.<span class="built_in">c_str</span>());</span><br><span class="line">        <span class="comment">//3.创建订阅者</span></span><br><span class="line">        sub_novel = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::String&gt;(<span class="string">&quot;sexy_girl&quot;</span>,<span class="number">10</span>,std::<span class="built_in">bind</span>(&amp;SingleDogNode::novel_callback,<span class="keyword">this</span>,_1));</span><br><span class="line">        <span class="comment">// 创建话题发布者</span></span><br><span class="line">        pub_money = <span class="keyword">this</span>-&gt;<span class="built_in">create_publisher</span>&lt;std_msgs::msg::UInt32&gt;(<span class="string">&quot;sexy_girl_money&quot;</span>,<span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">    <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;SingleDogNode&gt;(<span class="string">&quot;wang2&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="自定义通信接口"><a href="#自定义通信接口" class="headerlink" title="自定义通信接口"></a>自定义通信接口</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><ol><li>创建功能包</li></ol><p>&#x3D;&#x3D;ros2 pkg create village_interfaces&#x3D;&#x3D;</p><ol start="2"><li>创建msg文件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 调用原始数据类型</span><br><span class="line">string content</span><br><span class="line"># 调用已有数据类型</span><br><span class="line">sensor_msgs/Image image</span><br></pre></td></tr></table></figure><ol start="3"><li><p>修改cmakelist文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rosidl_generate_interfaces($&#123;PROJECT_NAME&#125;</span><br><span class="line">  &quot;msg/Novel.msg&quot;</span><br><span class="line">  DEPENDENCIES sensor_msgs</span><br><span class="line">)</span><br><span class="line">find_package(sensor_msgs REQUIRED)</span><br><span class="line">find_package(rosidl_default_generators REQUIRED)</span><br></pre></td></tr></table></figure></li><li><p>修改xml文件</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;buildtool_depend&gt;ament_cmake&lt;/buildtool_depend&gt;</span><br><span class="line"></span><br><span class="line">&lt;depend&gt;rosidl_default_generators&lt;/depend&gt;</span><br><span class="line">&lt;depend&gt;geometry_msgs&lt;/depend&gt;</span><br><span class="line"></span><br><span class="line">&lt;member_of_group&gt;rosidl_interface_packages&lt;/member_of_group&gt; #添加这一行</span><br><span class="line"></span><br><span class="line">&lt;test_depend&gt;ament_lint_auto&lt;/test_depend&gt;</span><br><span class="line">&lt;test_depend&gt;ament_lint_common&lt;/test_depend&gt;</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><ol><li>souce </li><li>ros2 interface package village_interfaces</li></ol></div><div class="story post-story"><h2 id="服务介绍"><a href="#服务介绍" class="headerlink" title="服务介绍"></a>服务介绍</h2><h3 id="启动服务："><a href="#启动服务：" class="headerlink" title="启动服务："></a>启动服务：</h3><ol><li>调用服务列表ros2 service list</li><li>手动调用服务ros2 service call &#x2F;add_two_ints example_interfaces&#x2F;srv&#x2F;AddTwoInts “{a: 1,b: 1}”</li><li>查看服务类型 ros2 service type &#x2F;add_two_ints</li><li>查找使用某接口的服务 ros2 service find example_interfaces&#x2F;srv&#x2F;AddTwoInts</li></ol><h3 id="python-1"><a href="#python-1" class="headerlink" title="python"></a>python</h3><h4 id="编写srv文件配置cmakelist"><a href="#编写srv文件配置cmakelist" class="headerlink" title="编写srv文件配置cmakelist"></a>编写srv文件配置cmakelist</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># request </span><br><span class="line">string name</span><br><span class="line">uint32 money</span><br><span class="line">---</span><br><span class="line"># response</span><br><span class="line">bool success</span><br><span class="line">uint32 money</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uint32 money</span><br><span class="line">---</span><br><span class="line">string[] novels</span><br></pre></td></tr></table></figure><h4 id="python服务端实现"><a href="#python服务端实现" class="headerlink" title="python服务端实现"></a>python服务端实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import rclpy</span></span><br><span class="line"><span class="comment"># from rclpy.node import Node</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;&quot;&quot; </span></span><br><span class="line"><span class="comment">#     1. 导入库文件</span></span><br><span class="line"><span class="comment">#     2. 初始化客户端库</span></span><br><span class="line"><span class="comment">#     3. 新建节点</span></span><br><span class="line"><span class="comment">#     4. spin循环节点</span></span><br><span class="line"><span class="comment">#     5. 关闭客户端库</span></span><br><span class="line"><span class="comment">#  &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def main(args=None):</span></span><br><span class="line"><span class="comment">#     # 入口函数</span></span><br><span class="line"><span class="comment">#     # 2. 初始化客户端库</span></span><br><span class="line"><span class="comment">#     rclpy.init(args=args)</span></span><br><span class="line"><span class="comment">#     # 3. 新建节点</span></span><br><span class="line"><span class="comment">#     li4_node = Node(&quot;li4&quot;)</span></span><br><span class="line"><span class="comment">#     li4_node.get_logger().info(&quot;大家好,我是作家li4&quot;)</span></span><br><span class="line"><span class="comment">#     rclpy.spin(li4_node)</span></span><br><span class="line"><span class="comment">#     rclpy.shutdown</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String,UInt32</span><br><span class="line"><span class="keyword">from</span> village_interfaces.srv <span class="keyword">import</span> BorrowMoney</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    导入消息类型</span></span><br><span class="line"><span class="string">    声明并创建发布者</span></span><br><span class="line"><span class="string">    编写发布者逻辑发布数据</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    1. 导入库文件</span></span><br><span class="line"><span class="string">    2. 初始化客户端库</span></span><br><span class="line"><span class="string">    3. 新建节点</span></span><br><span class="line"><span class="string">    4. spin循环节点</span></span><br><span class="line"><span class="string">    5. 关闭客户端库</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    导入服务接口</span></span><br><span class="line"><span class="string">    创建服务器回调函数</span></span><br><span class="line"><span class="string">    声明并创建服务类</span></span><br><span class="line"><span class="string">    编写回调函数逻辑处理请求</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WriteNode</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        self.get_logger().info(<span class="string">&quot;大家好，我是作家%s&quot;</span> % name)</span><br><span class="line">        <span class="comment"># 声明并创建发布者</span></span><br><span class="line">        self.pub_novel = self.create_publisher(String,<span class="string">&quot;sexy_girl&quot;</span>,<span class="number">10</span>)</span><br><span class="line">        self.count = <span class="number">0</span></span><br><span class="line">        self.timer_period = <span class="number">5</span></span><br><span class="line">        self.timer = self.create_timer(self.timer_period,self.timer_callback)</span><br><span class="line">        </span><br><span class="line">        self.account = <span class="number">80</span></span><br><span class="line">        self.sub_money = self.create_subscription(UInt32,<span class="string">&quot;sexy_girl_money&quot;</span>,self.recv_money_callback,<span class="number">10</span>)</span><br><span class="line">        <span class="comment"># 声明并创建服务类</span></span><br><span class="line">        self.borrow_server = self.create_service(BorrowMoney,<span class="string">&quot;borrow_money&quot;</span>,self.borrow_money_callback)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建服务器回调函数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">borrow_money_callback</span>(<span class="params">self,request,response</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">            request 来自客户端的请求数据</span></span><br><span class="line"><span class="string">            response 服务端的响应数据</span></span><br><span class="line"><span class="string">            编写回调函数逻辑处理请求</span></span><br><span class="line"><span class="string">         &quot;&quot;&quot;</span></span><br><span class="line">        self.get_logger().info(<span class="string">&quot;收到来自：%s的借钱请求，账户目前有：%d&quot;</span> % (request.name,self.account))</span><br><span class="line">        <span class="keyword">if</span> request.money &lt;= self.account*<span class="number">0.1</span>:</span><br><span class="line">            response.success = <span class="literal">True</span></span><br><span class="line">            response.money = request.money</span><br><span class="line">            self.account = self.account - request.money</span><br><span class="line">            self.get_logger().info(<span class="string">&quot;借钱成功，借出%d,目前还剩%d&quot;</span> % (response.money,self.account))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            response.success = <span class="literal">False</span></span><br><span class="line">            response.money = <span class="number">0</span></span><br><span class="line">            self.get_logger().info(<span class="string">&quot;对不起，大兄弟，现在手头紧，不能借给你！&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">timer_callback</span>(<span class="params">self</span>):</span><br><span class="line">        msg = String()</span><br><span class="line">        msg.data = <span class="string">&quot;年此外%d&quot;</span> % self.count</span><br><span class="line">        self.pub_novel.publish(msg)</span><br><span class="line">        self.get_logger().info(<span class="string">&quot;发布了一个消息%s&quot;</span> % msg.data)</span><br><span class="line">        self.count +=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv_money_callback</span>(<span class="params">self,money</span>):</span><br><span class="line">        self.account += money.data</span><br><span class="line">        self.get_logger().info(<span class="string">&quot;收到%d的稿费，现在账户里有%d的钱&quot;</span> % (money.data,self.account))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment"># 入口函数</span></span><br><span class="line">    <span class="comment"># 2. 初始化客户端库</span></span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line">    <span class="comment"># 3. 新建节点</span></span><br><span class="line">    li4_node = WriteNode(<span class="string">&quot;li4&quot;</span>)</span><br><span class="line">    <span class="comment"># li4_node.get_logger().info(&quot;大家好,我是作家li4&quot;)</span></span><br><span class="line">    rclpy.spin(li4_node)</span><br><span class="line">    rclpy.shutdown</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;ros2基础&quot;&gt;&lt;a href=&quot;#ros2基础&quot; class=&quot;headerlink&quot; title=&quot;ros2基础&quot;&gt;&lt;/a&gt;ros2基础&lt;/h2&gt;&lt;h3 id=&quot;ros2节点&quot;&gt;&lt;a href=&quot;#r</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ros笔记</title>
    <link href="http://example.com/2022/07/28/ros/"/>
    <id>http://example.com/2022/07/28/ros/</id>
    <published>2022-07-28T15:43:08.000Z</published>
    <updated>2022-07-29T14:51:15.754Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ros概述与环境搭建"><a href="#ros概述与环境搭建" class="headerlink" title="ros概述与环境搭建"></a>ros概述与环境搭建</h1><div class="story post-story"><h2 id="hello-world实现"><a href="#hello-world实现" class="headerlink" title="hello world实现"></a>hello world实现</h2><h3 id="c"><a href="#c" class="headerlink" title="c++"></a>c++</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//执行 ros 节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="comment">//创建 ros 节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    <span class="comment">//控制台输出 hello world</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行时先执行catkin_make,在执行roscore,然后cd 工作空间，source .&#x2F;devel&#x2F;setup.bash，rosrun 包名 C++节点</p><h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env python</span><br><span class="line"></span><br><span class="line">import rospy</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    rospy.init_node(&quot;Hello&quot;)</span><br><span class="line">    rospy.loginfo(&quot;Hello World&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1.chmod +x 自定义文件名.py<br>2.cd 自定义空间名称<br>3.catkin_makeroscore<br>4.cd 工作空间<br>5.source .&#x2F;devel&#x2F;setup.bash<br>6.rosrun 包名 C++节点</p></div><div class="story post-story"><h2 id="launch文件"><a href="#launch文件" class="headerlink" title="launch文件"></a>launch文件</h2><p>&#x3D;&#x3D;可以一次启动多个节点&#x3D;&#x3D;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node pkg=&quot;helloworld&quot; type=&quot;demo_hello&quot; name=&quot;hello&quot; output=&quot;screen&quot; /&gt;</span><br><span class="line">    &lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;t1&quot;/&gt;</span><br><span class="line">    &lt;node pkg=&quot;turtlesim&quot; type=&quot;turtle_teleop_key&quot; name=&quot;key1&quot; /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1.运行时先source<br>2.再roslaunch 包名 文件名</p></div><div class="story post-story"><h2 id="命令行常用快捷键"><a href="#命令行常用快捷键" class="headerlink" title="命令行常用快捷键"></a>命令行常用快捷键</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Alt+Up                          //移动到上面的终端</span><br><span class="line">Alt+Down                        //移动到下面的终端</span><br><span class="line">Alt+Left                        //移动到左边的终端</span><br><span class="line">Alt+Right                       //移动到右边的终端</span><br><span class="line">Ctrl+Shift+O                    //水平分割终端</span><br><span class="line">Ctrl+Shift+E                    //垂直分割终端</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="ros特有命令"><a href="#ros特有命令" class="headerlink" title="ros特有命令"></a>ros特有命令</h2><p>1.增<br>catkin_create_pkg 自定义包名 依赖包 &#x2F;&#x2F; 创建新的ROS功能包<br>sudo apt install xxx  &#x2F;&#x2F;安装 ROS功能包<br>2.删<br>sudo apt purge xxx &#x2F;&#x2F; 删除某个功能包<br>3.查<br>rospack list  &#x2F;&#x2F;列出所有功能包</p><p>rospack find 包名 &#x2F;&#x2F; 查找某个功能包是否存在，如果存在返回安装路径</p><p>roscd 包名 &#x2F;&#x2F;进入某个功能包</p><p>rosls 包名 &#x2F;&#x2F; 列出某个包下的文件</p><p>apt search xxx &#x2F;&#x2F;搜索某个功能包</p><p>4.改<br>rosed 包名 文件名 &#x2F;&#x2F; 修改功能包文件</p></div><div class="story post-story"><h2 id="文件夹配置"><a href="#文件夹配置" class="headerlink" title="文件夹配置"></a>文件夹配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p 文件名</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure><h1 id="ros通信机制"><a href="#ros通信机制" class="headerlink" title="ros通信机制"></a>ros通信机制</h1></div><div class="story post-story"><h2 id="话题通信"><a href="#话题通信" class="headerlink" title="话题通信"></a>话题通信</h2><h3 id="理论模型"><a href="#理论模型" class="headerlink" title="理论模型"></a>理论模型</h3><p>以发布订阅的方式实现不同节点之间数据交互的通信模式，话题通信适用于不断更新的数据传输的场景</p><p><img src="C:\Users\朱文程\Pictures\ros\1.jpg" class="lazyload" data-srcset="C:\Users\朱文程\Pictures\ros\1.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="话题通信理论模型"></p><h3 id="c-实现"><a href="#c-实现" class="headerlink" title="c++实现"></a>c++实现</h3><h4 id="发布方"><a href="#发布方" class="headerlink" title="发布方"></a>发布方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">include &quot;ros/ros.h&quot;</span><br><span class="line">#include &quot;std_msgs/String.h&quot;</span><br><span class="line"></span><br><span class="line">// /*</span><br><span class="line">//     发布方实现:</span><br><span class="line">//         1.包含头文件</span><br><span class="line">//         2.初始化ros节点</span><br><span class="line">//         3.创建节点句柄</span><br><span class="line">//         4.创建发布者对象</span><br><span class="line">//         5.编辑发布者逻辑及发布数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// */</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    /* code */</span><br><span class="line">    //初始化节点</span><br><span class="line">    ros::init(argc,argv,&quot;erGouZi&quot;);</span><br><span class="line">    //创建节点句柄</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    //创建发布者对象</span><br><span class="line">    ros::Publisher pub = nh.advertise&lt;std_msgs::String&gt;(&quot;fang&quot;,10);</span><br><span class="line">    //创建被发布的消息</span><br><span class="line">    std_msgs::String msg;</span><br><span class="line">    //编写循环</span><br><span class="line">    while(ros::ok())</span><br><span class="line">    &#123;</span><br><span class="line">        msg.data = &quot;hello&quot;;</span><br><span class="line">        pub.publish(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;rostopic echo 话题名称    可以打印出当前发布者发布的数据&#x3D;&#x3D;</p><p>rqt_graph启动计算图</p><p>代码写完需要配置txt文件</p><h4 id="订阅方"><a href="#订阅方" class="headerlink" title="订阅方"></a>订阅方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ros/ros.h&quot;</span><br><span class="line">#include &quot;std_msgs/String.h&quot;</span><br><span class="line"></span><br><span class="line">// /*</span><br><span class="line">//     订阅方实现:</span><br><span class="line">//         1.包含头文件</span><br><span class="line">//         2.初始化ros节点</span><br><span class="line">//         3.创建节点句柄</span><br><span class="line">//         4.创建订阅者对象</span><br><span class="line">//         5.处理订阅者逻辑及数据</span><br><span class="line">//spin函数</span><br><span class="line">void doMsg(const std_msgs::String::ConstPtr &amp;msg)&#123;</span><br><span class="line">    //通过msg获取并操作订阅的数据</span><br><span class="line">    ROS_INFO(&quot;翠花订阅数据:%s&quot;,msg-&gt;data.c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    /* code */</span><br><span class="line">    ros::init(argc,argv,&quot;cuihua&quot;);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.subscribe(&quot;fang&quot;,10,doMsg);</span><br><span class="line">    ros::spin();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="配置txt文件"><a href="#配置txt文件" class="headerlink" title="配置txt文件"></a>配置txt文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h4 id="执行方式"><a href="#执行方式" class="headerlink" title="执行方式"></a>执行方式</h4><ol><li>启动roscore</li><li>使用source编译</li><li>启动发布节点 rosrun 包名 文件名</li><li>启动订阅节点 rosrun 包名 文件名</li></ol><h3 id="python实现"><a href="#python实现" class="headerlink" title="python实现"></a>python实现</h3><h4 id="发布方-1"><a href="#发布方-1" class="headerlink" title="发布方"></a>发布方</h4><p>创建scripts文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env python</span><br><span class="line"></span><br><span class="line">from itertools import count</span><br><span class="line">import rospy</span><br><span class="line">from std_msgs.msg import String#发布的消息的类型</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">    使用python实现消息发布</span><br><span class="line">    1.导包</span><br><span class="line">    2.初始化ros节点</span><br><span class="line">    3.创建发布者对象</span><br><span class="line">    4.编写发布逻辑并发布数据</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">    rospy.init_node(&quot;sanDai&quot;) #传入节点名称</span><br><span class="line">    pub = rospy.Publisher(&quot;che&quot;,String,queue_size=10)</span><br><span class="line">    msg=String()</span><br><span class="line">    #制定发布频率</span><br><span class="line">    rate = rospy.Rate(1)</span><br><span class="line">    #设置技计数器</span><br><span class="line">    count = 0</span><br><span class="line">    rospy.sleep(3)</span><br><span class="line">    while not rospy.is_shutdown():</span><br><span class="line">        count+=1</span><br><span class="line">        msg.data = &quot;hello&quot; + str(count)</span><br><span class="line">        pub.publish(msg)</span><br><span class="line">        rospy.loginfo(&quot;发布的数据:%s&quot;,msg.data)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure><h4 id="订阅方-1"><a href="#订阅方-1" class="headerlink" title="订阅方"></a>订阅方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env python</span><br><span class="line">import rospy</span><br><span class="line">from std_msgs.msg import String</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">    订阅实现流程</span><br><span class="line">       1.导包</span><br><span class="line">       2. 初始化ros节点</span><br><span class="line">       3.创建订阅者对象</span><br><span class="line">       4.回调函数处理数据</span><br><span class="line">       5.spin()</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def doMsg(msg):</span><br><span class="line">    rospy.loginfo(&quot;我订阅的数据:%s&quot;, msg.data)</span><br><span class="line"></span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line"></span><br><span class="line">    rospy.init_node(&quot;huaHua&quot;)</span><br><span class="line">    sub=rospy.Subscriber(&quot;che&quot;,String,doMsg,queue_size=10)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h4 id="执行方式-1"><a href="#执行方式-1" class="headerlink" title="执行方式"></a>执行方式</h4><ol><li>添加可执行文件chmod +x *.py</li><li>启动roscore</li><li>使用source编译</li><li>启动发布节点 rosrun 包名 文件名</li><li>启动订阅节点 rosrun 包名 文件名</li></ol><p>&#x3D;&#x3D;c++与python可实现跨代码运行&#x3D;&#x3D;</p><h3 id="自定义msg-C"><a href="#自定义msg-C" class="headerlink" title="自定义msg(C++)"></a>自定义msg(C++)</h3><h4 id="发布方-2"><a href="#发布方-2" class="headerlink" title="发布方"></a>发布方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ros/ros.h&quot;</span><br><span class="line">#include &quot;plumbing_pub_sub/Person.h&quot;</span><br><span class="line">/* </span><br><span class="line">    发布方:发布人的消息</span><br><span class="line">        1.包含头文件</span><br><span class="line">        2.初始化ros节点</span><br><span class="line">        3.创建ros节点句柄</span><br><span class="line">        4.创建发布者对象</span><br><span class="line">        5.编写发布逻辑发布数据</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    setlocale(LC_ALL, &quot;&quot;);</span><br><span class="line">    ROS_INFO(&quot;消息的发布方&quot;);</span><br><span class="line">    ros::init(argc, argv, &quot;banZhuRen&quot;);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Publisher pub = nh.advertise&lt;plumbing_pub_sub::Person&gt;(&quot;liaotian&quot;,10);</span><br><span class="line">    plumbing_pub_sub::Person person;</span><br><span class="line">    person.name = &quot;张三&quot;;</span><br><span class="line">    person.age = 1;</span><br><span class="line">    person.height = 1.73;</span><br><span class="line">    ros::Rate rate(1);</span><br><span class="line">    while (ros::ok()) </span><br><span class="line">    &#123;</span><br><span class="line">        //修改被发布数据</span><br><span class="line">        person.age += 1;</span><br><span class="line">        //核心:数据发布</span><br><span class="line">        pub.publish(person);</span><br><span class="line">        ROS_INFO(&quot;发布的消息:%s,%d,%.2f&quot;,person.name.c_str(),person.age,person.height);</span><br><span class="line">        rate.sleep();</span><br><span class="line">        ros::spinOnce();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="文件配置"><a href="#文件配置" class="headerlink" title="文件配置"></a>文件配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ind_package(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Person.msg</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">catkin_package(</span><br><span class="line">#  INCLUDE_DIRS include</span><br><span class="line">#  LIBRARIES plumbing_pub_sub</span><br><span class="line"> CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line">#  DEPENDS system_lib</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">add_executable(demo03_pub_person src/demo03_pub_person.cpp)</span><br><span class="line"></span><br><span class="line">add_dependencies(demo03_pub_person $&#123;PROJECT_NAME&#125;_generate_messages_cpp)</span><br><span class="line"></span><br><span class="line">target_link_libraries(demo03_pub_person</span><br><span class="line">  $&#123;catkin_LIBRARIES&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>可以使用&#x3D;&#x3D;rostopic echo +话题名称&#x3D;&#x3D;验证发布的消息</p><h4 id="订阅方-2"><a href="#订阅方-2" class="headerlink" title="订阅方"></a>订阅方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ros/ros.h&quot;</span><br><span class="line">#include &quot;plumbing_pub_sub/Person.h&quot;</span><br><span class="line"></span><br><span class="line">/* </span><br><span class="line">    订阅方:订阅人的消息</span><br><span class="line">        1.包含头文件</span><br><span class="line">        2.初始化ros节点</span><br><span class="line">        3.创建ros节点句柄</span><br><span class="line">        4.创建订阅者对象</span><br><span class="line">        5.处理订阅数据</span><br><span class="line">        6.spin()</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">void doPerson(const plumbing_pub_sub::Person::ConstPtr&amp; person) </span><br><span class="line">&#123;</span><br><span class="line">    ROS_INFO(&quot;订阅人的信息%s,%d,%.2f&quot;,person-&gt;name.c_str(),person-&gt;age,person-&gt;height);</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    setlocale(LC_ALL, &quot;&quot;);</span><br><span class="line">    ROS_INFO(&quot;订阅方实现&quot;);</span><br><span class="line">    ros::init(argc,argv,&quot;jiazhang&quot;);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.subscribe(&quot;liaotian&quot;,10,doPerson);</span><br><span class="line">    ros::spin();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="文件配置-1"><a href="#文件配置-1" class="headerlink" title="文件配置"></a>文件配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add_executable(demo04_sub_person src/demo04_sub_person.cpp)</span><br><span class="line"></span><br><span class="line">add_dependencies(demo04_sub_person $&#123;PROJECT_NAME&#125;_generate_messages_cpp)</span><br><span class="line"></span><br><span class="line">target_link_libraries(demo04_sub_person</span><br><span class="line">  $&#123;catkin_LIBRARIES&#125;</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="自定义msg-python"><a href="#自定义msg-python" class="headerlink" title="自定义msg(python)"></a>自定义msg(python)</h3><h4 id="发布方-3"><a href="#发布方-3" class="headerlink" title="发布方"></a>发布方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/evn python</span><br><span class="line"></span><br><span class="line">import rospy</span><br><span class="line">from plumbing_pub_sub.msg import Person</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">    发布方：</span><br><span class="line">        1.导包：</span><br><span class="line">        2.初始化节点</span><br><span class="line">        3.创建发布者对象</span><br><span class="line">        4.组织发布者逻辑发布数据    </span><br><span class="line">    </span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">    rospy.init_node(&quot;daMa&quot;)</span><br><span class="line">    pub = rospy.Publisher(&quot;jiaoSheTou&quot;,Person,queue_size=10)</span><br><span class="line">    #创建person数据</span><br><span class="line">    p = Person()</span><br><span class="line">    p.name = &quot;奥特曼&quot;</span><br><span class="line">    p.age = 8</span><br><span class="line">    p.height = 1.85</span><br><span class="line">    #创建rate对象</span><br><span class="line">    rate = rospy.Rate(1)</span><br><span class="line">    #循环发布数据</span><br><span class="line">    while not rospy.is_shutdown():</span><br><span class="line">        pub.publish(p)</span><br><span class="line">        rospy.loginfo(&quot;发布的消息：%s,%d,%.2f&quot;,p.name,p.age,p.height)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure><p>可以使用&#x3D;&#x3D;rostopic echo +话题名称&#x3D;&#x3D;验证发布的消息</p><h4 id="订阅方-3"><a href="#订阅方-3" class="headerlink" title="订阅方"></a>订阅方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env/python</span><br><span class="line"></span><br><span class="line">import rospy</span><br><span class="line">from plumbing_pub_sub.msg import Person</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">    发布方：</span><br><span class="line">        1.导包：</span><br><span class="line">        2.初始化节点</span><br><span class="line">        3.创建订阅者对象</span><br><span class="line">        4.处理订阅的的数据</span><br><span class="line">        5.spin()   </span><br><span class="line">    </span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">def doPerson(person):</span><br><span class="line">    rospy.loginfo(&quot;小伙子的数据：%s,%d,%.2f&quot;,person.name,person.age,person.height)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    rospy.init_node(&quot;daYe&quot;)</span><br><span class="line">    sub = rospy.Subscriber(&quot;jiaoSheTou&quot;,Person,doPerson)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure><h4 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">catkin_install_python(PROGRAMS</span><br><span class="line">  scripts/demo03_pub_person_p.py</span><br><span class="line">  DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;</span><br><span class="line">)</span><br><span class="line">catkin_install_python(PROGRAMS</span><br><span class="line">  scripts/demo04_sub_person_p.py</span><br><span class="line">  DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="服务通信"><a href="#服务通信" class="headerlink" title="服务通信"></a>服务通信</h2><h3 id="理论模型-1"><a href="#理论模型-1" class="headerlink" title="理论模型"></a>理论模型</h3><p>以请求响应的方式实现不同节点之间数据交互的通信模式，服务通信更适用于对实时性有要求、具有一定逻辑处理的应用场景</p><p><img src="C:\Users\朱文程\Pictures\ros\2.jpg" class="lazyload" data-srcset="C:\Users\朱文程\Pictures\ros\2.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="服务通信理论模型"></p><h3 id="c-实现-1"><a href="#c-实现-1" class="headerlink" title="c++实现"></a>c++实现</h3><h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ros/ros.h&quot;</span><br><span class="line">#include &quot;plumbing_server_client/AddInts.h&quot;</span><br><span class="line">/* </span><br><span class="line">    服务端实现：解析客户端提交的数据并运算在产生响应</span><br><span class="line">        1.包含头文件</span><br><span class="line">        2.初始化节点</span><br><span class="line">        3.创建节点句柄</span><br><span class="line">        4.创建一个服务对象</span><br><span class="line">        5.处理请求并产生响应</span><br><span class="line">        6.spin()</span><br><span class="line"> */</span><br><span class="line">bool doNums(plumbing_server_client::AddInts::Request &amp;request,</span><br><span class="line">            plumbing_server_client::AddInts::Response &amp;response) &#123;</span><br><span class="line">    //1.处理请求</span><br><span class="line">    int num1 = request.num1;</span><br><span class="line">    int num2 = request.num2;</span><br><span class="line">    ROS_INFO(&quot;收到的请求数据：num1=%d,num2=%d&quot;, num1, num2);</span><br><span class="line">    //2.组织响应</span><br><span class="line">    int sum = num1 + num2;</span><br><span class="line">    response.sum = sum;</span><br><span class="line">    ROS_INFO(&quot;求得的结果sum=%d&quot;,sum);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    setlocale(LC_ALL, &quot;&quot;);</span><br><span class="line">    ros::init(argc,argv,&quot;heiShui&quot;);//节点名称需要保证唯一</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::ServiceServer server = nh.advertiseService(&quot;addInts&quot;,doNums);</span><br><span class="line">    ROS_INFO(&quot;服务器端启动&quot;);</span><br><span class="line">    ros::spin();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;rosservice call 话题名称 tab健&#x3D;&#x3D;</p><h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ros/ros.h&quot;</span><br><span class="line">#include &quot;plumbing_server_client/AddInts.h&quot;</span><br><span class="line">/*  </span><br><span class="line">    客户端：提交二个整数，并处理响应的结果</span><br><span class="line">        1.包含头文件</span><br><span class="line">        2.初始化节点</span><br><span class="line">        3.创建节点句柄</span><br><span class="line">        4.创建一个客户端对象</span><br><span class="line">        5.提交请求并处理响应</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    setlocale(LC_ALL, &quot;&quot;);</span><br><span class="line">    ros::init(argc,argv,&quot;daBao&quot;);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::ServiceClient client= nh.serviceClient&lt;plumbing_server_client::AddInts&gt;(&quot;addInts&quot;);</span><br><span class="line">    plumbing_server_client::AddInts ai;</span><br><span class="line">    ai.request.num1 = 100;</span><br><span class="line">    ai.request.num2 = 200;</span><br><span class="line">    //处理响应</span><br><span class="line">    bool flag = client.call(ai);</span><br><span class="line">    if(flag)&#123;</span><br><span class="line">        ROS_INFO(&quot;响应成功&quot;);</span><br><span class="line">        //获取结果</span><br><span class="line">        ROS_INFO(&quot;响应结果=%d&quot;,ai.response.sum);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        ROS_INFO(&quot;处理失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ros/ros.h&quot;</span><br><span class="line">#include &quot;plumbing_server_client/AddInts.h&quot;</span><br><span class="line">/*  </span><br><span class="line">    客户端：提交二个整数，并处理响应的结果</span><br><span class="line">        1.包含头文件</span><br><span class="line">        2.初始化节点</span><br><span class="line">        3.创建节点句柄</span><br><span class="line">        4.创建一个客户端对象</span><br><span class="line">        5.提交请求并处理响应</span><br><span class="line">    //实现参数的动态提交</span><br><span class="line">        1. 格式：rosrun xxxx xxxx 12 34</span><br><span class="line">        2.节点执行时，需要获取命令中的参数，并组织进request</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    //优化实现，获取命令中的参数</span><br><span class="line">    if(argc != 3)&#123;</span><br><span class="line">        ROS_INFO(&quot;提交的参数个数错误&quot;);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setlocale(LC_ALL, &quot;&quot;);</span><br><span class="line">    ros::init(argc,argv,&quot;daBao&quot;);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::ServiceClient client= nh.serviceClient&lt;plumbing_server_client::AddInts&gt;(&quot;addInts&quot;);</span><br><span class="line">    plumbing_server_client::AddInts ai;</span><br><span class="line">    ai.request.num1 = atoi(argv[1]);</span><br><span class="line">    ai.request.num2 = atoi(argv[2]);</span><br><span class="line">    //处理响应</span><br><span class="line">    bool flag = client.call(ai);</span><br><span class="line">    if(flag)&#123;</span><br><span class="line">        ROS_INFO(&quot;响应成功&quot;);</span><br><span class="line">        //获取结果</span><br><span class="line">        ROS_INFO(&quot;响应结果=%d&quot;,ai.response.sum);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        ROS_INFO(&quot;处理失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;如果要先启动客户端在启动服务端？&#x3D;&#x3D;</p><p>ros中内置函数，这些函数可以让客户端启动后挂起，等待服务器启动</p><ol><li>client.waitForExistence();</li><li>ros::service::waitForService(“服务话题”);</li></ol><h3 id="python实现-1"><a href="#python实现-1" class="headerlink" title="python实现"></a>python实现</h3><h4 id="服务端-1"><a href="#服务端-1" class="headerlink" title="服务端"></a>服务端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env python</span><br><span class="line"></span><br><span class="line">from http import server</span><br><span class="line">import rospy</span><br><span class="line">from plumbing_server_client.srv import AddInts,AddIntsRequest,AddIntsResponse</span><br><span class="line">&quot;&quot;&quot; </span><br><span class="line">    服务端：解析服务端请求，产生响应</span><br><span class="line">        1.导包</span><br><span class="line">        2.初始化ros节点</span><br><span class="line">        3.创建服务端对象</span><br><span class="line">        4.处理请求(回调函数)</span><br><span class="line">        5.spin()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &quot;&quot;&quot;</span><br><span class="line"> #参数：封装了请求数据</span><br><span class="line"> #返回值：响应数据</span><br><span class="line">def doNum(request):</span><br><span class="line">    #1.解析提交的两个整数</span><br><span class="line">    num1=request.num1</span><br><span class="line">    num2=request.num2</span><br><span class="line">    #2.求和</span><br><span class="line">    sum=num1+num2</span><br><span class="line">    #3.将结果封装响应</span><br><span class="line">    responce=AddIntsResponse()</span><br><span class="line">    responce.sum=sum</span><br><span class="line">    rospy.loginfo(&quot;服务器解析的数据num1=%d,num2=%d,响应的结果sum=%d&quot;,num1,num2,sum)</span><br><span class="line">    return responce</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    rospy.init_node(&quot;heiShui&quot;)</span><br><span class="line">    server = rospy.Service(&quot;addInts&quot;, AddInts,doNum)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure><h4 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env python</span><br><span class="line"></span><br><span class="line">import rospy</span><br><span class="line">from plumbing_server_client.srv import *</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot; </span><br><span class="line">    客户端：组织并提交请求，处理响应</span><br><span class="line">    1.导包</span><br><span class="line">    2.初始化ros节点</span><br><span class="line">    3.创建客户端对象</span><br><span class="line">    4.组织请求数据并发送请求</span><br><span class="line">    5.处理响应</span><br><span class="line"></span><br><span class="line"> &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    rospy.init_node(&quot;erHei&quot;)</span><br><span class="line">    client=rospy.ServiceProxy(&quot;addInts&quot;,AddInts)</span><br><span class="line">    responce = client.call(12,34)</span><br><span class="line">    rospy.loginfo(&quot;响应的数据：%d&quot;,responce.sum)</span><br></pre></td></tr></table></figure><h4 id="优化-1"><a href="#优化-1" class="headerlink" title="优化"></a>优化</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env python</span><br><span class="line"></span><br><span class="line">import rospy</span><br><span class="line">from plumbing_server_client.srv import *</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot; </span><br><span class="line">    客户端：组织并提交请求，处理响应</span><br><span class="line">    1.导包</span><br><span class="line">    2.初始化ros节点</span><br><span class="line">    3.创建客户端对象</span><br><span class="line">    4.组织请求数据并发送请求</span><br><span class="line">    5.处理响应</span><br><span class="line">    </span><br><span class="line">    优化实现：</span><br><span class="line">        可以在执行节点时，动态传入参数</span><br><span class="line"> &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    #判断参数长度</span><br><span class="line">    if len(sys.argv)!=3:</span><br><span class="line">        rospy.logerr(&quot;传入的参数个数不对&quot;)</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line">    rospy.init_node(&quot;erHei&quot;)</span><br><span class="line">    client=rospy.ServiceProxy(&quot;addInts&quot;,AddInts)</span><br><span class="line">    #解析传入的参数</span><br><span class="line">    num1 = int(sys.argv[1])</span><br><span class="line">    num2 = int(sys.argv[2])</span><br><span class="line"></span><br><span class="line">    responce = client.call(num1,num2)</span><br><span class="line">    rospy.loginfo(&quot;响应的数据：%d&quot;,responce.sum)</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;如果要先启动客户端在启动服务端？&#x3D;&#x3D;</p><p>ros中内置函数，这些函数可以让客户端启动后挂起，等待服务器启动</p><ol><li>client.wait_for_service()</li><li>rospy.wait_for_service(“话题名称”);</li></ol></div><div class="story post-story"><h2 id="参数服务器"><a href="#参数服务器" class="headerlink" title="参数服务器"></a>参数服务器</h2><h3 id="理论模型-2"><a href="#理论模型-2" class="headerlink" title="理论模型"></a>理论模型</h3><p>以共享的方式实现不同节点之间数据交互的通信模式，适用于存在数据共享的一些场景</p><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><h4 id="c-实现-2"><a href="#c-实现-2" class="headerlink" title="c++实现"></a>c++实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    实现参数的新增与修改</span></span><br><span class="line"><span class="comment">    需求：设计机器人的共享参数，类型，半径</span></span><br><span class="line"><span class="comment">        在修改参数</span></span><br><span class="line"><span class="comment">    实现：</span></span><br><span class="line"><span class="comment">        ros::NodeHandle</span></span><br><span class="line"><span class="comment">            setParam(&quot;键&quot;，值)</span></span><br><span class="line"><span class="comment">        ros::param</span></span><br><span class="line"><span class="comment">            set(&quot;键&quot;，值)</span></span><br><span class="line"><span class="comment">    修改只需要继续调用setParam或set函数保证键是已经存在的，那么值会覆盖</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//初始化ros节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;set_param_c&quot;</span>);</span><br><span class="line">    <span class="comment">//创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//参数增</span></span><br><span class="line">    <span class="comment">//方案1：</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;xiaoHuang&quot;</span>);</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;radius&quot;</span>,<span class="number">0.15</span>);</span><br><span class="line">    <span class="comment">//方案2：</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;type_param&quot;</span>,<span class="string">&quot;xiaoBai&quot;</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;radius_param&quot;</span>,<span class="number">0.15</span>);</span><br><span class="line">    <span class="comment">//参数改</span></span><br><span class="line">    <span class="comment">//1</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;radius&quot;</span>,<span class="number">0.2</span>);</span><br><span class="line">    <span class="comment">//2</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;radius_param&quot;</span>,<span class="number">0.25</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python实现-2"><a href="#python实现-2" class="headerlink" title="python实现"></a>python实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    参数的新增与修改</span></span><br><span class="line"><span class="string">    需求：在参数服务器中设置机器人属性，型号，半径</span></span><br><span class="line"><span class="string">    实现：</span></span><br><span class="line"><span class="string">        rospy.set_param()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;param_set_p&quot;</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;type_p&quot;</span>,<span class="string">&quot;xiaoHuangChe&quot;</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;radius_p&quot;</span>,<span class="number">0.15</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;radius_p&quot;</span>,<span class="number">0.2</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h3><h4 id="c-1"><a href="#c-1" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    演示参数查询</span></span><br><span class="line"><span class="comment">    实现：</span></span><br><span class="line"><span class="comment">        ros::NodeHandle--------------------------------</span></span><br><span class="line"><span class="comment">            param(键,默认值) </span></span><br><span class="line"><span class="comment">            存在，返回对应结果，否则返回默认值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            getParam(键,存储结果的变量)</span></span><br><span class="line"><span class="comment">                存在,返回 true,且将值赋值给参数2</span></span><br><span class="line"><span class="comment">                若果键不存在，那么返回值为 false，且不为参数2赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            getParamCached键,存储结果的变量)--提高变量获取效率</span></span><br><span class="line"><span class="comment">                存在,返回 true,且将值赋值给参数2</span></span><br><span class="line"><span class="comment">                若果键不存在，那么返回值为 false，且不为参数2赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            getParamNames(std::vector&lt;std::string&gt;)</span></span><br><span class="line"><span class="comment">                获取所有的键,并存储在参数 vector 中 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            hasParam(键)</span></span><br><span class="line"><span class="comment">                是否包含某个键，存在返回 true，否则返回 false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            searchParam(参数1，参数2)</span></span><br><span class="line"><span class="comment">                搜索键，参数1是被搜索的键，参数2存储搜索结果的变量</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        ros::param ----- 与 NodeHandle 类似</span></span><br><span class="line"><span class="comment">                </span></span><br><span class="line"><span class="comment">            ros::param--------------------------------</span></span><br><span class="line"><span class="comment">            </span></span><br><span class="line"><span class="comment">    修改只需要继续调用setParam或set函数保证键是已经存在的，那么值会覆盖</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//设置编码</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">//初始化ros节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;get_param_c&quot;</span>);</span><br><span class="line">    <span class="comment">//创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ros::NodeHandle---------------------------------------------</span></span><br><span class="line">    <span class="comment">//1.param</span></span><br><span class="line">    <span class="type">double</span> radius = nh.<span class="built_in">param</span>(<span class="string">&quot;radius&quot;</span>,<span class="number">0.5</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;radius: %.2f&quot;</span>,radius);</span><br><span class="line">    <span class="comment">//2.getParam</span></span><br><span class="line">    <span class="comment">//3.getParamCached用法与2类似只是性能会提升</span></span><br><span class="line">    <span class="type">double</span> radius2 = <span class="number">0.0</span>; </span><br><span class="line">    <span class="type">bool</span> result = nh.<span class="built_in">getParamCached</span>(<span class="string">&quot;radius&quot;</span>,radius2);</span><br><span class="line">    <span class="keyword">if</span>(result )&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;获取的半径是：%f&quot;</span>,radius2);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;被查询的变量不存在&quot;</span>);</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;获取的半径是：%f&quot;</span>,radius2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.getParamNames</span></span><br><span class="line">    std::vector&lt;std::string&gt; names;</span><br><span class="line">    nh.<span class="built_in">getParamNames</span>(names);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;&amp;name:names)&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;遍历到的元素：%s&quot;</span>,name.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.hasParam</span></span><br><span class="line">    <span class="type">bool</span> flag1 = nh.<span class="built_in">hasParam</span>(<span class="string">&quot;radius&quot;</span>);</span><br><span class="line">    <span class="type">bool</span> flag2 = nh.<span class="built_in">hasParam</span>(<span class="string">&quot;radiusxxx&quot;</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;radius存在吗?%d&quot;</span>,flag1);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;radiusxxx存在吗?%d&quot;</span>,flag2);</span><br><span class="line">    <span class="comment">//6.searchParam</span></span><br><span class="line">    std::string key;</span><br><span class="line">    nh.<span class="built_in">searchParam</span>(<span class="string">&quot;radius&quot;</span>,key);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;搜索结果%s&quot;</span>,key.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ros::param------------------------------------------------</span></span><br><span class="line">    <span class="type">double</span> radius_param = ros::param::<span class="built_in">param</span>(<span class="string">&quot;radius&quot;</span>,<span class="number">100.5</span>);</span><br><span class="line">    <span class="comment">// ROS_INFO(&quot;radius&quot;,radius_param);</span></span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::string&gt;names_param;</span><br><span class="line">    ros::param::<span class="built_in">getParamNames</span>(names_param);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;name : names_param) &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;键：%s&quot;</span>,name.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-1"><a href="#python-1" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &quot;ros/ros.h&quot;</span></span><br><span class="line">/* </span><br><span class="line">    演示参数查询</span><br><span class="line">    实现：</span><br><span class="line">        ros::NodeHandle--------------------------------</span><br><span class="line">            param(键,默认值) </span><br><span class="line">            存在，返回对应结果，否则返回默认值</span><br><span class="line"></span><br><span class="line">            getParam(键,存储结果的变量)</span><br><span class="line">                存在,返回 true,且将值赋值给参数<span class="number">2</span></span><br><span class="line">                若果键不存在，那么返回值为 false，且不为参数<span class="number">2</span>赋值</span><br><span class="line"></span><br><span class="line">            getParamCached键,存储结果的变量)--提高变量获取效率</span><br><span class="line">                存在,返回 true,且将值赋值给参数<span class="number">2</span></span><br><span class="line">                若果键不存在，那么返回值为 false，且不为参数<span class="number">2</span>赋值</span><br><span class="line"></span><br><span class="line">            getParamNames(std::vector&lt;std::string&gt;)</span><br><span class="line">                获取所有的键,并存储在参数 vector 中 </span><br><span class="line"></span><br><span class="line">            hasParam(键)</span><br><span class="line">                是否包含某个键，存在返回 true，否则返回 false</span><br><span class="line"></span><br><span class="line">            searchParam(参数<span class="number">1</span>，参数<span class="number">2</span>)</span><br><span class="line">                搜索键，参数<span class="number">1</span>是被搜索的键，参数<span class="number">2</span>存储搜索结果的变量</span><br><span class="line"></span><br><span class="line">        ros::param ----- 与 NodeHandle 类似</span><br><span class="line">                </span><br><span class="line">            ros::param--------------------------------</span><br><span class="line">            </span><br><span class="line">    修改只需要继续调用setParam或<span class="built_in">set</span>函数保证键是已经存在的，那么值会覆盖</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    //设置编码</span><br><span class="line">    setlocale(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    //初始化ros节点</span><br><span class="line">    ros::init(argc, argv,<span class="string">&quot;get_param_c&quot;</span>);</span><br><span class="line">    //创建节点句柄</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    // ros::NodeHandle---------------------------------------------</span><br><span class="line">    //<span class="number">1.</span>param</span><br><span class="line">    double radius = nh.param(<span class="string">&quot;radius&quot;</span>,<span class="number">0.5</span>);</span><br><span class="line">    ROS_INFO(<span class="string">&quot;radius: %.2f&quot;</span>,radius);</span><br><span class="line">    //<span class="number">2.</span>getParam</span><br><span class="line">    //<span class="number">3.</span>getParamCached用法与<span class="number">2</span>类似只是性能会提升</span><br><span class="line">    double radius2 = <span class="number">0.0</span>; </span><br><span class="line">    <span class="built_in">bool</span> result = nh.getParamCached(<span class="string">&quot;radius&quot;</span>,radius2);</span><br><span class="line">    <span class="keyword">if</span>(result )&#123;</span><br><span class="line">        ROS_INFO(<span class="string">&quot;获取的半径是：%f&quot;</span>,radius2);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        ROS_INFO(<span class="string">&quot;被查询的变量不存在&quot;</span>);</span><br><span class="line">        ROS_INFO(<span class="string">&quot;获取的半径是：%f&quot;</span>,radius2);</span><br><span class="line">    &#125;</span><br><span class="line">    //<span class="number">4.</span>getParamNames</span><br><span class="line">    std::vector&lt;std::string&gt; names;</span><br><span class="line">    nh.getParamNames(names);</span><br><span class="line">    <span class="keyword">for</span>(auto &amp;&amp;name:names)&#123;</span><br><span class="line">        ROS_INFO(<span class="string">&quot;遍历到的元素：%s&quot;</span>,name.c_str());</span><br><span class="line">    &#125;</span><br><span class="line">    //<span class="number">5.</span>hasParam</span><br><span class="line">    <span class="built_in">bool</span> flag1 = nh.hasParam(<span class="string">&quot;radius&quot;</span>);</span><br><span class="line">    <span class="built_in">bool</span> flag2 = nh.hasParam(<span class="string">&quot;radiusxxx&quot;</span>);</span><br><span class="line">    ROS_INFO(<span class="string">&quot;radius存在吗?%d&quot;</span>,flag1);</span><br><span class="line">    ROS_INFO(<span class="string">&quot;radiusxxx存在吗?%d&quot;</span>,flag2);</span><br><span class="line">    //<span class="number">6.</span>searchParam</span><br><span class="line">    std::string key;</span><br><span class="line">    nh.searchParam(<span class="string">&quot;radius&quot;</span>,key);</span><br><span class="line">    ROS_INFO(<span class="string">&quot;搜索结果%s&quot;</span>,key.c_str());</span><br><span class="line"></span><br><span class="line">    // ros::param------------------------------------------------</span><br><span class="line">    double radius_param = ros::param::param(<span class="string">&quot;radius&quot;</span>,<span class="number">100.5</span>);</span><br><span class="line">    // ROS_INFO(<span class="string">&quot;radius&quot;</span>,radius_param);</span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::string&gt;names_param;</span><br><span class="line">    ros::param::getParamNames(names_param);</span><br><span class="line">    <span class="keyword">for</span> (auto &amp;&amp;name : names_param) &#123;</span><br><span class="line">        ROS_INFO(<span class="string">&quot;键：%s&quot;</span>,name.c_str());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><h4 id="c-2"><a href="#c-2" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    参数的删除：</span></span><br><span class="line"><span class="comment">    实现：</span></span><br><span class="line"><span class="comment">        ros::NodeHandle</span></span><br><span class="line"><span class="comment">            delParam()</span></span><br><span class="line"><span class="comment">        ros::param</span></span><br><span class="line"><span class="comment">            del()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;param_del_c&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//1.</span></span><br><span class="line">    <span class="type">bool</span> flag1 = nh.<span class="built_in">deleteParam</span>(<span class="string">&quot;radius&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (flag1)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;删除成功了&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;删除失败了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ros::param</span></span><br><span class="line">    <span class="type">bool</span> flag2 = ros::param::<span class="built_in">del</span>(<span class="string">&quot;radius_param&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (flag2)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;删除成功了&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;删除失败了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-2"><a href="#python-2" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;del_param_p&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rospy.delete_param(<span class="string">&quot;radius_p&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;被删除的参数不存在&quot;</span>)</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p><a href="http://wiki.ros.org/ROS/CommandLineTools">ros常用命令</a></p><ol><li><p>rosnode</p><ul><li><p>rosnode ping    测试到节点的连接状态</p></li><li><p>rosnode list    列出活动节点</p></li><li><p>rosnode info    打印节点信息</p></li><li><p>rosnode machine    列出指定设备上节点</p></li><li><p>rosnode kill    杀死某个节点</p></li><li><p>rosnode cleanup    清除不可连接的节点</p></li></ul></li><li><p>rostopic</p><ul><li><p>rostopic bw     显示主题使用的带宽</p></li><li><p>rostopic delay  显示带有 header 的主题延迟</p></li><li><p>rostopic echo   打印消息到屏幕</p></li><li><p>rostopic find   根据类型查找主题</p></li><li><p>rostopic hz     显示主题的发布频率</p></li><li><p>rostopic info   显示主题相关信息</p></li><li><p>rostopic list   显示所有活动状态下的主题</p></li><li><p>rostopic pub    将数据发布到主题</p></li><li><p>rostopic type   打印主题类型</p></li></ul></li><li><p>rosmsg</p><ul><li><p>rosmsg show    显示消息描述</p></li><li><p>rosmsg info    显示消息信息</p></li><li><p>rosmsg list    列出所有消息</p></li><li><p>rosmsg md5    显示 md5 加密后的消息</p></li><li><p>rosmsg package    显示某个功能包下的所有消息</p></li><li><p>rosmsg packages    列出包含消息的功能包</p></li></ul></li><li><p>rosservice</p><ul><li><p>rosservice args 打印服务参数</p></li><li><p>rosservice call    使用提供的参数调用服务</p></li><li><p>rosservice find    按照服务类型查找服务</p></li><li><p>rosservice info    打印有关服务的信息</p></li><li><p>rosservice list    列出所有活动的服务</p></li><li><p>rosservice type    打印服务类型</p></li><li><p>rosservice uri    打印服务的 ROSRPC uri</p></li></ul></li><li><p>rossrv</p><ul><li>rossrv show    显示服务消息详情</li><li>rossrv info    显示服务消息相关信息</li><li>rossrv list    列出所有服务信息</li><li>rossrv md5    显示 md5 加密后的服务消息</li><li>rossrv package    显示某个包下所有服务消息</li><li>rossrv packages    显示包含服务消息的所有包</li></ul></li><li><p>rosparam</p><ul><li>rosparam set    设置参数</li><li>rosparam get    获取参数</li></ul></li></ol><ul><li>rosparam load    从外部文件加载参数</li><li>rosparam dump    将参数写出到外部文件</li><li>rosparam delete    删除参数</li><li>rosparam list    列出所有参数</li></ul></div><div class="story post-story"><h2 id="通信机制实操"><a href="#通信机制实操" class="headerlink" title="通信机制实操"></a>通信机制实操</h2><h3 id="实操1"><a href="#实操1" class="headerlink" title="实操1"></a>实操1</h3><h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><p>实现乌龟运动控制</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rostopic list</span><br><span class="line">rqt_graph</span><br><span class="line">rostopic info /turtle1/cmd_vel  (rostopic type /turtle1/cmd_vel)</span><br><span class="line">rosmsg show geometry_msgs/Twist</span><br></pre></td></tr></table></figure><h4 id="c-实现-3"><a href="#c-实现-3" class="headerlink" title="c++实现"></a>c++实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/Twist.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：发布速度消息</span></span><br><span class="line"><span class="comment">        话题：/turtle1/cmd_vel</span></span><br><span class="line"><span class="comment">        消息：geometry_msgs/Twist</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    1.包含头文件</span></span><br><span class="line"><span class="comment">    2.初始化ros节点</span></span><br><span class="line"><span class="comment">    3.创建节点句柄</span></span><br><span class="line"><span class="comment">    4.创建发布对象</span></span><br><span class="line"><span class="comment">    5.发布逻辑实现</span></span><br><span class="line"><span class="comment">    6.spiOnce()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;my_control&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;turtle1/cmd_vel&quot;</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;<span class="comment">//设置发布频率</span></span><br><span class="line">    <span class="comment">//组织消息</span></span><br><span class="line">    geometry_msgs::Twist twist;</span><br><span class="line">    twist.linear.x = <span class="number">1.0</span>;</span><br><span class="line">    twist.linear.y = <span class="number">0.0</span>;</span><br><span class="line">    twist.linear.z = <span class="number">0.0</span>;</span><br><span class="line">    twist.angular.z = <span class="number">1.0</span>;</span><br><span class="line">    twist.angular.y = <span class="number">0.0</span>;</span><br><span class="line">    twist.angular.x = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        pub.<span class="built_in">publish</span>(twist);</span><br><span class="line">        <span class="comment">//休眠</span></span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="python实现-3"><a href="#python实现-3" class="headerlink" title="python实现"></a>python实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Twist</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    发布方：发布速度消息</span></span><br><span class="line"><span class="string">        话题：/turtle1/cmd_vel</span></span><br><span class="line"><span class="string">        消息:geometry_msgs/Twist</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    1.导包</span></span><br><span class="line"><span class="string">    2.初始化ros节点</span></span><br><span class="line"><span class="string">    3.创建发布者对象</span></span><br><span class="line"><span class="string">    4.组织数据并发布数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;my_control_p&quot;</span>)</span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;turtle1/cmd_vel&quot;</span>,Twist,queue_size=<span class="number">10</span>)</span><br><span class="line">    <span class="comment">#设置发布频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    twist = Twist()</span><br><span class="line">    twist.linear.x=<span class="number">0.5</span></span><br><span class="line">    twist.linear.y=<span class="number">0.0</span></span><br><span class="line">    twist.linear.z=<span class="number">0.0</span></span><br><span class="line">    twist.angular.x=<span class="number">0.0</span></span><br><span class="line">    twist.angular.y=<span class="number">0.0</span></span><br><span class="line">    twist.angular.z=<span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        pub.publish(twist)</span><br><span class="line">        rate.sleep()</span><br><span class="line">        </span><br></pre></td></tr></table></figure><h3 id="实操2"><a href="#实操2" class="headerlink" title="实操2"></a>实操2</h3><h4 id="用途-1"><a href="#用途-1" class="headerlink" title="用途"></a>用途</h4><p>打印乌龟当前位姿</p><h4 id="c-实现-4"><a href="#c-实现-4" class="headerlink" title="c++实现"></a>c++实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：订阅乌龟的位姿信息，并输出到控制台</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化ros节点</span></span><br><span class="line"><span class="comment">        3。创建节点句柄</span></span><br><span class="line"><span class="comment">        4.创建订阅对象</span></span><br><span class="line"><span class="comment">        5.处理订阅数据(回调函数)</span></span><br><span class="line"><span class="comment">        6.spin()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPose</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr &amp;pose)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;乌龟的位姿信息：坐标(%.2f,%.2f),朝向(%.2f),线速度：%.2f,角速度：%.2f&quot;</span>,</span><br><span class="line">    pose-&gt;x,pose-&gt;y,pose-&gt;theta,pose-&gt;linear_velocity,pose-&gt;angular_velocity);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;sub_pose&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">&quot;/turtle1/pose&quot;</span>,<span class="number">100</span>,doPose);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python实现-4"><a href="#python实现-4" class="headerlink" title="python实现"></a>python实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    需求：订阅并输出乌龟的位姿信息</span></span><br><span class="line"><span class="string">    1.导包</span></span><br><span class="line"><span class="string">    2.初始化ros节点</span></span><br><span class="line"><span class="string">    3.创建订阅对象</span></span><br><span class="line"><span class="string">    4.使用回调函数处理订阅到的消息</span></span><br><span class="line"><span class="string">    5.spin()</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doPose</span>(<span class="params">pose</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;P-&gt;乌龟位姿信息：坐标(%.2f,%.2f),朝向(%.2f),线速度：%.2f,角速度：%.2f&quot;</span>,</span><br><span class="line">                pose.x,pose.y,pose.theta,pose.linear_velocity,pose.angular_velocity)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;sub_pose_p&quot;</span>)</span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;/turtle1/pose&quot;</span>,Pose,doPose,queue_size=<span class="number">100</span>)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure><h3 id="实操3"><a href="#实操3" class="headerlink" title="实操3"></a>实操3</h3><h4 id="用途-2"><a href="#用途-2" class="headerlink" title="用途"></a>用途</h4><p>生成多个乌龟</p><h4 id="c-实现-5"><a href="#c-实现-5" class="headerlink" title="c++实现"></a>c++实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Spawn.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：向服务端发送请求，生成一只新乌龟</span></span><br><span class="line"><span class="comment">        话题：/spawn</span></span><br><span class="line"><span class="comment">        消息：turtlesin/Spawn</span></span><br><span class="line"><span class="comment">    1.包含头文件</span></span><br><span class="line"><span class="comment">    2.初始化ros节点</span></span><br><span class="line"><span class="comment">    3.创建节点句柄</span></span><br><span class="line"><span class="comment">    4.创建客户端对象</span></span><br><span class="line"><span class="comment">    5.组织数据并发送</span></span><br><span class="line"><span class="comment">    6.处理响应</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;service_call&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::ServiceClient client = nh.<span class="built_in">serviceClient</span>&lt;turtlesim::Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">    turtlesim::Spawn spawn;</span><br><span class="line">    <span class="comment">//组织请求数据</span></span><br><span class="line">    spawn.request.x = <span class="number">1.0</span>;</span><br><span class="line">    spawn.request.y = <span class="number">4.0</span>;</span><br><span class="line">    spawn.request.theta = <span class="number">1.57</span>;</span><br><span class="line">    spawn.request.name = <span class="string">&quot;turtle2&quot;</span>;</span><br><span class="line">    <span class="comment">//发送请求</span></span><br><span class="line">    <span class="comment">//判断服务器状态</span></span><br><span class="line">    <span class="comment">// ros::service::waitForService(&quot;/spawn&quot;);</span></span><br><span class="line">    client.<span class="built_in">waitForExistence</span>();</span><br><span class="line">    <span class="type">bool</span> flag = client.<span class="built_in">call</span>(spawn);<span class="comment">//flag是用来接收响应状态的，响应结果也会被设置进spawn对象</span></span><br><span class="line">    <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;乌龟生成成功，新乌龟叫:%s&quot;</span>,spawn.response.name.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;请求失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python实现-5"><a href="#python实现-5" class="headerlink" title="python实现"></a>python实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> http <span class="keyword">import</span> client</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> response</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.srv <span class="keyword">import</span> Spawn,SpawnRequest,SpawnResponse</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    需求：向参数服务器发送请求生成一只乌龟</span></span><br><span class="line"><span class="string">        话题：/spawn</span></span><br><span class="line"><span class="string">        消息:turtlesim/Spawn</span></span><br><span class="line"><span class="string">    1.导包</span></span><br><span class="line"><span class="string">    2.初始化ros节点</span></span><br><span class="line"><span class="string">    3.创建服务的客户端对象</span></span><br><span class="line"><span class="string">    4.组织数据并发送请求</span></span><br><span class="line"><span class="string">    5.处理响应结果</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;service_call_p&quot;</span>)</span><br><span class="line">    client = rospy.ServiceProxy(<span class="string">&quot;/spawn&quot;</span>,Spawn)</span><br><span class="line">    request = SpawnRequest()</span><br><span class="line">    request.x = <span class="number">4.5</span></span><br><span class="line">    request.y = <span class="number">2.0</span></span><br><span class="line">    request.theta = -<span class="number">3</span></span><br><span class="line">    request.name = <span class="string">&quot;turtle3&quot;</span></span><br><span class="line">    client.wait_for_service()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        client.call(request)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;生成乌龟的名字叫%s&quot;</span>,response.name)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;请求处理失败&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="实操4"><a href="#实操4" class="headerlink" title="实操4"></a>实操4</h3><h4 id="用途-3"><a href="#用途-3" class="headerlink" title="用途"></a>用途</h4><p>修改背景颜色</p><h4 id="c-实现-6"><a href="#c-实现-6" class="headerlink" title="c++实现"></a>c++实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：修改参数服务器中turtlesim背景色相关的参数</span></span><br><span class="line"><span class="comment">    1.初始化ros节点</span></span><br><span class="line"><span class="comment">    2.不一定需要创建节点句柄(和后续API有关)</span></span><br><span class="line"><span class="comment">    3.修改参数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;change_bgColor&quot;</span>);</span><br><span class="line">    <span class="comment">// ros::NodeHandle nh(&quot;turtlesim&quot;);</span></span><br><span class="line">    <span class="comment">// nh.setParam(&quot;background_r&quot;,255);</span></span><br><span class="line">    <span class="comment">// nh.setParam(&quot;background_g&quot;,255);</span></span><br><span class="line">    <span class="comment">// nh.setParam(&quot;background_b&quot;,255);</span></span><br><span class="line"></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;/turtlesim/background_r&quot;</span>,<span class="number">255</span>);</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;/turtlesim/background_g&quot;</span>,<span class="number">255</span>);</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;/turtlesim/background_b&quot;</span>,<span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果调用ros::param 不需要创建节点句柄</span></span><br><span class="line">    <span class="comment">// ros::param::set(&quot;/turtlesim/background_r&quot;,0);</span></span><br><span class="line">    <span class="comment">// ros::param::set(&quot;/turtlesim/background_g&quot;,0);</span></span><br><span class="line">    <span class="comment">// ros::param::set(&quot;/turtlesim/background_b&quot;,0);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python实现-6"><a href="#python实现-6" class="headerlink" title="python实现"></a>python实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    需求:修改乌龟GUI背景色</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    1.初始化ros节点</span></span><br><span class="line"><span class="string">    2.设置参数</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;change_bgColor_p&quot;</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;/turtlesim/background_r&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;/turtlesim/background_g&quot;</span>,<span class="number">50</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;/turtlesim/background_b&quot;</span>,<span class="number">200</span>)</span><br></pre></td></tr></table></figure><h1 id="ros通信机制进阶"><a href="#ros通信机制进阶" class="headerlink" title="ros通信机制进阶"></a>ros通信机制进阶</h1><p><a href="http://wiki.ros.org/APIs">官方api文档</a></p></div><div class="story post-story"><h2 id="常用api"><a href="#常用api" class="headerlink" title="常用api"></a>常用api</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><h4 id="c-3"><a href="#c-3" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="comment">// /*</span></span><br><span class="line"><span class="comment">//     发布方实现:</span></span><br><span class="line"><span class="comment">//         1.包含头文件</span></span><br><span class="line"><span class="comment">//         2.初始化ros节点</span></span><br><span class="line"><span class="comment">//         3.创建节点句柄</span></span><br><span class="line"><span class="comment">//         4.创建发布者对象</span></span><br><span class="line"><span class="comment">//         5.编辑发布者逻辑及发布数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//初始化节点</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        作用：ros初始化函数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        参数：</span></span><br><span class="line"><span class="comment">            1.argc  ---封装实参个数（n+1）</span></span><br><span class="line"><span class="comment">            2.argv  ---封装参数的数组</span></span><br><span class="line"><span class="comment">            3.name --- 为节点命名（保证唯一性）</span></span><br><span class="line"><span class="comment">            4.options ---- 节点启动对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            返回值：void</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">        使用：</span></span><br><span class="line"><span class="comment">            1.argc与argv的使用</span></span><br><span class="line"><span class="comment">                如果按照ros中的特定格式传入实参，那么ros可以加以使用，比如用来设置全局参数，给节点重命名</span></span><br><span class="line"><span class="comment">            2.options的使用</span></span><br><span class="line"><span class="comment">                节点名称需要保证唯一，会导致一个问题：同一个节点不能重复启动</span></span><br><span class="line"><span class="comment">                结果：当有重名的节点启动时那么之前的节点就会被关闭</span></span><br><span class="line"><span class="comment">                需求：特定场景下，需要一个节点多次启动且能正常运行？？？</span></span><br><span class="line"><span class="comment">                解决：设置启动项：ros::init_options::AnonymousName</span></span><br><span class="line"><span class="comment">                    当创建ros节点时，会在用户自定义的节点名称后缀随机数，从而避免重名问题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;erGouZi&quot;</span>,ros::init_options::AnonymousName);</span><br><span class="line">    <span class="comment">//创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">&quot;fang&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//创建被发布的消息</span></span><br><span class="line">    std_msgs::String msg;</span><br><span class="line">    <span class="comment">//编写循环</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//要求以10hz的频率发布数据,文本后添加编号</span></span><br><span class="line">    <span class="comment">//发布频率</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="comment">//设置编号</span></span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//为了防止前几个数据丢失一般加入休眠</span></span><br><span class="line">    ros::<span class="built_in">Duration</span>(<span class="number">3</span>).<span class="built_in">sleep</span>();</span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//如果计数器大于50,那么关闭节点</span></span><br><span class="line">        <span class="keyword">if</span>(count&gt;=<span class="number">50</span>)&#123;</span><br><span class="line">            ros::<span class="built_in">shutdown</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="comment">// msg.data = &quot;hello&quot;;</span></span><br><span class="line">        <span class="comment">// 实现字符串拼接</span></span><br><span class="line">        std::stringstream ss;</span><br><span class="line">        ss &lt;&lt; <span class="string">&quot;hello ---&gt;&quot;</span>&lt;&lt;count;</span><br><span class="line">        msg.data=ss.<span class="built_in">str</span>();</span><br><span class="line">        <span class="comment">// if(count &lt;=10)&#123;</span></span><br><span class="line">        <span class="comment">//     pub.publish(msg);</span></span><br><span class="line">        <span class="comment">// //添加日志</span></span><br><span class="line">        <span class="comment">//     ROS_INFO(&quot;发布的数据是%s&quot;,ss.str().c_str());</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();<span class="comment">//处理回调函数</span></span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;一轮回调执行完毕&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-3"><a href="#python-3" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String<span class="comment">#发布的消息的类型</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用python实现消息发布</span></span><br><span class="line"><span class="string">    1.导包</span></span><br><span class="line"><span class="string">    2.初始化ros节点</span></span><br><span class="line"><span class="string">    3.创建发布者对象</span></span><br><span class="line"><span class="string">    4.编写发布逻辑并发布数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">        作用:ros初始化</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            name---设置节点名称</span></span><br><span class="line"><span class="string">            argv=None ---- 封装节点调用时传递的参数</span></span><br><span class="line"><span class="string">            anonymous=False ----可以为节点名称生成随机后缀,可以解决重名问题</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        使用:</span></span><br><span class="line"><span class="string">            1.argv使用</span></span><br><span class="line"><span class="string">            可以按照ros中指定的语法格式传参,ros可以解析并加以使用</span></span><br><span class="line"><span class="string">            2.anonymous的使用</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;sanDai&quot;</span>,anonymous=<span class="literal">True</span>) <span class="comment">#传入节点名称</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;che&quot;</span>,String,queue_size=<span class="number">10</span>,latch=<span class="literal">True</span>)</span><br><span class="line">    msg=String()</span><br><span class="line">    <span class="comment">#制定发布频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#设置技计数器</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    rospy.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> count&lt;=<span class="number">10</span>:</span><br><span class="line">            msg.data = <span class="string">&quot;hello&quot;</span> + <span class="built_in">str</span>(count)</span><br><span class="line">            pub.publish(msg)</span><br><span class="line">            rospy.loginfo(<span class="string">&quot;发布的数据:%s&quot;</span>,msg.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#关闭节点</span></span><br><span class="line">            rospy.signal_shutdown(<span class="string">&quot;关闭节点&quot;</span>)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure><h3 id="话题与服务对象"><a href="#话题与服务对象" class="headerlink" title="话题与服务对象"></a>话题与服务对象</h3><h4 id="c-4"><a href="#c-4" class="headerlink" title="c++"></a>c++</h4><h5 id="发布者"><a href="#发布者" class="headerlink" title="发布者"></a>发布者</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="comment">// /*</span></span><br><span class="line"><span class="comment">//     发布方实现:</span></span><br><span class="line"><span class="comment">//         1.包含头文件</span></span><br><span class="line"><span class="comment">//         2.初始化ros节点</span></span><br><span class="line"><span class="comment">//         3.创建节点句柄</span></span><br><span class="line"><span class="comment">//         4.创建发布者对象</span></span><br><span class="line"><span class="comment">//         5.编辑发布者逻辑及发布数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;erGouZi&quot;</span>,ros::init_options::AnonymousName);</span><br><span class="line">    <span class="comment">//创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//创建发布者对象</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        作用：创建发布者对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        模板：被发布的消息的类型</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        参数：</span></span><br><span class="line"><span class="comment">            1. 话题名称</span></span><br><span class="line"><span class="comment">            2.队列长度</span></span><br><span class="line"><span class="comment">            3.latch(可选) 如果是true，会保存发布方的最后一条消息，并且新的订阅对象连接到发布方时，发布方会将这条消息发送给订阅者</span></span><br><span class="line"><span class="comment">        使用：</span></span><br><span class="line"><span class="comment">            latch 设置为true的作用？</span></span><br><span class="line"><span class="comment">            以静态地图发布为例，方案一：可以使用固定频率发送地图数据，但是效率低</span></span><br><span class="line"><span class="comment">            方案二：可以将地图发布对象的latch设置为true，并且发布方只发送一次数据时，每当订阅者连接时，将地图数据发送给订阅者（至发送一次），提高了数据发送效率</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">&quot;fang&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//创建被发布的消息</span></span><br><span class="line">    std_msgs::String msg;</span><br><span class="line">    <span class="comment">//编写循环</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//要求以10hz的频率发布数据,文本后添加编号</span></span><br><span class="line">    <span class="comment">//发布频率</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="comment">//设置编号</span></span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//为了防止前几个数据丢失一般加入休眠</span></span><br><span class="line">    ros::<span class="built_in">Duration</span>(<span class="number">3</span>).<span class="built_in">sleep</span>();</span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//如果计数器大于50,那么关闭节点</span></span><br><span class="line">        <span class="keyword">if</span>(count&gt;=<span class="number">50</span>)&#123;</span><br><span class="line">            ros::<span class="built_in">shutdown</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="comment">// msg.data = &quot;hello&quot;;</span></span><br><span class="line">        <span class="comment">// 实现字符串拼接</span></span><br><span class="line">        std::stringstream ss;</span><br><span class="line">        ss &lt;&lt; <span class="string">&quot;hello ---&gt;&quot;</span>&lt;&lt;count;</span><br><span class="line">        msg.data=ss.<span class="built_in">str</span>();</span><br><span class="line">        <span class="comment">// if(count &lt;=10)&#123;</span></span><br><span class="line">        <span class="comment">//     pub.publish(msg);</span></span><br><span class="line">        <span class="comment">// //添加日志</span></span><br><span class="line">        <span class="comment">//     ROS_INFO(&quot;发布的数据是%s&quot;,ss.str().c_str());</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();<span class="comment">//处理回调函数</span></span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;一轮回调执行完毕&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="订阅方-4"><a href="#订阅方-4" class="headerlink" title="订阅方"></a>订阅方</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// /*</span></span><br><span class="line"><span class="comment">//     订阅方实现:</span></span><br><span class="line"><span class="comment">//         1.包含头文件</span></span><br><span class="line"><span class="comment">//         2.初始化ros节点</span></span><br><span class="line"><span class="comment">//         3.创建节点句柄</span></span><br><span class="line"><span class="comment">//         4.创建订阅者对象</span></span><br><span class="line"><span class="comment">//         5.处理订阅者逻辑及数据</span></span><br><span class="line"><span class="comment">//spin函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doMsg</span><span class="params">(<span class="type">const</span> std_msgs::String::ConstPtr &amp;msg)</span></span>&#123;</span><br><span class="line">    <span class="comment">//通过msg获取并操作订阅的数据</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;翠花订阅数据:%s&quot;</span>,msg-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* code */</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;cuihua&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">&quot;fang&quot;</span>,<span class="number">10</span>,doMsg);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-4"><a href="#python-4" class="headerlink" title="python"></a>python</h4><h5 id="发布方-4"><a href="#发布方-4" class="headerlink" title="发布方"></a>发布方</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String<span class="comment">#发布的消息的类型</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用python实现消息发布</span></span><br><span class="line"><span class="string">    1.导包</span></span><br><span class="line"><span class="string">    2.初始化ros节点</span></span><br><span class="line"><span class="string">    3.创建发布者对象</span></span><br><span class="line"><span class="string">    4.编写发布逻辑并发布数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;sanDai&quot;</span>,anonymous=<span class="literal">True</span>) <span class="comment">#传入节点名称</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;che&quot;</span>,String,queue_size=<span class="number">10</span>,latch=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># //创建发布者对象</span></span><br><span class="line">    <span class="comment"># /* </span></span><br><span class="line">    <span class="comment">#     作用：创建发布者对象</span></span><br><span class="line">    <span class="comment">#       bool值  默认false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#     参数：</span></span><br><span class="line">    <span class="comment">#         latch(可选) 如果是true，会保存发布方的最后一条消息，并且新的订阅对象连接到发布方时，发布方会将这条消息发送给订阅者</span></span><br><span class="line">    <span class="comment">#     使用：</span></span><br><span class="line">    <span class="comment">#         latch 设置为true的作用？</span></span><br><span class="line">    <span class="comment">#         以静态地图发布为例，方案一：可以使用固定频率发送地图数据，但是效率低</span></span><br><span class="line">    <span class="comment">#         方案二：可以将地图发布对象的latch设置为true，并且发布方只发送一次数据时，每当订阅者连接时，将地图数据发送给订阅者（至发送一次），提高了数据发送效率</span></span><br><span class="line">    <span class="comment">#  */</span></span><br><span class="line">    msg=String()</span><br><span class="line">    <span class="comment">#制定发布频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#设置技计数器</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    rospy.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> count&lt;=<span class="number">10</span>:</span><br><span class="line">            msg.data = <span class="string">&quot;hello&quot;</span> + <span class="built_in">str</span>(count)</span><br><span class="line">            pub.publish(msg)</span><br><span class="line">            rospy.loginfo(<span class="string">&quot;发布的数据:%s&quot;</span>,msg.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#关闭节点</span></span><br><span class="line">            rospy.signal_shutdown(<span class="string">&quot;关闭节点&quot;</span>)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure><h3 id="回旋函数和时间"><a href="#回旋函数和时间" class="headerlink" title="回旋函数和时间"></a>回旋函数和时间</h3><h4 id="c-5"><a href="#c-5" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求1：演示时间相关操作(获取当前时刻+设置指定时刻</span></span><br><span class="line"><span class="comment">    实现：</span></span><br><span class="line"><span class="comment">        1.准备(头文件，节点初始化，NodeHandler创建...)</span></span><br><span class="line"><span class="comment">        2.获取当前时刻</span></span><br><span class="line"><span class="comment">        3.设置制定时刻</span></span><br><span class="line"><span class="comment">    需求2：在程序执行中停顿5s</span></span><br><span class="line"><span class="comment">    实现：</span></span><br><span class="line"><span class="comment">        1.创建持续时间对象</span></span><br><span class="line"><span class="comment">        2.休眠</span></span><br><span class="line"><span class="comment">    需求3:已知程序运行的时刻和程序运行的时间,求运行结束时刻</span></span><br><span class="line"><span class="comment">    实现:</span></span><br><span class="line"><span class="comment">        1.获取开始执行的时刻</span></span><br><span class="line"><span class="comment">        2.模拟运行时间(n秒)</span></span><br><span class="line"><span class="comment">        3.计算结束时刻 = 开始+持续时间</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    时刻之间之可以相减不可以相加</span></span><br><span class="line"><span class="comment">    需求4:要求每隔1秒,在控制台输出一段文本</span></span><br><span class="line"><span class="comment">    实现:</span></span><br><span class="line"><span class="comment">        1.使用ros::Rate()</span></span><br><span class="line"><span class="comment">        2.定时器</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//回调函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cb</span><span class="params">(<span class="type">const</span> ros::TimerEvent&amp; event)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;--------&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1.准备(头文件，节点初始化，NodeHandler创建...)</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;hello_time&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;<span class="comment">//必须，否则会导致时间初始化失败(在NodeHandler会初始化时间操作)</span></span><br><span class="line">    <span class="comment">//     2.获取当前时刻</span></span><br><span class="line">    <span class="comment">//参考系：1970.01.01。00.00.00</span></span><br><span class="line">    ros::Time right_now = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;当前时刻为：%.2f&quot;</span>,right_now.<span class="built_in">toSec</span>());</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;当前时刻为：%d&quot;</span>,right_now.sec);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//     3.设置制定时刻</span></span><br><span class="line">    <span class="function">ros::Time <span class="title">t1</span><span class="params">(<span class="number">20</span>,<span class="number">312345678</span>)</span></span>;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;t1=%.2f&quot;</span>,t1.<span class="built_in">toSec</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------持续时间------------------------------------</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;开始休眠&quot;</span>);</span><br><span class="line">    <span class="function">ros::Duration <span class="title">du</span><span class="params">(<span class="number">4.5</span>)</span></span>;</span><br><span class="line">    du.<span class="built_in">sleep</span>();</span><br><span class="line">    ros::Time end= ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;休眠结束&quot;</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------时间运算-----------------------------------</span></span><br><span class="line">    <span class="comment">// 1.获取开始执行的时刻</span></span><br><span class="line">    ros::Time begin = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    <span class="comment">//     2.模拟运行时间(n秒)</span></span><br><span class="line">    <span class="function">ros::Duration <span class="title">du1</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="comment">//     3.计算结束时刻 = 开始+持续时间</span></span><br><span class="line">    ros::Time stop = begin + du1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时刻与时刻的运算</span></span><br><span class="line">    <span class="comment">// ros::Time sum = begin + stop;//不可以相加</span></span><br><span class="line">    ros::Duration du2 = begin -stop;</span><br><span class="line">    <span class="comment">//持续时间与持续时间的运算</span></span><br><span class="line">    ros::Duration du3 = du1+du2;</span><br><span class="line">    ros::Duration du4 = du1-du2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------定时器-----------------------------------</span></span><br><span class="line">    <span class="comment">/* ros::Timer createTimer(ros::Duration period, //时间间隔1s</span></span><br><span class="line"><span class="comment">        const ros::TimerCallback &amp;callback,            //回调函数</span></span><br><span class="line"><span class="comment">        bool oneshot = false,                       //是否是一次性的</span></span><br><span class="line"><span class="comment">        bool autostart = true) const                  //自动启动,当设置为false时,需要手动调用timer.start()</span></span><br><span class="line"><span class="comment">        定时器启动后:ros::spin()</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    ros::Timer timer = nh.<span class="built_in">createTimer</span>(ros::<span class="built_in">Duration</span>(<span class="number">1</span>),cb);</span><br><span class="line">    ros::<span class="built_in">spin</span>();<span class="comment">//需要回旋</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-5"><a href="#python-5" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    需求1:演示时间相关操作(获取当前时刻+设置指定时刻）</span></span><br><span class="line"><span class="string">    需求2:在程序执行中停顿5s</span></span><br><span class="line"><span class="string">    需求3:已知程序运行的时刻和程序运行的时间,求运行结束时刻</span></span><br><span class="line"><span class="string">    需求4:要求每隔1秒,在控制台输出一段文本</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doMsg</span>(<span class="params">event</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;--------------------------------&quot;</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;调用回调函数的时刻：%.2f&quot;</span>,event.current_real.to_sec())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 需求1:演示时间相关操作(获取当前时刻+设置指定时刻）</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;hello_time_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 获取时刻</span></span><br><span class="line">    right_now = rospy.Time.now() <span class="comment">#将当前时刻获取并封装成对象</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;当前时刻：%.2f&quot;</span>,right_now.to_sec())</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;当前时刻：%d&quot;</span>,right_now.secs)</span><br><span class="line">    <span class="comment"># 设置指定</span></span><br><span class="line">    time1 = rospy.Time(<span class="number">100</span>)<span class="comment">#将时间(1970年1月1日  00.00.00  逝去100秒)封装成timme对象</span></span><br><span class="line">    time2 = rospy.Time(<span class="number">100</span>,<span class="number">312345678</span>)<span class="comment">#将时间(1970年1月1日  00.00.00  逝去100.312345678秒)封装成timme对象</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;指定时刻1:%.2f&quot;</span>,time1.to_sec())</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;指定时刻2:%.2f&quot;</span>,time2.to_sec())</span><br><span class="line"></span><br><span class="line">    <span class="comment">#从某个时间值获取时间对象</span></span><br><span class="line">    time3 = rospy.Time.from_sec(<span class="number">210.12</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;指定时刻3:%.2f&quot;</span>,time3.to_sec())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 需求2:在程序执行中停顿5s</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;休眠前------------------------&quot;</span>)</span><br><span class="line">    <span class="comment"># 1.封装一个时间对象（5秒）</span></span><br><span class="line">    du = rospy.Duration(<span class="number">5</span>)</span><br><span class="line">    <span class="comment"># 2.在将持续时间休眠</span></span><br><span class="line">    rospy.sleep(du)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;休眠后------------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 需求3:已知程序运行的时刻和程序运行的时间,求运行结束时刻</span></span><br><span class="line">    <span class="comment"># 1.获取一个时刻  t1</span></span><br><span class="line">    t1 = rospy.Time.now()</span><br><span class="line">    <span class="comment"># 2.设置持续时间 du1</span></span><br><span class="line">    du1 = rospy.Duration(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.结束时刻  t2 = t1 + du1</span></span><br><span class="line">    t2 = t1 + du1</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;开始时刻：%.2f&quot;</span>,t1.to_sec())</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;结束时刻：%.2f&quot;</span>,t2.to_sec())</span><br><span class="line"></span><br><span class="line">    du2 = du +du1</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;持续时间相加:%.2f&quot;</span>,du2.to_sec())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># t2 = right_now + t1 会抛异常</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 需求4：设置定时器，每隔一段时间执行某种操作</span></span><br><span class="line">    timer = rospy.Timer(rospy.Duration(<span class="number">2</span>),doMsg,<span class="literal">True</span>)<span class="comment">#创建一个定时器对象,当为TRUE时只执行一次回调函数</span></span><br><span class="line">    rospy.spin() <span class="comment">#重要</span></span><br></pre></td></tr></table></figure><h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><h4 id="c-6"><a href="#c-6" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    ros中日志:</span></span><br><span class="line"><span class="comment">        演示不同级别日志的基本使用</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;hello_log&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//日志输出</span></span><br><span class="line">    <span class="built_in">ROS_DEBUG</span>(<span class="string">&quot;调试信息&quot;</span>);<span class="comment">//不会打印在控制台</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;一般信息&quot;</span>);</span><br><span class="line">    <span class="built_in">ROS_WARN</span>(<span class="string">&quot;警告信息&quot;</span>);</span><br><span class="line">    <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;错误信息&quot;</span>);</span><br><span class="line">    <span class="built_in">ROS_FATAL</span>(<span class="string">&quot;严重错误&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-6"><a href="#python-6" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#演示日志函数</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;hello_log_p&quot;</span>)</span><br><span class="line">    rospy.logdebug(<span class="string">&quot;DEBUG&quot;</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;info消息&quot;</span>)</span><br><span class="line">    rospy.logwarn(<span class="string">&quot;WARNING&quot;</span>)</span><br><span class="line">    rospy.logerr(<span class="string">&quot;ERROR&quot;</span>)</span><br><span class="line">    rospy.logfatal(<span class="string">&quot;fatal&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="ros中头文件和源文件的调用"><a href="#ros中头文件和源文件的调用" class="headerlink" title="ros中头文件和源文件的调用"></a>ros中头文件和源文件的调用</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _HELLO_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _HELLO_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    声明 namespace</span></span><br><span class="line"><span class="comment">        |-- class</span></span><br><span class="line"><span class="comment">            |-- run</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> hello_ns&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHello</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="头文件调用"><a href="#头文件调用" class="headerlink" title="头文件调用"></a>头文件调用</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;plumbing_head/hello.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> hello_ns&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">MyHello::run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;run函数执行&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;hello_head&quot;</span>);</span><br><span class="line">    hello_ns::MyHello myHello;</span><br><span class="line">    myHello.<span class="built_in">run</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="源文件的调用"><a href="#源文件的调用" class="headerlink" title="源文件的调用"></a>源文件的调用</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;plumbing_head_src/hello.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="keyword">namespace</span> hello_ns&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">MyHello::run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;源文件中的run函数&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;plumbing_head_src/hello.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;hello_head_src&quot;</span>);</span><br><span class="line">    hello_ns::MyHello myHello;</span><br><span class="line">    myHello.<span class="built_in">run</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="python模块导入"><a href="#python模块导入" class="headerlink" title="python模块导入"></a>python模块导入</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String<span class="comment">#发布的消息的类型</span></span><br><span class="line"><span class="keyword">import</span> tools</span><br><span class="line"><span class="comment"># 设置临时环境变量</span></span><br><span class="line"><span class="comment"># 路径写死影响代码的可移植性</span></span><br><span class="line"><span class="comment"># sys.path.insert(0,&quot;/home/zhuwencheng/demo03_ws/src/plumbing_pub_sub/scripts&quot;)</span></span><br><span class="line"><span class="comment">#优化，可以动态获取路径</span></span><br><span class="line">path = os.path.abspath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">sys.path.insert(<span class="number">0</span>,path+<span class="string">&quot;/src/plumbing_pub_sub/scripts&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用python实现消息发布</span></span><br><span class="line"><span class="string">    1.导包</span></span><br><span class="line"><span class="string">    2.初始化ros节点</span></span><br><span class="line"><span class="string">    3.创建发布者对象</span></span><br><span class="line"><span class="string">    4.编写发布逻辑并发布数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;sanDai&quot;</span>) <span class="comment">#传入节点名称</span></span><br><span class="line">    path = os.path.abspath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">        原因：rosrun执行是，参考路径是工作空间的路径，在工作空间下，无法查找依赖的模块</span></span><br><span class="line"><span class="string">        解决：可以声明python的环境变量，当依赖某个模块时，先去指定的模块中查找依赖</span></span><br><span class="line"><span class="string">     &quot;&quot;&quot;</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;执行时参考的路径：%s&quot;</span>,path)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;tools:%d&quot;</span>,tools.num)</span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;che&quot;</span>,String,queue_size=<span class="number">10</span>)</span><br><span class="line">    msg=String()</span><br><span class="line">    <span class="comment">#制定发布频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#设置技计数器</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    rospy.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        msg.data = <span class="string">&quot;hello&quot;</span> + <span class="built_in">str</span>(count)</span><br><span class="line">        pub.publish(msg)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;发布的数据:%s&quot;</span>,msg.data)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure><h4 id="tools"><a href="#tools" class="headerlink" title="tools"></a>tools</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">num = <span class="number">100</span></span><br></pre></td></tr></table></figure><h1 id="ros运行管理"><a href="#ros运行管理" class="headerlink" title="ros运行管理"></a>ros运行管理</h1></div><div class="story post-story"><h2 id="ros元功能包"><a href="#ros元功能包" class="headerlink" title="ros元功能包"></a>ros元功能包</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0.2)</span><br><span class="line">project(plumbing_my)</span><br><span class="line">find_package(catkin REQUIRED)</span><br><span class="line">catkin_metapackage()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;export&gt;</span><br><span class="line">   &lt;!-- Other tools can request additional information be placed here --&gt;</span><br><span class="line">   &lt;metapackage /&gt;</span><br><span class="line"> &lt;/export&gt;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="launch"><a href="#launch" class="headerlink" title="launch"></a>launch</h2><h3 id="launch-node-remap-param-rosparam标签"><a href="#launch-node-remap-param-rosparam标签" class="headerlink" title="launch,node,remap,param,rosparam标签"></a>launch,node,remap,param,rosparam标签</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- deprecated=<span class="string">&quot;此文件已经过时，不建议使用&quot;</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">launch</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 启动的节点 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- respawn=&quot;true&quot;节点启动后自动重启 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- required=&quot;true&quot;节点退出后关闭整个系统 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- ns=&quot;hello&quot;设置节点的命名空间 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- param使用：向参数服务器设置参数 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 格式一：launch下，node外 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;param_A&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- rosparam的使用：操作参数服务器数据 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 格式一：launch下，node外 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 加载参数 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">file</span>=<span class="string">&quot;$(find launch01_basic)/launch/params.yaml&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 导出参数 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;my_turtle&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/turtle1/cmd_vel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/cmd/vel&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 格式2：node下 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;param_B&quot;</span> <span class="attr">type</span>=<span class="string">&quot;double&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3.14&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 格式2：node下 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">file</span>=<span class="string">&quot;$(find launch01_basic)/launch/params.yaml&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 键盘控制 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">name</span>=<span class="string">&quot;my_key&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="group"><a href="#group" class="headerlink" title="group"></a>group</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 启动两对乌龟gui与键盘控制节点 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">group</span> <span class="attr">ns</span>=<span class="string">&quot;first&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;my_turtle&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">name</span>=<span class="string">&quot;my_key&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">group</span> <span class="attr">ns</span>=<span class="string">&quot;second&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;my_turtle&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">name</span>=<span class="string">&quot;my_key&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &lt;/launch&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="include"><a href="#include" class="headerlink" title="include"></a>include</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 需要复用start_turtle.<span class="property">launch</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 包含 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find launch01_basic)/launch/start_turtle.launch&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 其他节点 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="arg"><a href="#arg" class="headerlink" title="arg"></a>arg</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 需求：演示arg的使用，需要设置多个参数，这些参数使用的是同一个值(小车的长度)，怎么设置？ --&gt;</span><br><span class="line">    &lt;!-- <span class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;A&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span> /&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;B&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span> /&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;C&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span> /&gt;</span></span> --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;car_length&quot;</span> <span class="attr">default</span>=<span class="string">&quot;0.55&quot;</span> /&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;A&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg car_length)&quot;</span> /&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;B&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg car_length)&quot;</span> /&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;C&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg car_length)&quot;</span> /&gt;</span></span></span><br><span class="line"> &lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="工作空间覆盖"><a href="#工作空间覆盖" class="headerlink" title="工作空间覆盖"></a>工作空间覆盖</h2><p>当功能包重名时，先配置的，会优先执行</p></div><div class="story post-story"><h2 id="节点名称"><a href="#节点名称" class="headerlink" title="节点名称"></a>节点名称</h2><h3 id="rosrun实现"><a href="#rosrun实现" class="headerlink" title="rosrun实现"></a>rosrun实现</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rosrun turtlesim turtlesim_node __ns:=/xxx</span><br><span class="line">rosrun turtlesim  turtlesim_node __name:= xxx</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="launch实现"><a href="#launch实现" class="headerlink" title="launch实现"></a>launch实现</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 需要启动多个乌龟gui节点 --&gt;</span><br><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;turtlesim&quot; /&gt;</span><br><span class="line">    &lt;!-- 1.名称重映射 --&gt;</span><br><span class="line">    &lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;t1&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 2.命名空间 --&gt;</span><br><span class="line">    &lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;turtlesim&quot; ns=&quot;ergouzi&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 3.命名空间+映射名称 --&gt;</span><br><span class="line">    &lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;t2&quot; ns=&quot;maolvzi&quot; /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h3><h4 id="c-7"><a href="#c-7" class="headerlink" title="c++"></a>c++</h4><p>ros::init(argc,argv,””,ros::init_options::);</p><h4 id="python-7"><a href="#python-7" class="headerlink" title="python"></a>python</h4><p>rospy.init_node(“lisi”,anonymous&#x3D;True)</p></div><div class="story post-story"><h2 id="话题名称"><a href="#话题名称" class="headerlink" title="话题名称"></a>话题名称</h2><h3 id="rosrun"><a href="#rosrun" class="headerlink" title="rosrun"></a>rosrun</h3><p>rosrun teleop_twist_keyboard teleop_twist_keyboard.py &#x2F;cmd_vel:&#x3D;&#x2F;turtle1&#x2F;cmd_vel</p><h3 id="launch-1"><a href="#launch-1" class="headerlink" title="launch"></a>launch</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 键盘控制乌龟运动 --&gt;</span><br><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 将乌龟的话题设置为与键盘控制一至 --&gt;</span><br><span class="line">    &lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;t1&quot;&gt;</span><br><span class="line">        &lt;remap from=&quot;/turtle1/cmd_vel&quot; to=&quot;/cmd_vel&quot; /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    &lt;node pkg=&quot;teleop_twist_keyboard&quot; type=&quot;teleop_twist_keyboard.py&quot; name=&quot;key&quot; /&gt;  </span><br><span class="line">    &lt;!-- 将键盘控制设置乌龟的话题为与一至 --&gt;</span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h3><h4 id="c-8"><a href="#c-8" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//核心：设置不同类型的话题</span></span><br><span class="line">    <span class="comment">//1.全局 ---话题名称需要以斜杠开头(也可以设置自己的命名空间)，这种情况下和节点(命名空间以及名称）没有关系</span></span><br><span class="line">    <span class="comment">// ros::Publisher pub = nh.advertise&lt;std_msgs::String&gt;(&quot;/chatter&quot;,1000);</span></span><br><span class="line">    <span class="comment">// ros::Publisher pub = nh.advertise&lt;std_msgs::String&gt;(&quot;/yyy/chatter&quot;,1000);</span></span><br><span class="line">    <span class="comment">//2.相对----非/开头</span></span><br><span class="line">    <span class="comment">// ros::Publisher pub = nh.advertise&lt;std_msgs::String&gt;(&quot;chatter&quot;,1000);</span></span><br><span class="line">    <span class="comment">// ros::Publisher pub = nh.advertise&lt;std_msgs::String&gt;(&quot;yyy/chatter&quot;,1000);</span></span><br><span class="line">    <span class="comment">//3.私有 ---需要创建特定NodeHandle</span></span><br><span class="line">    <span class="function">ros::NodeHandle <span class="title">nh</span><span class="params">(<span class="string">&quot;~&quot;</span>)</span></span>;</span><br><span class="line">    <span class="comment">// ros::Publisher pub = nh.advertise&lt;std_msgs::String&gt;(&quot;chatter&quot;,1000);</span></span><br><span class="line">    <span class="comment">// ros::Publisher pub = nh.advertise&lt;std_msgs::String&gt;(&quot;yyy/chatter&quot;,1000);</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">&quot;/yyy/chatter&quot;</span>,<span class="number">1000</span>);<span class="comment">//如果私有的NH创建的话题以/开头，此时为全局话题</span></span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-8"><a href="#python-8" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="comment"># 1.全局</span></span><br><span class="line"><span class="comment">#     pub = rospy.Publisher(&quot;/chatter&quot;,String,queue_size=10)</span></span><br><span class="line"><span class="comment">#     pub = rospy.Publisher(&quot;/yyy/chatter&quot;,String,queue_size=10)</span></span><br><span class="line"><span class="comment"># # 2.相对</span></span><br><span class="line"><span class="comment">#     pub = rospy.Publisher(&quot;chatter&quot;,String,queue_size=10)</span></span><br><span class="line"><span class="comment">#     pub = rospy.Publisher(&quot;yy/chatter&quot;,String,queue_size=10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.私有</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;~chatter&quot;</span>,String,queue_size=<span class="number">10</span>)</span><br><span class="line">    <span class="comment"># pub = rospy.Publisher(&quot;~yyy/chatter&quot;,String,queue_size=10)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="参数名称"><a href="#参数名称" class="headerlink" title="参数名称"></a>参数名称</h2><h3 id="launch-2"><a href="#launch-2" class="headerlink" title="launch"></a>launch</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 设置参数 --&gt;</span><br><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 格式一：全局 --&gt;</span><br><span class="line">    &lt;param name=&quot;radius&quot; value=&quot;0.2&quot; /&gt;</span><br><span class="line">    &lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;t1&quot; ns=&quot;xxx&quot;&gt;</span><br><span class="line">    &lt;!-- 私有 --&gt;</span><br><span class="line">        &lt;param name=&quot;radius&quot; value=&quot;0.08&quot; /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure><h3 id="编码-1"><a href="#编码-1" class="headerlink" title="编码"></a>编码</h3><h4 id="c-9"><a href="#c-9" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        使用ros::param来设置参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//1.全局</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;/radiusA&quot;</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="comment">//2.相对</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;radiusA&quot;</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="comment">//3.私有</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;~radiusA&quot;</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        使用NodeHandle设置参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//全局</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;/radius_nh_A&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">//相对</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;radius_nh_A&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">//私有</span></span><br><span class="line">    <span class="function">ros::NodeHandle <span class="title">nh_private</span><span class="params">(<span class="string">&quot;~&quot;</span>)</span></span>;</span><br><span class="line">    nh_private.<span class="built_in">setParam</span>(<span class="string">&quot;radius_nh_A&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-9"><a href="#python-9" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">        设置不同类型参数</span></span><br><span class="line"><span class="string">     &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#全局</span></span><br><span class="line">    rospy.set_param(<span class="string">&quot;/radius&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    <span class="comment">#相对</span></span><br><span class="line">    rospy.set_param(<span class="string">&quot;radiusB&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    <span class="comment">#私有</span></span><br><span class="line">    rospy.set_param(<span class="string">&quot;~radiusC&quot;</span>,<span class="number">100</span>)</span><br></pre></td></tr></table></figure><h1 id="ros常用组件"><a href="#ros常用组件" class="headerlink" title="ros常用组件"></a>ros常用组件</h1></div><div class="story post-story"><h2 id="tf坐标变换"><a href="#tf坐标变换" class="headerlink" title="tf坐标变换"></a>tf坐标变换</h2><h3 id="坐标变换消息"><a href="#坐标变换消息" class="headerlink" title="坐标变换消息"></a>坐标变换消息</h3><p>通过命令行rosmsg info geometry_msgs访问geometry消息</p><h3 id="静态坐标变换"><a href="#静态坐标变换" class="headerlink" title="静态坐标变换"></a>静态坐标变换</h3><p>发布方发布坐标系的相对关系</p><p>订阅方订阅发布的消息，再传入坐标点信息(可以写死)，然后借助于 tf 实现坐标变换，并将结果输出</p><h4 id="c-实现-7"><a href="#c-实现-7" class="headerlink" title="c++实现"></a>c++实现</h4><h5 id="发布方-5"><a href="#发布方-5" class="headerlink" title="发布方"></a>发布方</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/static_transform_broadcaster.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2/LinearMath/Quaternion.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：发布两个坐标系之间的相对关系</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.包含的头文件</span></span><br><span class="line"><span class="comment">        2.设置编码 初始化ros节点 NodeHandle</span></span><br><span class="line"><span class="comment">        3.创建发布对象</span></span><br><span class="line"><span class="comment">        4.组织被发布的消息</span></span><br><span class="line"><span class="comment">        5.发布数据</span></span><br><span class="line"><span class="comment">        6。spin()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;static_pub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    tf2_ros::StaticTransformBroadcaster pub;</span><br><span class="line">    geometry_msgs::TransformStamped tfs;</span><br><span class="line">    tfs.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    tfs.header.frame_id = <span class="string">&quot;base_link&quot;</span>;<span class="comment">//相对坐标系关系中被参考的那个</span></span><br><span class="line">    tfs.child_frame_id = <span class="string">&quot;laser&quot;</span>;</span><br><span class="line">    tfs.transform.translation.x = <span class="number">0.2</span>;</span><br><span class="line">    tfs.transform.translation.y = <span class="number">0.0</span>;</span><br><span class="line">    tfs.transform.translation.z = <span class="number">0.5</span>;</span><br><span class="line">    <span class="comment">//需要根据欧拉角转换</span></span><br><span class="line">    tf2::Quaternion qtn;<span class="comment">//创建四元数对象</span></span><br><span class="line">    <span class="comment">//向该对象设置欧拉表，这个对象可以将欧拉角转换成四元数</span></span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);<span class="comment">//欧拉角的单位是弧度</span></span><br><span class="line">    tfs.transform.rotation.x=qtn.<span class="built_in">getX</span>();</span><br><span class="line">    tfs.transform.rotation.y=qtn.<span class="built_in">getY</span>();</span><br><span class="line">    tfs.transform.rotation.z=qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    tfs.transform.rotation.w=qtn.<span class="built_in">getW</span>();</span><br><span class="line">    pub.<span class="built_in">sendTransform</span>(tfs);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="订阅方-5"><a href="#订阅方-5" class="headerlink" title="订阅方"></a>订阅方</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_listener.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/buffer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/PointStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_geometry_msgs/tf2_geometry_msgs.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    订阅方实现:订阅发布的坐标系相对关系，传入一个座标点，调用tf实现转换</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.设置编码，节点初始化 NodeHandle(必须的)</span></span><br><span class="line"><span class="comment">        3.创建订阅对象----》订阅坐标系相对关系</span></span><br><span class="line"><span class="comment">        4.组织座标点数据</span></span><br><span class="line"><span class="comment">        5.转换算法，需要调用tf内置实现</span></span><br><span class="line"><span class="comment">        6.最后输出</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>  *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;static_sub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//创建订阅对象</span></span><br><span class="line">    <span class="comment">//3—1.创建一个buffer缓存</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="comment">//3-2在创建监听对象(监听对象可以将订阅的数据存入buffer)</span></span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    geometry_msgs::PointStamped ps;</span><br><span class="line">    ps.header.frame_id = <span class="string">&quot;laser&quot;</span>;</span><br><span class="line">    ps.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    ps.point.x = <span class="number">2.0</span>;</span><br><span class="line">    ps.point.y = <span class="number">3.0</span>;</span><br><span class="line">    ps.point.z = <span class="number">5.0</span>;</span><br><span class="line">    <span class="comment">//转换算法</span></span><br><span class="line">    <span class="comment">//添加休眠</span></span><br><span class="line">    <span class="comment">// ros::Duration(2).sleep();</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//核心代码实现  ----将ps转换成相对于base_link的座标点</span></span><br><span class="line">        geometry_msgs::PointStamped ps_out;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">            调用了buffer的转换函数transform</span></span><br><span class="line"><span class="comment">            参数1：被转换的坐标点</span></span><br><span class="line"><span class="comment">            参数2：目标坐标系</span></span><br><span class="line"><span class="comment">            返回值：输出的坐标点</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            ps1:调用时必须包含头文件 tf2_geometry_msgs/tf2_geometry_msgs.h</span></span><br><span class="line"><span class="comment">            ps2：运行时存在的问题，抛出一个异常base_link不存在</span></span><br><span class="line"><span class="comment">                原因：订阅数据是耗时操作，可能在调用transform转换函数时，坐标系的相对关系还没有订阅到，因此出现异常</span></span><br><span class="line"><span class="comment">                解决：</span></span><br><span class="line"><span class="comment">                    方案1：在调用转换函数前执行休眠</span></span><br><span class="line"><span class="comment">                    方案2：异常处理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/* code */</span></span><br><span class="line">            ps_out = buffer.<span class="built_in">transform</span>(ps,<span class="string">&quot;base_link&quot;</span>);</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;转换后的坐标值：(%.2f,%.2f,%.2f),参考的坐标系:%s&quot;</span>,</span><br><span class="line">            ps_out.point.x,</span><br><span class="line">            ps_out.point.y,</span><br><span class="line">            ps_out.point.z,</span><br><span class="line">            ps_out.header.frame_id.<span class="built_in">c_str</span>());</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// std::cerr &lt;&lt; e.what() &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;异常消息：%s&quot;</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();    </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python实现-7"><a href="#python实现-7" class="headerlink" title="python实现"></a>python实现</h4><h5 id="发布方-6"><a href="#发布方-6" class="headerlink" title="发布方"></a>发布方</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">import</span> tf_conversions</span><br><span class="line"><span class="keyword">import</span> tf</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    发布方：发布两个坐标系的相对关系(车辆底盘 ---base_link和雷达 ---laser)</span></span><br><span class="line"><span class="string">    流程：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化ros节点</span></span><br><span class="line"><span class="string">        3.创建发布对象</span></span><br><span class="line"><span class="string">        4.组织被发布的数据</span></span><br><span class="line"><span class="string">        5.发布数据</span></span><br><span class="line"><span class="string">        6.spin()</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;static_pub_p&quot;</span>)</span><br><span class="line">    pub = tf2_ros.StaticTransformBroadcaster()</span><br><span class="line">    ts = TransformStamped()</span><br><span class="line">    <span class="comment">#header</span></span><br><span class="line">    ts.header.stamp = rospy.Time.now()</span><br><span class="line">    ts.header.frame_id = <span class="string">&quot;base_link&quot;</span></span><br><span class="line">    <span class="comment">#child frame</span></span><br><span class="line">    ts.child_frame_id = <span class="string">&quot;laser&quot;</span></span><br><span class="line">    <span class="comment">#相对关系(偏移与四元数)</span></span><br><span class="line">    ts.transform.translation.x = <span class="number">0.2</span></span><br><span class="line">    ts.transform.translation.y = <span class="number">0.0</span></span><br><span class="line">    ts.transform.translation.z = <span class="number">0.5</span></span><br><span class="line">    <span class="comment">#4.1先从欧拉角转化成四元数</span></span><br><span class="line">    qtn = tf_conversions.transformations.quaternion_from_euler(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">    <span class="comment">#4.2再设置四元数</span></span><br><span class="line">    ts.transform.rotation.x = qtn[<span class="number">0</span>]</span><br><span class="line">    ts.transform.rotation.y = qtn[<span class="number">1</span>]</span><br><span class="line">    ts.transform.rotation.z = qtn[<span class="number">2</span>]</span><br><span class="line">    ts.transform.rotation.w = qtn[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    pub.sendTransform(ts)</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="订阅方-6"><a href="#订阅方-6" class="headerlink" title="订阅方"></a>订阅方</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># from ast import Expression</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> tf2_geometry_msgs</span><br><span class="line"><span class="comment"># from tf2_geometry_msgs import PointStamped</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    订阅方实现:订阅坐标变换，传入被转换的坐标点，调用转换算法</span></span><br><span class="line"><span class="string">    流程：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化</span></span><br><span class="line"><span class="string">        3.创建订阅对象</span></span><br><span class="line"><span class="string">        4.组织被转换的坐标点</span></span><br><span class="line"><span class="string">        5.转换逻辑实现,调用tf封装的算法</span></span><br><span class="line"><span class="string">        6.输出结果</span></span><br><span class="line"><span class="string">        7.spin()|spinonce()</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;static_sub_p&quot;</span>)</span><br><span class="line">    <span class="comment">#创建订阅对象</span></span><br><span class="line">    <span class="comment">#3-1.创建缓存对象</span></span><br><span class="line">    buffer = tf2_ros.Buffer()</span><br><span class="line">    <span class="comment">#3-2.创建订阅对象(将缓存传入)</span></span><br><span class="line">    sub = tf2_ros.TransformListener(buffer)</span><br><span class="line">    ps = tf2_geometry_msgs.PointStamped()</span><br><span class="line">    ps.header.stamp = rospy.Time.now()</span><br><span class="line">    ps.header.frame_id = <span class="string">&quot;laser&quot;</span></span><br><span class="line">    ps.point.x = <span class="number">2.0</span></span><br><span class="line">    ps.point.y = <span class="number">3.0</span></span><br><span class="line">    ps.point.z = <span class="number">5.0</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        <span class="comment">#转换实现</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ps_out = buffer.transform(ps,<span class="string">&quot;base_link&quot;</span>)</span><br><span class="line">                </span><br><span class="line">            rospy.loginfo(<span class="string">&quot;转换后的坐标：(%.2f,%.2f,%.2f),参考的坐标系：%s&quot;</span>,</span><br><span class="line">                    ps_out.point.x,</span><br><span class="line">                    ps_out.point.y,</span><br><span class="line">                    ps_out.point.z,</span><br><span class="line">                    ps_out.header.frame_id)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logwarn(<span class="string">&quot;错误提示：%s&quot;</span>, e)</span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="动态坐标变换"><a href="#动态坐标变换" class="headerlink" title="动态坐标变换"></a>动态坐标变换</h3><h4 id="c-实现-8"><a href="#c-实现-8" class="headerlink" title="c++实现"></a>c++实现</h4><h5 id="发布方-7"><a href="#发布方-7" class="headerlink" title="发布方"></a>发布方</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_broadcaster.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2/LinearMath/Quaternion.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    发布方实现：需要订阅乌龟的位姿信息，转换成相对于窗体的坐标关系，并发布</span></span><br><span class="line"><span class="comment">    准备：</span></span><br><span class="line"><span class="comment">        话题：/turtle1/pose</span></span><br><span class="line"><span class="comment">        消息：/turtlesim/Pose</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.设置编码，初始化，nodehandel创建</span></span><br><span class="line"><span class="comment">        3.创建订阅对象，订阅/turtle1/pose</span></span><br><span class="line"><span class="comment">        4.回调函数处理订阅的消息，将位姿信息转换成坐标相关关系并发布(关注)</span></span><br><span class="line"><span class="comment">        5.spin()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPose</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr&amp; pose)</span></span>&#123;</span><br><span class="line">    <span class="comment">//获取位姿信息，转换成坐标系相对关系(核心)，并发布</span></span><br><span class="line">    <span class="comment">//a.创建发布对象</span></span><br><span class="line">    <span class="type">static</span> tf2_ros::TransformBroadcaster pub;</span><br><span class="line">    <span class="comment">//b.组织被发布的数据</span></span><br><span class="line">    geometry_msgs::TransformStamped ts;</span><br><span class="line">    ts.header.frame_id = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    ts.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    ts.child_frame_id = <span class="string">&quot;turtle1&quot;</span>;</span><br><span class="line">    <span class="comment">//坐标系偏移量</span></span><br><span class="line">    ts.transform.translation.x = pose-&gt;x;</span><br><span class="line">    ts.transform.translation.y = pose-&gt;y;</span><br><span class="line">    ts.transform.translation.z = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//坐标系四元数</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        位姿信息中没有四元数，但是有偏航角度，又已知乌龟是2D，没有翻滚与俯仰角度，所以可以得出乌龟的欧拉角0，0，theta</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    tf2::Quaternion qtn;</span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>, <span class="number">0</span>, pose-&gt;theta);</span><br><span class="line">    ts.transform.rotation.x = qtn.<span class="built_in">getX</span>();</span><br><span class="line">    ts.transform.rotation.y = qtn.<span class="built_in">getY</span>();</span><br><span class="line">    ts.transform.rotation.z = qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    ts.transform.rotation.w = qtn.<span class="built_in">getW</span>();</span><br><span class="line">    pub.<span class="built_in">sendTransform</span>(ts);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;dynamic_pub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">&quot;turtle1/pose&quot;</span>,<span class="number">100</span>,doPose);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="订阅方-7"><a href="#订阅方-7" class="headerlink" title="订阅方"></a>订阅方</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_listener.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/buffer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/PointStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_geometry_msgs/tf2_geometry_msgs.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    订阅方实现:订阅发布的坐标系相对关系，传入一个座标点，调用tf实现转换</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.设置编码，节点初始化 NodeHandle(必须的)</span></span><br><span class="line"><span class="comment">        3.创建订阅对象----》订阅坐标系相对关系</span></span><br><span class="line"><span class="comment">        4.组织座标点数据</span></span><br><span class="line"><span class="comment">        5.转换算法，需要调用tf内置实现</span></span><br><span class="line"><span class="comment">        6.最后输出</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>  *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;static_sub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//创建订阅对象</span></span><br><span class="line">    <span class="comment">//3—1.创建一个buffer缓存</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="comment">//3-2在创建监听对象(监听对象可以将订阅的数据存入buffer)</span></span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    geometry_msgs::PointStamped ps;</span><br><span class="line">    <span class="comment">//参考的坐标系</span></span><br><span class="line">    ps.header.frame_id = <span class="string">&quot;turtle1&quot;</span>;</span><br><span class="line">    <span class="comment">//时间戳</span></span><br><span class="line">    ps.header.stamp = ros::<span class="built_in">Time</span>(<span class="number">0.0</span>);</span><br><span class="line">    ps.point.x = <span class="number">2.0</span>;</span><br><span class="line">    ps.point.y = <span class="number">3.0</span>;</span><br><span class="line">    ps.point.z = <span class="number">5.0</span>;</span><br><span class="line">    <span class="comment">//转换算法</span></span><br><span class="line">    <span class="comment">//添加休眠</span></span><br><span class="line">    <span class="comment">// ros::Duration(2).sleep();</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//核心代码实现  ----将ps转换成相对于base_link的座标点</span></span><br><span class="line">        geometry_msgs::PointStamped ps_out;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">            调用了buffer的转换函数transform</span></span><br><span class="line"><span class="comment">            参数1：被转换的坐标点</span></span><br><span class="line"><span class="comment">            参数2：目标坐标系</span></span><br><span class="line"><span class="comment">            返回值：输出的坐标点</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            ps1:调用时必须包含头文件 tf2_geometry_msgs/tf2_geometry_msgs.h</span></span><br><span class="line"><span class="comment">            ps2：运行时存在的问题，抛出一个异常base_link不存在</span></span><br><span class="line"><span class="comment">                原因：订阅数据是耗时操作，可能在调用transform转换函数时，坐标系的相对关系还没有订阅到，因此出现异常</span></span><br><span class="line"><span class="comment">                解决：</span></span><br><span class="line"><span class="comment">                    方案1：在调用转换函数前执行休眠</span></span><br><span class="line"><span class="comment">                    方案2：异常处理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/* code */</span></span><br><span class="line">            ps_out = buffer.<span class="built_in">transform</span>(ps,<span class="string">&quot;world&quot;</span>);</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;转换后的坐标值：(%.2f,%.2f,%.2f),参考的坐标系:%s&quot;</span>,</span><br><span class="line">            ps_out.point.x,</span><br><span class="line">            ps_out.point.y,</span><br><span class="line">            ps_out.point.z,</span><br><span class="line">            ps_out.header.frame_id.<span class="built_in">c_str</span>());</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// std::cerr &lt;&lt; e.what() &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;异常消息：%s&quot;</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();    </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python实现-8"><a href="#python实现-8" class="headerlink" title="python实现"></a>python实现</h4><h5 id="订阅方-8"><a href="#订阅方-8" class="headerlink" title="订阅方"></a>订阅方</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"><span class="keyword">import</span> tf_conversions</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    发布方：订阅乌龟的位姿信息，转换成坐标系的相对关系，再发布</span></span><br><span class="line"><span class="string">    准备：</span></span><br><span class="line"><span class="string">        话题:/turtle1/pose</span></span><br><span class="line"><span class="string">        类型：/turtlesim/Pose</span></span><br><span class="line"><span class="string">    流程：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化ros节点</span></span><br><span class="line"><span class="string">        3.创建订阅对象</span></span><br><span class="line"><span class="string">        4.回调函数处理订阅到的消息(核心)</span></span><br><span class="line"><span class="string">        5.spin()</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doPose</span>(<span class="params">pose</span>):</span><br><span class="line">    <span class="comment">#创建发布坐标系相对关系的对象</span></span><br><span class="line">    pub = tf2_ros.TransformBroadcaster()</span><br><span class="line">    <span class="comment">#将pose位姿信息转化为坐标系相关关系消息</span></span><br><span class="line">    ts = TransformStamped()</span><br><span class="line">    ts.header.frame_id = <span class="string">&quot;world&quot;</span></span><br><span class="line">    ts.header.stamp = rospy.Time.now()</span><br><span class="line">    ts.child_frame_id = <span class="string">&quot;turtle1&quot;</span></span><br><span class="line">    <span class="comment"># 子级坐标系相对于父级坐标系的偏移量</span></span><br><span class="line">    ts.transform.translation.x = pose.x</span><br><span class="line">    ts.transform.translation.y = pose.y</span><br><span class="line">    ts.transform.translation.z = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 四元数</span></span><br><span class="line">    <span class="comment"># 从欧拉角转换四元数</span></span><br><span class="line">    qtn = tf_conversions.transformations.quaternion_from_euler(<span class="number">0</span>,<span class="number">0</span>,pose.theta)</span><br><span class="line">    ts.transform.rotation.x = qtn[<span class="number">0</span>]</span><br><span class="line">    ts.transform.rotation.y = qtn[<span class="number">1</span>]</span><br><span class="line">    ts.transform.rotation.z = qtn[<span class="number">2</span>]</span><br><span class="line">    ts.transform.rotation.w = qtn[<span class="number">3</span>]</span><br><span class="line">    <span class="comment">#发布</span></span><br><span class="line">    pub.sendTransform(ts)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.初始化ros节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;dynamic_pub_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 2.创建订阅对象</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;/turtle1/pose&quot;</span>,Pose,doPose,queue_size=<span class="number">100</span>)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure><h5 id="订阅方-9"><a href="#订阅方-9" class="headerlink" title="订阅方"></a>订阅方</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># from ast import Expression</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> tf2_geometry_msgs</span><br><span class="line"><span class="comment"># from tf2_geometry_msgs import PointStamped</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    订阅方实现:订阅坐标变换，传入被转换的坐标点，调用转换算法</span></span><br><span class="line"><span class="string">    流程：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化</span></span><br><span class="line"><span class="string">        3.创建订阅对象</span></span><br><span class="line"><span class="string">        4.组织被转换的坐标点</span></span><br><span class="line"><span class="string">        5.转换逻辑实现,调用tf封装的算法</span></span><br><span class="line"><span class="string">        6.输出结果</span></span><br><span class="line"><span class="string">        7.spin()|spinonce()</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;static_sub_p&quot;</span>)</span><br><span class="line">    <span class="comment">#创建订阅对象</span></span><br><span class="line">    <span class="comment">#3-1.创建缓存对象</span></span><br><span class="line">    buffer = tf2_ros.Buffer()</span><br><span class="line">    <span class="comment">#3-2.创建订阅对象(将缓存传入)</span></span><br><span class="line">    sub = tf2_ros.TransformListener(buffer)</span><br><span class="line">    ps = tf2_geometry_msgs.PointStamped()</span><br><span class="line">    <span class="comment">#时间戳 ---0</span></span><br><span class="line">    ps.header.stamp = rospy.Time()</span><br><span class="line">    ps.header.frame_id = <span class="string">&quot;turtle1&quot;</span></span><br><span class="line">    ps.point.x = <span class="number">2.0</span></span><br><span class="line">    ps.point.y = <span class="number">3.0</span></span><br><span class="line">    ps.point.z = <span class="number">5.0</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        <span class="comment">#转换实现</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ps_out = buffer.transform(ps,<span class="string">&quot;world&quot;</span>)</span><br><span class="line">                </span><br><span class="line">            rospy.loginfo(<span class="string">&quot;转换后的坐标：(%.2f,%.2f,%.2f),参考的坐标系：%s&quot;</span>,</span><br><span class="line">                    ps_out.point.x,</span><br><span class="line">                    ps_out.point.y,</span><br><span class="line">                    ps_out.point.z,</span><br><span class="line">                    ps_out.header.frame_id)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logwarn(<span class="string">&quot;错误提示：%s&quot;</span>, e)</span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="多坐标变换"><a href="#多坐标变换" class="headerlink" title="多坐标变换"></a>多坐标变换</h3><h4 id="c-10"><a href="#c-10" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_listener.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/buffer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/PointStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_geometry_msgs/tf2_geometry_msgs.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    订阅方实现:1.计算son1与son2的相对关系 2.计算son1中的某个坐标点在son2中的坐标值</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.编码， 初始化 NodeHandle</span></span><br><span class="line"><span class="comment">        3.创建订阅对象</span></span><br><span class="line"><span class="comment">        4.编写解析逻辑</span></span><br><span class="line"><span class="comment">        5.spinOnce()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 2.编码， 初始化 NodeHandle</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;tfs_sub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//     3.创建订阅对象</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">sub</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="comment">//     4.编写解析逻辑</span></span><br><span class="line">    <span class="comment">// 创建坐标点</span></span><br><span class="line">    geometry_msgs::PointStamped psAtSon1;</span><br><span class="line"></span><br><span class="line">    psAtSon1.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    psAtSon1.header.frame_id = <span class="string">&quot;son1&quot;</span>;</span><br><span class="line">    psAtSon1.point.x = <span class="number">1.0</span>;</span><br><span class="line">    psAtSon1.point.y = <span class="number">2.0</span>;</span><br><span class="line">    psAtSon1.point.z = <span class="number">3.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//核心实现</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/* </span></span><br><span class="line"><span class="comment">            A相对于B的坐标系关系</span></span><br><span class="line"><span class="comment">                参数1：目标坐标系</span></span><br><span class="line"><span class="comment">                参数2：源坐标系</span></span><br><span class="line"><span class="comment">                参数3：ros::Time(0)取间隔最短的两个关系帧计算相对关系</span></span><br><span class="line"><span class="comment">                返回值：geometry_msgs::TransformStamped源相对于坐标系的相对关系</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="comment">// 计算son1与son2的相对关系</span></span><br><span class="line">            geometry_msgs::TransformStamped son1Toson2 = buffer.<span class="built_in">lookupTransform</span>(<span class="string">&quot;son2&quot;</span>,<span class="string">&quot;son1&quot;</span>,ros::<span class="built_in">Time</span>(<span class="number">0</span>));</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;son1 相对于son2的信息:父级:%s,子级:%s,偏移量(%.2f,%.2f,%.2f)&quot;</span>,</span><br><span class="line">                son1Toson2.header.frame_id.<span class="built_in">c_str</span>(),</span><br><span class="line">                son1Toson2.child_frame_id.<span class="built_in">c_str</span>(),</span><br><span class="line">                son1Toson2.transform.translation.x,</span><br><span class="line">                son1Toson2.transform.translation.y,</span><br><span class="line">                son1Toson2.transform.translation.z</span><br><span class="line">                );</span><br><span class="line">            <span class="comment">// 计算son1中的某个坐标点在son2中的坐标值</span></span><br><span class="line">            geometry_msgs::PointStamped psAtSon2 = buffer.<span class="built_in">transform</span>(psAtSon1,<span class="string">&quot;son2&quot;</span>);</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;坐标点在son2中的值(%.2f,%.2f,%.2f)&quot;</span>,</span><br><span class="line">                psAtSon2.point.x, psAtSon2.point.y, psAtSon2.point.z);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;错误提示：%s&quot;</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//     5.spinOnce()</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="python-10"><a href="#python-10" class="headerlink" title="python"></a>python</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> tf2_geometry_msgs</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"><span class="comment"># from tf2_geometry_msgs import PointStamped</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;static_sub_p&quot;</span>)</span><br><span class="line">    <span class="comment">#创建订阅对象</span></span><br><span class="line">    <span class="comment">#3-1.创建缓存对象</span></span><br><span class="line">    buffer = tf2_ros.Buffer()</span><br><span class="line">    <span class="comment">#3-2.创建订阅对象(将缓存传入)</span></span><br><span class="line">    sub = tf2_ros.TransformListener(buffer)</span><br><span class="line">    ps = tf2_geometry_msgs.PointStamped()</span><br><span class="line">    <span class="comment">#时间戳 ---0</span></span><br><span class="line">    ps.header.stamp = rospy.Time()</span><br><span class="line">    ps.header.frame_id = <span class="string">&quot;son1&quot;</span></span><br><span class="line">    ps.point.x = <span class="number">1.0</span></span><br><span class="line">    ps.point.y = <span class="number">2.0</span></span><br><span class="line">    ps.point.z = <span class="number">3.0</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        <span class="comment">#转换实现</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#计算son1相对于son2的坐标关系</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">                参数1:目标坐标系</span></span><br><span class="line"><span class="string">                参数2:源坐标系</span></span><br><span class="line"><span class="string">                参数3:rospy.Time(0) --- 取时间间隔最近的两个坐标系帧(son1相对world与son2相对world)</span></span><br><span class="line"><span class="string">                返回值:son1与son2的坐标系关系</span></span><br><span class="line"><span class="string">             &quot;&quot;&quot;</span></span><br><span class="line">            ts = buffer.lookup_transform(<span class="string">&quot;son2&quot;</span>,<span class="string">&quot;son1&quot;</span>,rospy.Time(<span class="number">0</span>))</span><br><span class="line">            rospy.loginfo(<span class="string">&quot;父级坐标系:%s,子级坐标系：%s,偏移量(%.2f,%.2f,%.2f)&quot;</span>,</span><br><span class="line">                ts.header.frame_id,</span><br><span class="line">                ts.child_frame_id,</span><br><span class="line">                ts.transform.translation.x,</span><br><span class="line">                ts.transform.translation.y,</span><br><span class="line">                ts.transform.translation.z</span><br><span class="line">                )</span><br><span class="line">            ps_out = buffer.transform(ps,<span class="string">&quot;son2&quot;</span>)</span><br><span class="line">                </span><br><span class="line">            rospy.loginfo(<span class="string">&quot;转换后的坐标：(%.2f,%.2f,%.2f),参考的坐标系：%s&quot;</span>,</span><br><span class="line">                    ps_out.point.x,</span><br><span class="line">                    ps_out.point.y,</span><br><span class="line">                    ps_out.point.z,</span><br><span class="line">                    ps_out.header.frame_id)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logwarn(<span class="string">&quot;错误提示：%s&quot;</span>, e)</span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="坐标系关系查看"><a href="#坐标系关系查看" class="headerlink" title="坐标系关系查看"></a>坐标系关系查看</h3><p>在运行坐标系的代码后，执行rosrun tf2_tools *.py，evince *.pdf</p><h3 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h3><h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><h5 id="生成新乌龟"><a href="#生成新乌龟" class="headerlink" title="生成新乌龟"></a>生成新乌龟</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Spawn.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：向服务端发送请求，生成一只新乌龟</span></span><br><span class="line"><span class="comment">        话题：/spawn</span></span><br><span class="line"><span class="comment">        消息：turtlesin/Spawn</span></span><br><span class="line"><span class="comment">    1.包含头文件</span></span><br><span class="line"><span class="comment">    2.初始化ros节点</span></span><br><span class="line"><span class="comment">    3.创建节点句柄</span></span><br><span class="line"><span class="comment">    4.创建客户端对象</span></span><br><span class="line"><span class="comment">    5.组织数据并发送</span></span><br><span class="line"><span class="comment">    6.处理响应</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;service_call&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::ServiceClient client = nh.<span class="built_in">serviceClient</span>&lt;turtlesim::Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">    turtlesim::Spawn spawn;</span><br><span class="line">    <span class="comment">//组织请求数据</span></span><br><span class="line">    spawn.request.x = <span class="number">1.0</span>;</span><br><span class="line">    spawn.request.y = <span class="number">4.0</span>;</span><br><span class="line">    spawn.request.theta = <span class="number">1.57</span>;</span><br><span class="line">    spawn.request.name = <span class="string">&quot;turtle2&quot;</span>;</span><br><span class="line">    <span class="comment">//发送请求</span></span><br><span class="line">    <span class="comment">//判断服务器状态</span></span><br><span class="line">    <span class="comment">// ros::service::waitForService(&quot;/spawn&quot;);</span></span><br><span class="line">    client.<span class="built_in">waitForExistence</span>();</span><br><span class="line">    <span class="type">bool</span> flag = client.<span class="built_in">call</span>(spawn);<span class="comment">//flag是用来接收响应状态的，响应结果也会被设置进spawn对象</span></span><br><span class="line">    <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;乌龟生成成功，新乌龟叫:%s&quot;</span>,spawn.response.name.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;请求失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="坐标发布"><a href="#坐标发布" class="headerlink" title="坐标发布"></a>坐标发布</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_broadcaster.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2/LinearMath/Quaternion.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    发布方实现：需要订阅乌龟的位姿信息，转换成相对于窗体的坐标关系，并发布</span></span><br><span class="line"><span class="comment">    准备：</span></span><br><span class="line"><span class="comment">        话题：/turtle1/pose</span></span><br><span class="line"><span class="comment">        消息：/turtlesim/Pose</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.设置编码，初始化，nodehandel创建</span></span><br><span class="line"><span class="comment">        3.创建订阅对象，订阅/turtle1/pose</span></span><br><span class="line"><span class="comment">        4.回调函数处理订阅的消息，将位姿信息转换成坐标相关关系并发布(关注)</span></span><br><span class="line"><span class="comment">        5.spin()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//声明变量接收传递的参数</span></span><br><span class="line">std::string turtle_name;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPose</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr&amp; pose)</span></span>&#123;</span><br><span class="line">    <span class="comment">//获取位姿信息，转换成坐标系相对关系(核心)，并发布</span></span><br><span class="line">    <span class="comment">//a.创建发布对象</span></span><br><span class="line">    <span class="type">static</span> tf2_ros::TransformBroadcaster pub;</span><br><span class="line">    <span class="comment">//b.组织被发布的数据</span></span><br><span class="line">    geometry_msgs::TransformStamped ts;</span><br><span class="line">    ts.header.frame_id = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    ts.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    <span class="comment">//关键点2动态传入</span></span><br><span class="line">    ts.child_frame_id = turtle_name;</span><br><span class="line">    <span class="comment">// ts.child_frame_id = &quot;turtle1&quot;;</span></span><br><span class="line">    <span class="comment">//坐标系偏移量</span></span><br><span class="line">    ts.transform.translation.x = pose-&gt;x;</span><br><span class="line">    ts.transform.translation.y = pose-&gt;y;</span><br><span class="line">    ts.transform.translation.z = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//坐标系四元数</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        位姿信息中没有四元数，但是有偏航角度，又已知乌龟是2D，没有翻滚与俯仰角度，所以可以得出乌龟的欧拉角0，0，theta</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    tf2::Quaternion qtn;</span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>, <span class="number">0</span>, pose-&gt;theta);</span><br><span class="line">    ts.transform.rotation.x = qtn.<span class="built_in">getX</span>();</span><br><span class="line">    ts.transform.rotation.y = qtn.<span class="built_in">getY</span>();</span><br><span class="line">    ts.transform.rotation.z = qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    ts.transform.rotation.w = qtn.<span class="built_in">getW</span>();</span><br><span class="line">    pub.<span class="built_in">sendTransform</span>(ts);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;dynamic_pub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh; </span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        解析launch文件通过args传入的参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;清传入一个参数&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        turtle_name = argv[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//关键点1：订阅的话题名称，turtle1/turtle2</span></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(turtle_name + <span class="string">&quot;/pose&quot;</span>,<span class="number">100</span>,doPose);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="速度"><a href="#速度" class="headerlink" title="速度"></a>速度</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_listener.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/buffer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/PointStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_geometry_msgs/tf2_geometry_msgs.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/Twist.h&quot;</span></span></span><br><span class="line"><span class="comment">// #include &quot;geometry_msgs/&quot;</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：换算出turtle1相对于turtle2的关系</span></span><br><span class="line"><span class="comment">    需求2：计算角速度和线速度并发布</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 2.编码， 初始化 NodeHandle</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;tfs_sub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//     3.创建订阅对象</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">sub</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="comment">//1.创建发布对象</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle2/cmd_vel&quot;</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="comment">//     4.编写解析逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//核心实现</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/* </span></span><br><span class="line"><span class="comment">            A相对于B的坐标系关系</span></span><br><span class="line"><span class="comment">                参数1：目标坐标系</span></span><br><span class="line"><span class="comment">                参数2：源坐标系</span></span><br><span class="line"><span class="comment">                参数3：ros::Time(0)取间隔最短的两个关系帧计算相对关系</span></span><br><span class="line"><span class="comment">                返回值：geometry_msgs::TransformStamped源相对于坐标系的相对关系</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="comment">// 计算son1与son2的相对关系</span></span><br><span class="line">            geometry_msgs::TransformStamped son1Toson2 = buffer.<span class="built_in">lookupTransform</span>(<span class="string">&quot;turtle2&quot;</span>,<span class="string">&quot;turtle1&quot;</span>,ros::<span class="built_in">Time</span>(<span class="number">0</span>));</span><br><span class="line">            <span class="comment">// ROS_INFO(&quot;turtle1 相对于turtle2的信息:父级:%s,子级:%s,偏移量(%.2f,%.2f,%.2f)&quot;,</span></span><br><span class="line">            <span class="comment">//     son1Toson2.header.frame_id.c_str(),</span></span><br><span class="line">            <span class="comment">//     son1Toson2.child_frame_id.c_str(),</span></span><br><span class="line">            <span class="comment">//     son1Toson2.transform.translation.x,</span></span><br><span class="line">            <span class="comment">//     son1Toson2.transform.translation.y,</span></span><br><span class="line">            <span class="comment">//     son1Toson2.transform.translation.z</span></span><br><span class="line">            <span class="comment">//     );</span></span><br><span class="line">            <span class="comment">// 2.根据相对计算并组织速度消息</span></span><br><span class="line">            geometry_msgs::Twist twist;</span><br><span class="line">            <span class="comment">/* </span></span><br><span class="line"><span class="comment">                组织速度只需要设置线速度的x与角速度的z</span></span><br><span class="line"><span class="comment">                x=系数*sqrt(y^2+x^2)</span></span><br><span class="line"><span class="comment">                z=系数*反正切(对边，邻边)</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            twist.linear.x =<span class="number">0.5</span>*<span class="built_in">sqrt</span>(<span class="built_in">pow</span>(son1Toson2.transform.translation.x,<span class="number">2</span>)+<span class="built_in">pow</span>(son1Toson2.transform.translation.y,<span class="number">2</span>));</span><br><span class="line">            twist.angular.z =<span class="number">4</span>*<span class="built_in">atan2</span>(son1Toson2.transform.translation.y,son1Toson2.transform.translation.x);</span><br><span class="line">            <span class="comment">// 3.发布</span></span><br><span class="line">            pub.<span class="built_in">publish</span>(twist);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;错误提示：%s&quot;</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//     5.spinOnce()</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-11"><a href="#python-11" class="headerlink" title="python"></a>python</h4><h5 id="生成新乌龟-1"><a href="#生成新乌龟-1" class="headerlink" title="生成新乌龟"></a>生成新乌龟</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.srv <span class="keyword">import</span> Spawn,SpawnRequest,SpawnResponse</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    需求：向参数服务器发送请求生成一只乌龟</span></span><br><span class="line"><span class="string">        话题：/spawn</span></span><br><span class="line"><span class="string">        消息:turtlesim/Spawn</span></span><br><span class="line"><span class="string">    1.导包</span></span><br><span class="line"><span class="string">    2.初始化ros节点</span></span><br><span class="line"><span class="string">    3.创建服务的客户端对象</span></span><br><span class="line"><span class="string">    4.组织数据并发送请求</span></span><br><span class="line"><span class="string">    5.处理响应结果</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;service_call_p&quot;</span>)</span><br><span class="line">    client = rospy.ServiceProxy(<span class="string">&quot;/spawn&quot;</span>,Spawn)</span><br><span class="line">    request = SpawnRequest()</span><br><span class="line">    request.x = <span class="number">4.5</span></span><br><span class="line">    request.y = <span class="number">2.0</span></span><br><span class="line">    request.theta = -<span class="number">3</span></span><br><span class="line">    request.name = <span class="string">&quot;turtle2&quot;</span></span><br><span class="line">    client.wait_for_service()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = client.call(request)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;生成乌龟的名字叫%s&quot;</span>,response.name)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;请求处理失败&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="速度发布"><a href="#速度发布" class="headerlink" title="速度发布"></a>速度发布</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"><span class="keyword">import</span> tf_conversions</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    发布方：订阅乌龟的位姿信息，转换成坐标系的相对关系，再发布</span></span><br><span class="line"><span class="string">    准备：</span></span><br><span class="line"><span class="string">        话题:/turtle1/pose</span></span><br><span class="line"><span class="string">        类型：/turtlesim/Pose</span></span><br><span class="line"><span class="string">    流程：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化ros节点</span></span><br><span class="line"><span class="string">        3.创建订阅对象</span></span><br><span class="line"><span class="string">        4.回调函数处理订阅到的消息(核心)</span></span><br><span class="line"><span class="string">        5.spin()</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#接受乌龟名称的遍历</span></span><br><span class="line">turtle_name = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doPose</span>(<span class="params">pose</span>):</span><br><span class="line">    <span class="comment">#创建发布坐标系相对关系的对象</span></span><br><span class="line">    pub = tf2_ros.TransformBroadcaster()</span><br><span class="line">    <span class="comment">#将pose位姿信息转化为坐标系相关关系消息</span></span><br><span class="line">    ts = TransformStamped()</span><br><span class="line">    ts.header.frame_id = <span class="string">&quot;world&quot;</span></span><br><span class="line">    ts.header.stamp = rospy.Time.now()</span><br><span class="line">    ts.child_frame_id = turtle_name</span><br><span class="line">    <span class="comment"># 子级坐标系相对于父级坐标系的偏移量</span></span><br><span class="line">    ts.transform.translation.x = pose.x</span><br><span class="line">    ts.transform.translation.y = pose.y</span><br><span class="line">    ts.transform.translation.z = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 四元数</span></span><br><span class="line">    <span class="comment"># 从欧拉角转换四元数</span></span><br><span class="line">    qtn = tf_conversions.transformations.quaternion_from_euler(<span class="number">0</span>,<span class="number">0</span>,pose.theta)</span><br><span class="line">    ts.transform.rotation.x = qtn[<span class="number">0</span>]</span><br><span class="line">    ts.transform.rotation.y = qtn[<span class="number">1</span>]</span><br><span class="line">    ts.transform.rotation.z = qtn[<span class="number">2</span>]</span><br><span class="line">    ts.transform.rotation.w = qtn[<span class="number">3</span>]</span><br><span class="line">    <span class="comment">#发布</span></span><br><span class="line">    pub.sendTransform(ts)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.初始化ros节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;dynamic_pub_p&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#解析传入的参数(现在传入几个参数? 文件全路径+传入的参数+节点名称+日志文件路径)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">4</span>:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;参数个数不对&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        turtle_name = sys.argv[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># 2.创建订阅对象</span></span><br><span class="line">    sub = rospy.Subscriber(turtle_name + <span class="string">&quot;/pose&quot;</span>,Pose,doPose,queue_size=<span class="number">100</span>)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure><h5 id="速度-1"><a href="#速度-1" class="headerlink" title="速度"></a>速度</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> tf2_geometry_msgs</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped,Twist</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;static_sub_p&quot;</span>)</span><br><span class="line">    <span class="comment">#创建订阅对象</span></span><br><span class="line">    <span class="comment">#3-1.创建缓存对象</span></span><br><span class="line">    buffer = tf2_ros.Buffer()</span><br><span class="line">    <span class="comment">#3-2.创建订阅对象(将缓存传入)</span></span><br><span class="line">    sub = tf2_ros.TransformListener(buffer)</span><br><span class="line">    <span class="comment">#创建速度消息发布对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;/turtle2/cmd_vel&quot;</span>,Twist,queue_size=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        <span class="comment">#转换实现</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#计算son1相对于son2的坐标关系</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">                参数1:目标坐标系</span></span><br><span class="line"><span class="string">                参数2:源坐标系</span></span><br><span class="line"><span class="string">                参数3:rospy.Time(0) --- 取时间间隔最近的两个坐标系帧(son1相对world与son2相对world)</span></span><br><span class="line"><span class="string">                返回值:son1与son2的坐标系关系</span></span><br><span class="line"><span class="string">             &quot;&quot;&quot;</span></span><br><span class="line">            ts = buffer.lookup_transform(<span class="string">&quot;turtle2&quot;</span>,<span class="string">&quot;turtle1&quot;</span>,rospy.Time(<span class="number">0</span>))</span><br><span class="line">            rospy.loginfo(<span class="string">&quot;父级坐标系:%s,子级坐标系：%s,偏移量(%.2f,%.2f,%.2f)&quot;</span>,</span><br><span class="line">                ts.header.frame_id,</span><br><span class="line">                ts.child_frame_id,</span><br><span class="line">                ts.transform.translation.x,</span><br><span class="line">                ts.transform.translation.y,</span><br><span class="line">                ts.transform.translation.z</span><br><span class="line">                )</span><br><span class="line">            <span class="comment">#组织Twist消息</span></span><br><span class="line">            twist = Twist()</span><br><span class="line">            <span class="comment">#线速度 = 系数 * 坐标系原点的间距= 系数 * (x^2+y^2)再开方</span></span><br><span class="line">            <span class="comment">#角速度 = 系数 * 夹角 = 系数 +atn2(y,x)</span></span><br><span class="line">            twist.linear.x = <span class="number">0.5</span> *math.sqrt(math.<span class="built_in">pow</span>(ts.transform.translation.x,<span class="number">2</span>)+math.<span class="built_in">pow</span>(ts.transform.translation.y,<span class="number">2</span>))</span><br><span class="line">            twist.angular.z = <span class="number">4</span> * math.atan2(ts.transform.translation.y,ts.transform.translation.x)</span><br><span class="line">            <span class="comment">#发布消息</span></span><br><span class="line">            pub.publish(twist)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logwarn(<span class="string">&quot;错误提示：%s&quot;</span>, e)</span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="rosbag"><a href="#rosbag" class="headerlink" title="rosbag"></a>rosbag</h2><h3 id="命令行实现"><a href="#命令行实现" class="headerlink" title="命令行实现"></a>命令行实现</h3><ol><li>录制：rosbag record -a -O 目标文件</li><li>查看rosbag info 文件名</li><li>回放rosbag play 文件名</li></ol><h3 id="编码实现-1"><a href="#编码实现-1" class="headerlink" title="编码实现"></a>编码实现</h3><h4 id="c-11"><a href="#c-11" class="headerlink" title="c++"></a>c++</h4><h5 id="写"><a href="#写" class="headerlink" title="写"></a>写</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rosbag/bag.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：使用rosbag向磁盘文件写入数据（话题+消息）</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.导包</span></span><br><span class="line"><span class="comment">        2.初始化</span></span><br><span class="line"><span class="comment">        3.创建rosbag对象</span></span><br><span class="line"><span class="comment">        4.打开文件流</span></span><br><span class="line"><span class="comment">        5.写数据</span></span><br><span class="line"><span class="comment">        6.关闭文件流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.初始化</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;bag_writer&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//     3.创建rosbag对象</span></span><br><span class="line">    rosbag::Bag bag;</span><br><span class="line">    <span class="comment">//     4.打开文件流</span></span><br><span class="line">    bag.<span class="built_in">open</span>(<span class="string">&quot;hello.bag&quot;</span>,rosbag::BagMode::Write);</span><br><span class="line">    <span class="comment">//     5.写数据</span></span><br><span class="line">    std_msgs::String msg;</span><br><span class="line">    msg.data = <span class="string">&quot;hello xxxxx&quot;</span>;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        参数1话题</span></span><br><span class="line"><span class="comment">        参数2时间戳</span></span><br><span class="line"><span class="comment">        参数3消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">&quot;/chatter&quot;</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">&quot;/chatter&quot;</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">&quot;/chatter&quot;</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">&quot;/chatter&quot;</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    <span class="comment">//     6.关闭文件流</span></span><br><span class="line">    bag.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="读"><a href="#读" class="headerlink" title="读"></a>读</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rosbag/bag.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rosbag/view.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：使用rosbag读取磁盘上的bag文件</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.导包</span></span><br><span class="line"><span class="comment">        2.初始化</span></span><br><span class="line"><span class="comment">        3.创建rosbag对象</span></span><br><span class="line"><span class="comment">        4.打开文件流(以读的方式打开)</span></span><br><span class="line"><span class="comment">        5.写数据</span></span><br><span class="line"><span class="comment">        6.关闭文件流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;bag_read&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    rosbag::Bag bag;</span><br><span class="line">    bag.<span class="built_in">open</span>(<span class="string">&quot;hello.bag&quot;</span>,rosbag::BagMode::Read);</span><br><span class="line">    <span class="comment">//可以先获取消息的集合，在迭代取出消息的字段</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span>&amp;&amp; m :rosbag::<span class="built_in">View</span>(bag))&#123;</span><br><span class="line">        std::string topic = m.<span class="built_in">getTopic</span>();</span><br><span class="line">        ros::Time time = m.<span class="built_in">getTime</span>();</span><br><span class="line">        std_msgs::StringPtr p = m.<span class="built_in">instantiate</span>&lt;std_msgs::String&gt;();</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;解析的内容，话题:%s,时间戳：%.2f,消息值：%s&quot;</span>,</span><br><span class="line">            topic.<span class="built_in">c_str</span>(),</span><br><span class="line">            time.<span class="built_in">toSec</span>(),</span><br><span class="line">            p-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    bag.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-12"><a href="#python-12" class="headerlink" title="python"></a>python</h4><h5 id="写-1"><a href="#写-1" class="headerlink" title="写"></a>写</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> rosbag</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    需求:写出消息数据到磁盘上的bag文件</span></span><br><span class="line"><span class="string">    流程：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化</span></span><br><span class="line"><span class="string">        3.创建rosbag对象并打开文件流</span></span><br><span class="line"><span class="string">        4.写数据</span></span><br><span class="line"><span class="string">        5.关闭流</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;write_bag_p&quot;</span>)</span><br><span class="line">    <span class="comment">#     3.创建rosbag对象并打开文件流</span></span><br><span class="line">    bag = rosbag.Bag(<span class="string">&quot;hello_p.bag&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">    <span class="comment">#     4.写数据</span></span><br><span class="line">    msg = String()</span><br><span class="line">    msg.data = <span class="string">&quot;hello bag&quot;</span></span><br><span class="line">    bag.write(<span class="string">&quot;/liaotian&quot;</span>,msg)</span><br><span class="line">    bag.write(<span class="string">&quot;/liaotian&quot;</span>,msg)</span><br><span class="line">    bag.write(<span class="string">&quot;/liaotian&quot;</span>,msg)</span><br><span class="line">    bag.write(<span class="string">&quot;/liaotian&quot;</span>,msg)</span><br><span class="line">    bag.write(<span class="string">&quot;/liaotian&quot;</span>,msg)</span><br><span class="line">    <span class="comment">#     5.关闭流</span></span><br><span class="line">    bag.close()</span><br></pre></td></tr></table></figure><h5 id="读-1"><a href="#读-1" class="headerlink" title="读"></a>读</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> rosbag</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    需求:读取磁盘上的bag文件</span></span><br><span class="line"><span class="string">    流程：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化</span></span><br><span class="line"><span class="string">        3.创建rosbag对象并打开文件流</span></span><br><span class="line"><span class="string">        4.读数据</span></span><br><span class="line"><span class="string">        5.关闭流</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;read_bag_p&quot;</span>)</span><br><span class="line">    bag = rosbag.Bag(<span class="string">&quot;hello_p.bag&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">    msgs = bag.read_messages(<span class="string">&quot;/liaotian&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> topic,msg,time <span class="keyword">in</span> msgs:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;话题%s,消息:%s,时间:%s&quot;</span>,topic,msg.data,time)</span><br><span class="line">    bag.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="rqt工具箱"><a href="#rqt工具箱" class="headerlink" title="rqt工具箱"></a>rqt工具箱</h2><ol><li>启动 rqt</li><li>可以通过 plugins 添加所需的插件</li><li>rqt_console 是 ROS 中用于显示和过滤日志的图形化插件，可以在 rqt 的 plugins 中添加，或者使用rqt_console启动</li><li>rqt_plot是图形绘制插件，可以以 2D 绘图的方式绘制发布在 topic 上的数据</li><li>rqt_bag录制和重放 bag 文件的图形化插件</li></ol><h1 id="机器人仿真"><a href="#机器人仿真" class="headerlink" title="机器人仿真"></a>机器人仿真</h1></div><div class="story post-story"><h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><p>优点</p><ol><li>低成本</li><li>高效</li><li>高安全性</li></ol><p>缺点</p><ol><li>不能完全仿真真实环境</li><li>存在失真现象</li></ol></div><div class="story post-story"><h2 id="urdf语法"><a href="#urdf语法" class="headerlink" title="urdf语法"></a>urdf语法</h2><h3 id="robot-link"><a href="#robot-link" class="headerlink" title="robot,link"></a>robot,link</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 需求设置不同形状的机器人部件 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;mycar&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- 可视化标签 --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- 1.形状 --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- 立方体 --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- &lt;box size=&quot;0.3 0.2 0.1&quot; /&gt; --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- 圆柱 --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- &lt;cylinder radius=&quot;0.1&quot; length=&quot;2&quot;/&gt; --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- 球体 --&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="comment">&lt;!-- &lt;sphere radius=&quot;1&quot;/&gt;                --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- 皮肤 --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">&quot;package://urdf01_rviz/meshes/autolabor_mini.stl&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- 2.偏移量和倾斜弧度 --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="comment"><span class="language-xml">                xyz设置机器人在xyz轴的偏移量</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">                rpy设置倾斜弧度xyz翻滚扶养偏航</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">             --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- &lt;origin xyz=&quot;0.0 0.0 0.0&quot; rpy=&quot;0.0 0.0 0.0&quot;/&gt; --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;1.57 0.0 1.57&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- 3.颜色 --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;car_color&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0 0.0 1.0 1&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span>    </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="joint"><a href="#joint" class="headerlink" title="joint"></a>joint</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;robot name=<span class="string">&quot;mycar&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;0.3 0.2 0.1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0.0 0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0.0 0&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;car_color&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0 0.0 1.0 0.8&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span>    </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;camera&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;0.02 0.05 0.05&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0.0 0.025&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0.0 0&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;camera_color&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0.5 0.0 1.0 1&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span>    </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;camera2base&quot;</span> <span class="attr">type</span>=<span class="string">&quot;continuous&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;camera&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.12 0.0 0.05&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 1.0&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line">&lt;/robot&gt;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="xacro语法"><a href="#xacro语法" class="headerlink" title="xacro语法"></a>xacro语法</h2><h3 id="定义，调用，运算"><a href="#定义，调用，运算" class="headerlink" title="定义，调用，运算"></a>定义，调用，运算</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;robot name=&quot;mycar&quot; xmlns:xacro=&quot;http://wiki.ros.org/xacro&quot;&gt;</span><br><span class="line">    &lt;!-- 1属性定义 --&gt;</span><br><span class="line">    &lt;xacro:property name=&quot;PI&quot; value=&quot;3.1415927&quot; /&gt;</span><br><span class="line">    &lt;xacro:property name=&quot;radius&quot; value=&quot;0.03&quot; /&gt;</span><br><span class="line">    &lt;!-- 属性调用 --&gt;</span><br><span class="line">    &lt;myusePropertyxx name=&quot;$&#123;PI&#125;&quot; /&gt; </span><br><span class="line">    &lt;myusePropertyxx name=&quot;$&#123;radius&#125;&quot; /&gt; </span><br><span class="line">    &lt;!-- 算术运算 --&gt;</span><br><span class="line">    &lt;myusePropertyxx name=&quot;$&#123;PI / 2&#125;&quot; /&gt; </span><br><span class="line">&lt;/robot&gt;</span><br></pre></td></tr></table></figure><h3 id="封装，宏"><a href="#封装，宏" class="headerlink" title="封装，宏"></a>封装，宏</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;robot name=&quot;mycar&quot; xmlns:xacro=&quot;http://wiki.ros.org/xacro&quot;&gt;</span><br><span class="line">&lt;!-- </span><br><span class="line">    上节案例问题：</span><br><span class="line">        1.代码复用 ====Xacro宏(函数)</span><br><span class="line">        2.参数设计= ===Xacro变量</span><br><span class="line"></span><br><span class="line"> --&gt;</span><br><span class="line">    &lt;!-- 属性封装 --&gt;</span><br><span class="line">    &lt;xacro:property name=&quot;wheel_radius&quot; value=&quot;0.0325&quot; /&gt;</span><br><span class="line">    &lt;xacro:property name=&quot;wheel_length&quot; value=&quot;0.0015&quot; /&gt;</span><br><span class="line">    &lt;xacro:property name=&quot;PI&quot; value=&quot;3.1415927&quot; /&gt;</span><br><span class="line">    &lt;xacro:property name=&quot;base_link_length&quot; value=&quot;0.08&quot; /&gt;</span><br><span class="line">    &lt;xacro:property name=&quot;lidi_space&quot; value=&quot;0.015&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 宏 --&gt;</span><br><span class="line">    &lt;xacro:macro name=&quot;wheel_func&quot; params=&quot;wheel_name flag&quot; &gt;</span><br><span class="line">        &lt;link name=&quot;$&#123;wheel_name&#125;_wheel&quot;&gt;</span><br><span class="line">            &lt;visual&gt;</span><br><span class="line">                &lt;geometry&gt;</span><br><span class="line">                    &lt;cylinder radius=&quot;$&#123;wheel_radius&#125;&quot; length=&quot;$&#123;wheel_length&#125;&quot; /&gt;</span><br><span class="line">                &lt;/geometry&gt;</span><br><span class="line"></span><br><span class="line">                &lt;origin xyz=&quot;0 0 0&quot; rpy=&quot;$&#123;PI / 2&#125; 0 0&quot; /&gt;</span><br><span class="line"></span><br><span class="line">                &lt;material name=&quot;wheel_color&quot;&gt;</span><br><span class="line">                    &lt;color rgba=&quot;0 0 0 0.3&quot; /&gt;</span><br><span class="line">                &lt;/material&gt;</span><br><span class="line">            &lt;/visual&gt;</span><br><span class="line">        &lt;/link&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 3.2joint --&gt;</span><br><span class="line">        &lt;joint name=&quot;$&#123;wheel_name&#125;2link&quot; type=&quot;continuous&quot;&gt;</span><br><span class="line">            &lt;parent link=&quot;base_link&quot;  /&gt;</span><br><span class="line">            &lt;child link=&quot;$&#123;wheel_name&#125;_wheel&quot; /&gt;</span><br><span class="line">            &lt;!-- </span><br><span class="line">                x 无偏移</span><br><span class="line">                y 车体半径</span><br><span class="line">                z z= 车体高度 / 2 + 离地间距 - 车轮半径</span><br><span class="line"></span><br><span class="line">            --&gt;</span><br><span class="line">            &lt;origin xyz=&quot;0 $&#123;0.1 * flag&#125; $&#123;(base_link_length / 2 + lidi_space - wheel_radius) * -1&#125;&quot; rpy=&quot;0 0 0&quot; /&gt;</span><br><span class="line">            &lt;axis xyz=&quot;0 1 0&quot; /&gt;</span><br><span class="line">        &lt;/joint&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/xacro:macro&gt;</span><br><span class="line">    &lt;!-- 调用语法 --&gt;</span><br><span class="line">    &lt;xacro:wheel_func wheel_name=&quot;left&quot; flag=&quot;1&quot; /&gt;</span><br><span class="line">    &lt;xacro:wheel_func wheel_name=&quot;right&quot; flag=&quot;-1&quot; /&gt;</span><br><span class="line">&lt;/robot&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="包含"><a href="#包含" class="headerlink" title="包含"></a>包含</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;robot name=&quot;mycar&quot; xmlns:xacro=&quot;http://wiki.ros.org/xacro&quot;&gt;</span><br><span class="line">    &lt;!-- 演示文件包含 --&gt;</span><br><span class="line">    &lt;xacro:include filename=&quot;demo02_field.urdf.xacro&quot; /&gt;</span><br><span class="line">    &lt;xacro:include filename=&quot;demo03_macro.urdf.xacro&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/robot&gt;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="rviz控制机器人运动"><a href="#rviz控制机器人运动" class="headerlink" title="rviz控制机器人运动"></a>rviz控制机器人运动</h2><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><ol><li>添加配置文件</li></ol><p><a href="http://wiki.ros.org/arbotix_python/diff_controller">官方配置文件</a></p><ol start="2"><li>编写launch文件</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 将 urdf 文件内容设置进参数服务器 --&gt;</span><br><span class="line">    &lt;!-- <span class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;robot_description&quot;</span> <span class="attr">textfile</span>=<span class="string">&quot;$(find urdf01_rviz)/urdf/xacro/demo05_car_base.urdf&quot;</span> /&gt;</span></span> --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;robot_description&quot;</span> <span class="attr">command</span>=<span class="string">&quot;$(find xacro)/xacro $(find urdf01_rviz)/urdf/xacro/car.urdf.xacro&quot;</span> /&gt;</span></span></span><br><span class="line">    &lt;!-- 启动 rivz --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz_test&quot;</span> <span class="attr">args</span>=<span class="string">&quot;-d $(find urdf01_rviz)/config/show_mycar.rviz&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &lt;!-- 启动机器人状态和关节状态发布节点 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;robot_state_publisher&quot;</span> /&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;joint_state_publisher&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &lt;!-- 集成arbotix运动控制节点,并且加载参数 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;arbotix_python&quot;</span> <span class="attr">type</span>=<span class="string">&quot;arbotix_driver&quot;</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">file</span>=<span class="string">&quot;$(find urdf01_rviz)/config/control.yaml&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;sim&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>启动launch文件控制小车运动</li></ol></div><div class="story post-story"><h2 id="urdf集成gazebo"><a href="#urdf集成gazebo" class="headerlink" title="urdf集成gazebo"></a>urdf集成gazebo</h2><h3 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h3><ol><li>创建功能包</li><li>编写urdf文件</li><li>启动gazebo并显示模型</li></ol><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><ol><li>如果是标准几何体：collision和link的 visual 属性设置一致</li><li>如果不是标准集合体则需要设置惯性矩阵</li></ol></div><div class="story post-story"><h2 id="综合"><a href="#综合" class="headerlink" title="综合"></a>综合</h2><h3 id="机器人运动控制"><a href="#机器人运动控制" class="headerlink" title="机器人运动控制"></a>机器人运动控制</h3><p>运动控制基本流程:</p><ol><li>为 joint 添加传动装置以及控制器</li><li>xacro文件集成</li><li>启动 gazebo并控制机器人运动</li><li>Rviz查看里程计信息</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic pub -r 10 /cmd_vel geometry_msgs/Twist &#x27;linear: x: 0.2, y: 0, z: 0, angular: x: 0, y: 0, z: 0.5&#x27;</span><br></pre></td></tr></table></figure><h3 id="雷达信息仿真"><a href="#雷达信息仿真" class="headerlink" title="雷达信息仿真"></a>雷达信息仿真</h3><p>流程：</p><ol><li>新建 Xacro 文件，配置雷达传感器信息</li><li>xacro 文件集成</li><li>启动仿真环境</li><li>Rviz 显示雷达数据</li></ol><h3 id="摄像头信息仿真"><a href="#摄像头信息仿真" class="headerlink" title="摄像头信息仿真"></a>摄像头信息仿真</h3><p>流程：</p><ol><li>新建 Xacro 文件，配置摄像头传感器信息 </li><li>xacro 文件集成</li><li>启动仿真环境</li><li>Rviz 显示摄像头数据</li></ol><h3 id="kinect信息仿真"><a href="#kinect信息仿真" class="headerlink" title="kinect信息仿真"></a>kinect信息仿真</h3><p>流程：</p><ol><li>新建 Xacro 文件，配置kinetic传感器信息 </li><li>xacro 文件集成</li><li>启动仿真环境</li><li>Rviz 显示Kinect 数据</li></ol><p>&#x3D;&#x3D;注意：在rviz中点云数据显示错位解决办法&#x3D;&#x3D;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;frameName&gt;support_depth&lt;/frameName&gt;</span><br><span class="line">&lt;node pkg=&quot;tf2_ros&quot; type=&quot;static_transform_publisher&quot; name=&quot;static_transform_publisher&quot; args=&quot;0 0 0 -1.57 0 -1.57 /support /support_depth&quot; /&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosrun tf2_ros static_transform_publisher 0.1 0.0 0.3 0 0 0 /base_link /camera</span><br><span class="line">                                                      偏航 俯仰 翻滚</span><br></pre></td></tr></table></figure><h1 id="机器人导航"><a href="#机器人导航" class="headerlink" title="机器人导航"></a>机器人导航</h1></div><div class="story post-story"><h2 id="导航模块简介"><a href="#导航模块简介" class="headerlink" title="导航模块简介"></a>导航模块简介</h2><h3 id="关键技术"><a href="#关键技术" class="headerlink" title="关键技术"></a>关键技术</h3><ol><li>全局地图</li><li>自身定位</li><li>路径规划</li><li>运动控制</li><li>环境感知</li></ol><h3 id="导航坐标系"><a href="#导航坐标系" class="headerlink" title="导航坐标系"></a>导航坐标系</h3><p>&#x3D;&#x3D;坐标系关系：map&gt;odom&gt;base_link或base_footprint&#x3D;&#x3D;</p><h4 id="里程计特点"><a href="#里程计特点" class="headerlink" title="里程计特点"></a>里程计特点</h4><ul><li>优点：连续，无跳变</li><li>缺点：累计误差</li><li>易产生误差：<ul><li>路面不平，测速不准，车轮打滑</li><li>长时间，长距离运行会导致误差累积</li></ul></li></ul><h4 id="传感器特点"><a href="#传感器特点" class="headerlink" title="传感器特点"></a>传感器特点</h4><ul><li>优点：精准</li><li>缺点：跳变，且特征点较少时精度会降低</li></ul></div><div class="story post-story"><h2 id="导航实现"><a href="#导航实现" class="headerlink" title="导航实现"></a>导航实现</h2><h3 id="slam建图"><a href="#slam建图" class="headerlink" title="slam建图"></a>slam建图</h3><p>流程：</p><ol><li>编写gampping节点相关launch文件</li><li><a href="https://github.com/ros-perception/slam_gmapping/blob/melodic-devel/gmapping/launch/slam_gmapping_pr2.launch">launch文件模板</a></li><li>启动 Gazebo 仿真环境</li><li>启动地图绘制的 launch 文件</li><li>启动键盘键盘控制节点，用于控制机器人运动建图</li></ol><h3 id="地图服务"><a href="#地图服务" class="headerlink" title="地图服务"></a>地图服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;arg name=&quot;map&quot; default=&quot;nav.yaml&quot; /&gt;</span><br><span class="line">    &lt;node pkg=&quot;map_server&quot; type=&quot;map_server&quot; name=&quot;map_server&quot; args=&quot;$(find nav_demo)/map/$(arg map)&quot; /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;arg name=&quot;filename&quot; value=&quot;$(find nav_demo)/map/nav&quot; /&gt;</span><br><span class="line">    &lt;node name=&quot;map_save&quot; pkg=&quot;map_server&quot; type=&quot;map_saver&quot; args=&quot;-f $(arg filename)&quot; /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="amcl定位"><a href="#amcl定位" class="headerlink" title="amcl定位"></a>amcl定位</h3><ol><li>launch文件编写<ul><li>导入模板</li></ul></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">roscd amcl</span><br><span class="line">ls examples</span><br><span class="line">gedit examples/amcl_diff.launch </span><br></pre></td></tr></table></figure><h3 id="movebase路径规划"><a href="#movebase路径规划" class="headerlink" title="movebase路径规划"></a>movebase路径规划</h3><h4 id="代价地图组成-多层叠加"><a href="#代价地图组成-多层叠加" class="headerlink" title="代价地图组成(多层叠加)"></a>代价地图组成(多层叠加)</h4><ol><li>静态层 —–slam绘制的静态地图</li><li>障碍物层 —导航中传感器感知的障碍物</li><li>膨胀层   —–为了避免碰撞设置的安全区</li><li>自定义层 —-根据业务自设置的地图数据</li></ol><p><a href="https://github.com/ROBOTIS-GIT/turtlebot3/tree/master/turtlebot3_navigation/param">配置文件地址</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">配置文件书写正确，xml没有问题时，且已经souce和编译，rosrun报[rosrun] Couldn&#x27;t find executable named use_plus below /home/zhuwencheng/demo06_ws/src/demo03_plugin重启vscode就可以正常运行</span><br></pre></td></tr></table></figure><h4 id="参数配置技巧"><a href="#参数配置技巧" class="headerlink" title="参数配置技巧"></a>参数配置技巧</h4><ul><li>全局代价地图可以将膨胀半径和障碍物系数设置的偏大一些</li><li>本地代价地图可以将膨胀半径和障碍物系数设置的偏小一些</li></ul><h3 id="机器人自主移动建图"><a href="#机器人自主移动建图" class="headerlink" title="机器人自主移动建图"></a>机器人自主移动建图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 集成slam与导航，实现机器人自主移动的地图构建 --&gt;</span><br><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 1.slam实现 --&gt;</span><br><span class="line">    &lt;include file=&quot;$(find nav_demo)/launch/nav01_slam.launch&quot; /&gt;</span><br><span class="line">    &lt;!-- 2.导航中的movebase实现 --&gt;</span><br><span class="line">    &lt;include file=&quot;$(find nav_demo)/launch/nav05_path.launch&quot; /&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="导航相关消息"><a href="#导航相关消息" class="headerlink" title="导航相关消息"></a>导航相关消息</h2><ol><li>地图：rosmsg info nav_msgs&#x2F;MapMetaData</li><li>里程计：rosmsg info nav_msgs&#x2F;Odometry</li><li>坐标变换：rosmsg info tf&#x2F;tfMessage</li><li>定位：rosmsg info geometry_msgs&#x2F;PoseArray</li><li>目标点及路径规划：rosmsg info move_base_msgs&#x2F;MoveBaseActionGoal</li><li>雷达：rosmsg info sensor_msgs&#x2F;LaserScan</li><li>相机：<ul><li>rosmsg info sensor_msgs&#x2F;Imag</li><li>rosmsg info sensor_msgs&#x2F;CompressedImage</li><li>rosmsg info sensor_msgs&#x2F;PointCloud2</li></ul></li></ol><h1 id="ros进阶"><a href="#ros进阶" class="headerlink" title="ros进阶"></a>ros进阶</h1></div><div class="story post-story"><h2 id="action通信"><a href="#action通信" class="headerlink" title="action通信"></a>action通信</h2><h3 id="自定义action文件"><a href="#自定义action文件" class="headerlink" title="自定义action文件"></a>自定义action文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#1.目标数据变量</span><br><span class="line">int32 num</span><br><span class="line">---</span><br><span class="line">#2.最终响应变量</span><br><span class="line">int32 result</span><br><span class="line">---</span><br><span class="line">#3.连续反馈变量</span><br><span class="line">float64 progress_bar</span><br></pre></td></tr></table></figure><h3 id="action通信-1"><a href="#action通信-1" class="headerlink" title="action通信"></a>action通信</h3><h4 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h4><h5 id="服务端-2"><a href="#服务端-2" class="headerlink" title="服务端"></a>服务端</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;actionlib/server/simple_action_server.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo01_action/AddIntsAction.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求:</span></span><br><span class="line"><span class="comment">        创建两个ROS节点，服务器和客户端，</span></span><br><span class="line"><span class="comment">        客户端可以向服务器发送目标数据N（一个整型数据）</span></span><br><span class="line"><span class="comment">        服务器会计算1到N之间所有整数的和，这是一个循环累加的过程，返回给客户端，</span></span><br><span class="line"><span class="comment">        这是基于请求响应模式的，</span></span><br><span class="line"><span class="comment">        又已知服务器从接收到请求到产生响应是一个耗时操作，每累加一次耗时0.1s，</span></span><br><span class="line"><span class="comment">        为了良好的用户体验，需要服务器在计算过程中，</span></span><br><span class="line"><span class="comment">        每累加一次，就给客户端响应一次百分比格式的执行进度，使用action实现。</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化ros节点</span></span><br><span class="line"><span class="comment">        3.创建NodeHandle</span></span><br><span class="line"><span class="comment">        4.创建action服务对象</span></span><br><span class="line"><span class="comment">        5.请求处理(a.解析提交的目标值；b.产生连续反馈；c.最终结果响应) ---回调函数</span></span><br><span class="line"><span class="comment">        6.spin()回旋</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> actionlib::SimpleActionServer&lt;demo01_action::AddIntsAction&gt; Server;</span><br><span class="line"><span class="comment">// 5.请求处理(a.解析提交的目标值；b.产生连续反馈；c.最终结果响应) ---回调函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cb</span><span class="params">(<span class="type">const</span> demo01_action::AddIntsGoalConstPtr &amp;goalPtr,Server* server)</span></span>&#123;</span><br><span class="line">    <span class="comment">// a.解析提交的目标值</span></span><br><span class="line">    <span class="type">int</span> goal_num = goalPtr -&gt; num;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;客户端提交的目标值是:%d&quot;</span>,goal_num);</span><br><span class="line">    <span class="comment">// b.产生连续反馈</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= goal_num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        result += i;</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        <span class="comment">//产生连续反馈</span></span><br><span class="line">        <span class="comment">// void publishFeedback(const demo01_action::AddIntsFeedback &amp;feedback)</span></span><br><span class="line">        demo01_action::AddIntsFeedback fb;</span><br><span class="line">        fb.progress_bar = i /(<span class="type">double</span>)goal_num;</span><br><span class="line">        server-&gt;<span class="built_in">publishFeedback</span>(fb);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;最终运行结果：%d&quot;</span>,result);</span><br><span class="line">    <span class="comment">// c.最终结果响应</span></span><br><span class="line">    demo01_action::AddIntsResult r;</span><br><span class="line">    r.result = result;</span><br><span class="line">    server-&gt;<span class="built_in">setSucceeded</span>(r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 2.初始化ros节点</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;addInts_server&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.创建NodeHandle</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建action服务对象</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        SimpleActionServer(ros::NodeHandle n, </span></span><br><span class="line"><span class="comment">                        std::string name, </span></span><br><span class="line"><span class="comment">                        boost::function&lt;void (const demo01_action::AddIntsGoalConstPtr &amp;)&gt; execute_callback, </span></span><br><span class="line"><span class="comment">                        bool auto_start)</span></span><br><span class="line"><span class="comment">        参数1：NodeHandle</span></span><br><span class="line"><span class="comment">        参数2：话题名称</span></span><br><span class="line"><span class="comment">        参数3：回调函数</span></span><br><span class="line"><span class="comment">        参数4：是否自动启动</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Server <span class="title">server</span><span class="params">(nh,<span class="string">&quot;addInts&quot;</span>,boost::bind(&amp;cb,_1,&amp;server),<span class="literal">false</span>)</span></span>;</span><br><span class="line">    server.<span class="built_in">start</span>();<span class="comment">//如果auto_start为false，那么需要手动调用该函数启动服务</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;服务启动.....&quot;</span>);</span><br><span class="line">    <span class="comment">// 5.请求处理(a.解析提交的目标值；b.产生连续反馈；c.最终结果响应) ---回调函数</span></span><br><span class="line">    <span class="comment">// 6.spin()回旋</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="客户端-2"><a href="#客户端-2" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;actionlib/client/simple_action_client.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo01_action/AddIntsAction.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求:</span></span><br><span class="line"><span class="comment">        创建两个ROS 节点，服务器和客户端，</span></span><br><span class="line"><span class="comment">        客户端可以向服务器发送目标数据N(一个整型数据)服务器会计算 1 到 N 之间所有整数的和,</span></span><br><span class="line"><span class="comment">        这是一个循环累加的过程，返回给客户端，这是基于请求响应模式的，</span></span><br><span class="line"><span class="comment">        又已知服务器从接收到请求到产生响应是一个耗时操作，每累加一次耗时0.1s，</span></span><br><span class="line"><span class="comment">        为了良好的用户体验，需要服务器在计算过程中，</span></span><br><span class="line"><span class="comment">        每累加一次，就给客户端响应一次百分比格式的执行进度，使用 action实现。</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化ros节点</span></span><br><span class="line"><span class="comment">        3.创建NodeHandle</span></span><br><span class="line"><span class="comment">        4.创建action客户端对象</span></span><br><span class="line"><span class="comment">        5.发送请求</span></span><br><span class="line"><span class="comment">            a.连接建立   ----回调函数</span></span><br><span class="line"><span class="comment">            b.处理连续反馈  ---回调函数</span></span><br><span class="line"><span class="comment">            c.处理最终响应  ---回调函数</span></span><br><span class="line"><span class="comment">        6.spin()回旋</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//相应成功时的回调</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">done_cb</span><span class="params">(<span class="type">const</span> actionlib::SimpleClientGoalState &amp;state , <span class="type">const</span> demo01_action::AddIntsResultConstPtr &amp;result)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(state.state_ == state.SUCCEEDED)&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;响应成功，最终结果 = %d&quot;</span>, result-&gt;result);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;请求失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 激活回调</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">active_cb</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;客户端与服务端连接建立...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//连续反馈的回调</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">feedback_cb</span><span class="params">(<span class="type">const</span> demo01_action::AddIntsFeedbackConstPtr &amp;feedback)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;连续反馈：%.2f&quot;</span>,feedback-&gt;progress_bar);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 2.初始化ros节点</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;addInts_client&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.创建NodeHandle</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建action客户端对象</span></span><br><span class="line">    <span class="function">actionlib::SimpleActionClient&lt;demo01_action::AddIntsAction&gt; <span class="title">client</span><span class="params">(nh,<span class="string">&quot;addInts&quot;</span>)</span></span>;</span><br><span class="line">    <span class="comment">// 5.发送请求</span></span><br><span class="line">    <span class="comment">// 注意:先等待服务</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;等待服务器启动...&quot;</span>);</span><br><span class="line">    client.<span class="built_in">waitForServer</span>();</span><br><span class="line">    <span class="comment">//     a.连接建立   ----回调函数</span></span><br><span class="line">    <span class="comment">//     b.处理连续反馈  ---回调函数</span></span><br><span class="line">    <span class="comment">//     c.处理最终响应  ---回调函数</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        void sendGoal(const demo01_action::AddIntsGoal &amp;goal, </span></span><br><span class="line"><span class="comment">                    boost::function&lt;void (const actionlib::SimpleClientGoalState &amp;state, </span></span><br><span class="line"><span class="comment">                    const demo01_action::AddIntsResultConstPtr &amp;result)&gt; done_cb, boost::function&lt;void ()&gt; active_cb,</span></span><br><span class="line"><span class="comment">                    boost::function&lt;void (const demo01_action::AddIntsFeedbackConstPtr &amp;feedback)&gt; feedback_cb)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 参数1：设置目标值</span></span><br><span class="line">    demo01_action::AddIntsGoal goal;</span><br><span class="line">    goal.num = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    client.<span class="built_in">sendGoal</span>(goal,&amp;done_cb,&amp;active_cb,&amp;feedback_cb);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.spin()回旋</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-13"><a href="#python-13" class="headerlink" title="python"></a>python</h4><h5 id="服务端-3"><a href="#服务端-3" class="headerlink" title="服务端"></a>服务端</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> actionlib</span><br><span class="line"><span class="keyword">from</span> demo01_action.msg <span class="keyword">import</span> *</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    需求:</span></span><br><span class="line"><span class="string">        创建两个ROS 节点，服务器和客户端，</span></span><br><span class="line"><span class="string">        客户端可以向服务器发送目标数据N(一个整型数据)服务器会计算 1 到 N 之间所有整数的和,</span></span><br><span class="line"><span class="string">        这是一个循环累加的过程，返回给客户端，这是基于请求响应模式的，</span></span><br><span class="line"><span class="string">        又已知服务器从接收到请求到产生响应是一个耗时操作,每累加一次耗时0.1s,</span></span><br><span class="line"><span class="string">        为了良好的用户体验，需要服务器在计算过程中，</span></span><br><span class="line"><span class="string">        每累加一次，就给客户端响应一次百分比格式的执行进度，使用 action实现。</span></span><br><span class="line"><span class="string">    流程：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化ros节点</span></span><br><span class="line"><span class="string">        3.单独封装一个类</span></span><br><span class="line"><span class="string">        4.类中创建action 服务端对象</span></span><br><span class="line"><span class="string">        5.处理请求(a.解析目标值 b.发送连续反馈 c.响应最终结果) --回调函数</span></span><br><span class="line"><span class="string">        6.spin()</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#  4.类中创建action 服务端对象</span></span><br><span class="line"><span class="comment">#     5.处理请求(a.解析目标值 b.发送连续反馈 c.响应最终结果) --回调函数</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyAction</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># (name, ActionSpec, execute_cb=None, auto_start=True) -&gt; None</span></span><br><span class="line">        self.server = actionlib.SimpleActionServer(<span class="string">&quot;addInts&quot;</span>,AddIntsAction,self.cb,<span class="literal">False</span>)</span><br><span class="line">        self.server.start()</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;服务端启动...&quot;</span>)</span><br><span class="line"><span class="comment"># 回调函数</span></span><br><span class="line"><span class="comment"># 参数：目标值</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cb</span>(<span class="params">self,goal</span>):</span><br><span class="line">        <span class="comment"># a.解析目标值 </span></span><br><span class="line">        goal_num = goal.num</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;目标值:%d&quot;</span>,goal_num)</span><br><span class="line">        <span class="comment"># b.发送连续反馈 </span></span><br><span class="line">        rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">        <span class="built_in">sum</span> = <span class="number">0</span>  <span class="comment">#接收求和的结果变量</span></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;请求处理中&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,goal_num+<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">sum</span> = <span class="built_in">sum</span>+i</span><br><span class="line">            rate.sleep()</span><br><span class="line">            <span class="comment">#发送连续反馈</span></span><br><span class="line">            fb_obj = AddIntsFeedback()</span><br><span class="line">            fb_obj.progress_bar = i/goal_num</span><br><span class="line">            self.server.publish_feedback(fb_obj)</span><br><span class="line">        <span class="comment"># c.响应最终结果</span></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;响应最终结果：%d&quot;</span>,<span class="built_in">sum</span>)</span><br><span class="line">        result = AddIntsResult()</span><br><span class="line">        result.result =<span class="built_in">sum</span></span><br><span class="line">        self.server.set_succeeded(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.导包</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;action_server_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 2.初始化ros节点</span></span><br><span class="line">    <span class="comment"># 3.单独封装一个类</span></span><br><span class="line">    myAction = MyAction()</span><br><span class="line">   </span><br><span class="line">    <span class="comment"># 6.spin()</span></span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="客户端-3"><a href="#客户端-3" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># #! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import rospy </span></span><br><span class="line"><span class="comment"># import actionlib</span></span><br><span class="line"><span class="comment"># from demo01_action.msg import *</span></span><br><span class="line"><span class="comment"># &quot;&quot;&quot; </span></span><br><span class="line"><span class="comment">#     需求:</span></span><br><span class="line"><span class="comment">#         创建两个ROS 节点，服务器和客户端，</span></span><br><span class="line"><span class="comment">#         客户端可以向服务器发送目标数据N(一个整型数据)服务器会计算 1 到 N 之间所有整数的和,</span></span><br><span class="line"><span class="comment">#         这是一个循环累加的过程，返回给客户端，这是基于请求响应模式的，</span></span><br><span class="line"><span class="comment">#         又已知服务器从接收到请求到产生响应是一个耗时操作,每累加一次耗时0.1s,</span></span><br><span class="line"><span class="comment">#         为了良好的用户体验，需要服务器在计算过程中，</span></span><br><span class="line"><span class="comment">#         每累加一次，就给客户端响应一次百分比格式的执行进度，使用 action实现。</span></span><br><span class="line"><span class="comment">#     流程：</span></span><br><span class="line"><span class="comment">#         1.导包</span></span><br><span class="line"><span class="comment">#         2.初始化ros节点</span></span><br><span class="line"><span class="comment">#         3.创建action客户端对象(等待服务启动)</span></span><br><span class="line"><span class="comment">#         4.发送请求</span></span><br><span class="line"><span class="comment">#             a.激活处理</span></span><br><span class="line"><span class="comment">#             b.连续反馈处理</span></span><br><span class="line"><span class="comment">#             c.最终响应结果处理</span></span><br><span class="line"><span class="comment">#         6.spin()</span></span><br><span class="line"><span class="comment">#  &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def done_cb(status,result):</span></span><br><span class="line"><span class="comment">#     if status ==actionlib.GoalStatus.SUCCEEDED:</span></span><br><span class="line"><span class="comment">#         rospy.loginfo(&quot;最终响应结果：%d&quot;,result.result)</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         rospy.loginfo(&quot;响应失败&quot;)</span></span><br><span class="line"><span class="comment"># def active_cb():</span></span><br><span class="line"><span class="comment">#     rospy.loginfo(&quot;连接建立了&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def feedback_cb(feedback):</span></span><br><span class="line"><span class="comment">#     rospy.loginfo(&quot;当前进度：%.2f&quot;,feedback.progress_bar)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="comment">#     # 2.初始化ros节点</span></span><br><span class="line"><span class="comment">#     rospy.init_node(&quot;action_client_p&quot;)</span></span><br><span class="line"><span class="comment">#     # 3.创建action客户端对象(等待服务启动)</span></span><br><span class="line"><span class="comment">#     client = actionlib.SimpleActionClient(&quot;addInts&quot;,AddIntsAction)</span></span><br><span class="line"><span class="comment">#     client.wait_for_server()</span></span><br><span class="line"><span class="comment">#     # 4.发送请求</span></span><br><span class="line"><span class="comment">#     # 参数1：目标值</span></span><br><span class="line"><span class="comment">#     # 参数2：最终结果回调</span></span><br><span class="line"><span class="comment">#     # 参数3：连接被激活的回调</span></span><br><span class="line"><span class="comment">#     # 参数4：连续反馈</span></span><br><span class="line"><span class="comment">#     #     a.激活处理</span></span><br><span class="line"><span class="comment">#     #     b.连续反馈处理</span></span><br><span class="line"><span class="comment">#     #     c.最终响应结果处理</span></span><br><span class="line"><span class="comment">#     goal_obj = AddIntsGoal()</span></span><br><span class="line"><span class="comment">#     goal_obj.num = 10</span></span><br><span class="line"><span class="comment">#     client.send_goal(goal_obj,done_cb,active_cb,feedback_cb)</span></span><br><span class="line"><span class="comment">#     # 6.spin()</span></span><br><span class="line"><span class="comment">#     rospy.spin()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> actionlib</span><br><span class="line"><span class="keyword">from</span> demo01_action.msg <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    需求:</span></span><br><span class="line"><span class="string">        创建两个ROS 节点，服务器和客户端，</span></span><br><span class="line"><span class="string">        客户端可以向服务器发送目标数据N(一个整型数据)服务器会计算 1 到 N 之间所有整数的和,</span></span><br><span class="line"><span class="string">        这是一个循环累加的过程，返回给客户端，这是基于请求响应模式的，</span></span><br><span class="line"><span class="string">        又已知服务器从接收到请求到产生响应是一个耗时操作，每累加一次耗时0.1s，</span></span><br><span class="line"><span class="string">        为了良好的用户体验，需要服务器在计算过程中，</span></span><br><span class="line"><span class="string">        每累加一次，就给客户端响应一次百分比格式的执行进度，使用 action实现。</span></span><br><span class="line"><span class="string">    流程:</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="string">        3.创建 action Client 对象</span></span><br><span class="line"><span class="string">        4.等待服务</span></span><br><span class="line"><span class="string">        5.组织目标对象并发送</span></span><br><span class="line"><span class="string">        6.编写回调, 激活、连续反馈、最终响应</span></span><br><span class="line"><span class="string">        7.spin</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">done_cb</span>(<span class="params">state,result</span>):</span><br><span class="line">    <span class="keyword">if</span> state == actionlib.GoalStatus.SUCCEEDED:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;响应结果:%d&quot;</span>,result.result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">active_cb</span>():</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;服务被激活....&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fb_cb</span>(<span class="params">fb</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;当前进度:%.2f&quot;</span>,fb.progress_bar)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;action_client_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建 action Client 对象</span></span><br><span class="line">    client = actionlib.SimpleActionClient(<span class="string">&quot;addInts&quot;</span>,AddIntsAction)</span><br><span class="line">    <span class="comment"># 4.等待服务</span></span><br><span class="line">    client.wait_for_server()</span><br><span class="line">    <span class="comment"># 5.组织目标对象并发送</span></span><br><span class="line">    goal_obj = AddIntsGoal()</span><br><span class="line">    goal_obj.num = <span class="number">10</span></span><br><span class="line">    client.send_goal(goal_obj,done_cb,active_cb,fb_cb)</span><br><span class="line">    <span class="comment"># 6.编写回调, 激活、连续反馈、最终响应</span></span><br><span class="line">    <span class="comment"># 7.spin</span></span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="动态参数"><a href="#动态参数" class="headerlink" title="动态参数"></a>动态参数</h2><h3 id="客户端实现"><a href="#客户端实现" class="headerlink" title="客户端实现"></a>客户端实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    动态参数客户端：</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.创建参数生成器</span></span><br><span class="line"><span class="string">        3.往生成器添加参数</span></span><br><span class="line"><span class="string">        4.配置节点，并退出</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># from dynamic_reconfigure.parameter_generator_catkin import ParameterGenerator</span></span><br><span class="line"><span class="keyword">from</span> dynamic_reconfigure.parameter_generator_catkin <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># 2.创建参数生成器</span></span><br><span class="line">gen = ParameterGenerator()</span><br><span class="line"><span class="comment"># 3.往生成器添加参数</span></span><br><span class="line">gen.add(<span class="string">&quot;int_param&quot;</span>,int_t,<span class="number">0</span>,<span class="string">&quot;整数参数&quot;</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">100</span>)</span><br><span class="line">gen.add(<span class="string">&quot;double_param&quot;</span>,double_t,<span class="number">0</span>,<span class="string">&quot;浮点参数&quot;</span>,<span class="number">1.57</span>,<span class="number">0</span>,<span class="number">3.14</span>)</span><br><span class="line">gen.add(<span class="string">&quot;str_param&quot;</span>,str_t,<span class="number">0</span>,<span class="string">&quot;字符串参数&quot;</span>,<span class="string">&quot;hello param&quot;</span>)</span><br><span class="line">gen.add(<span class="string">&quot;bool_param&quot;</span>,bool_t,<span class="number">0</span>,<span class="string">&quot;布尔参数&quot;</span>,<span class="literal">True</span>)</span><br><span class="line">myList=gen.enum([gen.const(<span class="string">&quot;small&quot;</span>,int_t,<span class="number">0</span>,<span class="string">&quot;small_car&quot;</span>),</span><br><span class="line">                gen.const(<span class="string">&quot;normal&quot;</span>,int_t,<span class="number">1</span>,<span class="string">&quot;normalcar&quot;</span>),</span><br><span class="line">                gen.const(<span class="string">&quot;big&quot;</span>,int_t,<span class="number">2</span>,<span class="string">&quot;big_car&quot;</span>),</span><br><span class="line">            ],<span class="string">&quot;car+size&quot;</span>)</span><br><span class="line">gen.add(<span class="string">&quot;list_param&quot;</span>,int_t,<span class="number">0</span>,<span class="string">&quot;列表参数&quot;</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,edit_method=myList)</span><br><span class="line"><span class="comment"># 4.配置节点，并退出</span></span><br><span class="line">exit(gen.generate(<span class="string">&quot;demo02_dr&quot;</span>,<span class="string">&quot;dr_client&quot;</span>,<span class="string">&quot;dr&quot;</span>))</span><br></pre></td></tr></table></figure><h3 id="服务端实现"><a href="#服务端实现" class="headerlink" title="服务端实现"></a>服务端实现</h3><h4 id="c-12"><a href="#c-12" class="headerlink" title="c++"></a>c++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dynamic_reconfigure/server.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo02_dr/drConfig.h&quot;</span></span></span><br><span class="line"> <span class="comment">/*  </span></span><br><span class="line"><span class="comment">    动态参数服务端: 参数被修改时直接打印</span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ros 节点</span></span><br><span class="line"><span class="comment">        3.创建服务器对象</span></span><br><span class="line"><span class="comment">        4.回调函数解析修改后的参数</span></span><br><span class="line"><span class="comment">        5.spin()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//解析动态参数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cb</span><span class="params">(demo02_dr::drConfig &amp;config, <span class="type">uint32_t</span> level)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;修改后的整形数据是：%d,%.2f,%s,%d,%d&quot;</span>,config.int_param,</span><br><span class="line">                                                config.double_param,</span><br><span class="line">                                                config.str_param.<span class="built_in">c_str</span>(),</span><br><span class="line">                                                config.bool_param,</span><br><span class="line">                                                config.list_param);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1.初始化 ros 节点</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv,<span class="string">&quot;dr_server&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.创建服务器对象</span></span><br><span class="line">    dynamic_reconfigure::Server&lt;demo02_dr::drConfig&gt; server;</span><br><span class="line">    <span class="comment">// 4.回调函数解析修改后的参数</span></span><br><span class="line">    <span class="comment">// void setCallback(const boost::function&lt;void (demo02_dr::drConfig &amp;, uint32_t level)&gt; &amp;callback)</span></span><br><span class="line">    server.<span class="built_in">setCallback</span>(boost::<span class="built_in">bind</span>(&amp;cb,_1,_2));</span><br><span class="line">    <span class="comment">// 5.spin()</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="python-14"><a href="#python-14" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> dynamic_reconfigure.server <span class="keyword">import</span> Server</span><br><span class="line"><span class="keyword">from</span> demo02_dr.cfg <span class="keyword">import</span> drConfig</span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    动态参数服务端</span></span><br><span class="line"><span class="string">        1.导包</span></span><br><span class="line"><span class="string">        2.初始化ros节点</span></span><br><span class="line"><span class="string">        3.创建服务端对象</span></span><br><span class="line"><span class="string">        4.回调函数解析参数</span></span><br><span class="line"><span class="string">        5.spin()</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cb</span>(<span class="params">drConfig,level</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;修改后的整形数据是：%d,%.2f,%s,%d,%d&quot;</span>,drConfig.int_param,</span><br><span class="line">                                                    drConfig.double_param,</span><br><span class="line">                                                    drConfig.str_param,</span><br><span class="line">                                                    drConfig.bool_param,</span><br><span class="line">                                                    drConfig.list_param)</span><br><span class="line">    <span class="keyword">return</span> drConfig</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化ros节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;dr_server_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建服务端对象</span></span><br><span class="line">    <span class="comment"># type类型, callback回调函数, namespace=&quot;&quot;</span></span><br><span class="line">    server = Server(drConfig,cb)</span><br><span class="line">    <span class="comment"># 4.回调函数解析参数</span></span><br><span class="line">    <span class="comment"># 5.spin()</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="pluginlib导航插件"><a href="#pluginlib导航插件" class="headerlink" title="pluginlib导航插件"></a>pluginlib导航插件</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li>结构清晰</li><li>低耦合，易修改，可维护性强</li><li>可移植性强，更具复用性</li><li>结构容易调整，插件可以自由增减</li></ul><h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><h4 id="创建基类"><a href="#创建基类" class="headerlink" title="创建基类"></a>创建基类</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DBX_BASE_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBX_BASE_H_</span></span><br><span class="line"></span><br><span class="line">namespace dbx_base_ns&#123;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        注意：必须保证基类中包含无参构造</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Dbx_Base</span>&#123;</span></span><br><span class="line">        protected:</span><br><span class="line">            Dbx_Base()&#123;&#125;</span><br><span class="line"></span><br><span class="line">        public:</span><br><span class="line">        <span class="comment">//计算周长的函数</span></span><br><span class="line">        virtual <span class="type">double</span> <span class="title function_">getlength</span><span class="params">()</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//初始化边长的函数</span></span><br><span class="line">        virtual <span class="type">void</span> <span class="title function_">init</span><span class="params">(<span class="type">double</span> side_length)</span>=<span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h4 id="创建插件"><a href="#创建插件" class="headerlink" title="创建插件"></a>创建插件</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DBX_PLUGINS_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBX_PLUGINS_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo03_plugin/dbx_base.h&quot;</span></span></span><br><span class="line">namespace dbx_plugins_ns&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//三边</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SanBian</span>:</span>public dbx_base_ns::Dbx_Base&#123;</span><br><span class="line">        private:</span><br><span class="line">            <span class="type">double</span> side_length;</span><br><span class="line">        public:</span><br><span class="line">            SanBian()&#123;</span><br><span class="line">                side_length = <span class="number">0.0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">void</span> <span class="title function_">init</span><span class="params">(<span class="type">double</span> side_length)</span>&#123;</span><br><span class="line">                this-&gt;side_length = side_length;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">double</span> <span class="title function_">getlength</span><span class="params">()</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> side_length*<span class="number">3</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//四边</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SiBian</span>:</span>public dbx_base_ns::Dbx_Base&#123;</span><br><span class="line">        private:</span><br><span class="line">            <span class="type">double</span> side_length;</span><br><span class="line">        public:</span><br><span class="line">            SiBian()&#123;</span><br><span class="line">                side_length = <span class="number">0.0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">void</span> <span class="title function_">init</span><span class="params">(<span class="type">double</span> side_length)</span>&#123;</span><br><span class="line">                this-&gt;side_length = side_length;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">double</span> <span class="title function_">getlength</span><span class="params">()</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> side_length*<span class="number">4</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h4 id="注册插件"><a href="#注册插件" class="headerlink" title="注册插件"></a>注册插件</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pluginlib/class_list_macros.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo03_plugin/dbx_base.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo03_plugin/dbx_plugins.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数1子类 参数2父类</span></span><br><span class="line"><span class="built_in">PLUGINLIB_EXPORT_CLASS</span>(dbx_plugins_ns::SanBian,dbx_base_ns::Dbx_Base)</span><br><span class="line"><span class="built_in">PLUGINLIB_EXPORT_CLASS</span>(dbx_plugins_ns::SiBian,dbx_base_ns::Dbx_Base)</span><br></pre></td></tr></table></figure><h4 id="编写xml文件"><a href="#编写xml文件" class="headerlink" title="编写xml文件"></a>编写xml文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">    需要定位动态连接库</span><br><span class="line">        library根标签下的path属性设置</span><br><span class="line">    声明子类与父类</span><br><span class="line">        library的子标签class声明</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;library path=&quot;lib/libplus&quot;&gt;</span><br><span class="line">    &lt;class type=&quot;dbx_plugins_ns::SanBian&quot; base_class_type=&quot;dbx_base_ns::Dbx_Base&quot;&gt;</span><br><span class="line">        &lt;description&gt; 这是正三边形插件&lt;/description&gt;</span><br><span class="line">    &lt;/class&gt;</span><br><span class="line">    &lt;class type=&quot;dbx_plugins_ns::SiBian&quot; base_class_type=&quot;dbx_base_ns::Dbx_Base&quot;&gt;</span><br><span class="line">        &lt;description&gt; 这是正四边形插件&lt;/description&gt;</span><br><span class="line">    &lt;/class&gt;</span><br><span class="line">&lt;/library&gt;</span><br></pre></td></tr></table></figure><h4 id="导出插件"><a href="#导出插件" class="headerlink" title="导出插件"></a>导出插件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;export&gt;</span><br><span class="line">  &lt;!-- Other tools can request additional information be placed here --&gt;</span><br><span class="line">  &lt;demo03_plugin plugin=&quot;$&#123;prefix&#125;/plus.xml&quot; /&gt;</span><br><span class="line">&lt;/export&gt;</span><br></pre></td></tr></table></figure><h4 id="调用插件"><a href="#调用插件" class="headerlink" title="调用插件"></a>调用插件</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pluginlib/class_loader.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo03_plugin/dbx_base.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    创建类加载器，根据需求加载相关插件</span></span><br><span class="line"><span class="comment">        1. 创建类加载器</span></span><br><span class="line"><span class="comment">        2.使用类加载器实例化某个插件对象</span></span><br><span class="line"><span class="comment">        3.使用插件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 创建类加载器</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="function">pluginlib::ClassLoader&lt;dbx_base_ns::Dbx_Base&gt; <span class="title">loader</span><span class="params">(<span class="string">&quot;demo03_plugin&quot;</span>,<span class="string">&quot;dbx_base_ns::Dbx_Base&quot;</span>)</span></span>;</span><br><span class="line">    <span class="comment">// 2.使用类加载器实例化某个插件对象</span></span><br><span class="line">    boost::shared_ptr&lt;dbx_base_ns::Dbx_Base&gt; san = loader.<span class="built_in">createInstance</span>(<span class="string">&quot;dbx_plugins_ns::SanBian&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.使用插件</span></span><br><span class="line">    san-&gt;<span class="built_in">init</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="type">double</span> length = san-&gt;<span class="built_in">getlength</span>();</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;三角形周长：%.2f&quot;</span>,length);</span><br><span class="line">    boost::shared_ptr&lt;dbx_base_ns::Dbx_Base&gt; si = loader.<span class="built_in">createInstance</span>(<span class="string">&quot;dbx_plugins_ns::SiBian&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.使用插件</span></span><br><span class="line">    si-&gt;<span class="built_in">init</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="type">double</span> length2 = si-&gt;<span class="built_in">getlength</span>();</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;四角形周长：%.2f&quot;</span>,length2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="nodelet"><a href="#nodelet" class="headerlink" title="nodelet"></a>nodelet</h2><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 启动nodelet manager(管理器) --&gt;</span><br><span class="line">    &lt;node pkg=&quot;nodelet&quot; type=&quot;nodelet&quot; args=&quot;manager&quot; name=&quot;dasun&quot; output=&quot;screen&quot; /&gt;</span><br><span class="line">    &lt;!-- 添加节点小王，参数100 --&gt;</span><br><span class="line">    &lt;node pkg=&quot;nodelet&quot; type=&quot;nodelet&quot; args=&quot;load nodelet_tutorial_math/Plus dasun&quot; name=&quot;xiaowang&quot; output=&quot;screen&quot; &gt;</span><br><span class="line">        &lt;param name=&quot;value&quot; value=&quot;100&quot; /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    &lt;!-- 添加节点二狗，参数-50，小王的输出作为二狗的输入 --&gt;</span><br><span class="line">    &lt;node pkg=&quot;nodelet&quot; type=&quot;nodelet&quot; args=&quot;load nodelet_tutorial_math/Plus dasun&quot; name=&quot;ergou&quot; output=&quot;screen&quot; &gt;</span><br><span class="line">        &lt;param name=&quot;value&quot; value=&quot;-50&quot; /&gt;</span><br><span class="line">        &lt;remap from=&quot;/ergou/in&quot; to=&quot;/xiaowang/out&quot; /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="创建插件类"><a href="#创建插件类" class="headerlink" title="创建插件类"></a>创建插件类</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;nodelet/nodelet.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pluginlib/class_list_macros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/Float64.h&quot;</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    需求：首先，需要订阅一个浮点数据；然后将订阅的数据与参数服务器的指定参数相加；最后将最终结果发布</span></span><br><span class="line"><span class="comment">    流程：</span></span><br><span class="line"><span class="comment">        1.先确定需要的变量：订阅对象，发布对象，存储参数的变量</span></span><br><span class="line"><span class="comment">        2.获取nodehandle</span></span><br><span class="line"><span class="comment">        3.通过nodehandle创建订阅对象和发布对象，解析参数</span></span><br><span class="line"><span class="comment">        4.订阅对象回调函数需要处理数据，并通过发布对象发布</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">namespace</span> my_nodelet &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">MyPlus</span>:<span class="keyword">public</span> nodelet::Nodelet &#123;</span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            ros::Publisher pub;</span><br><span class="line">            ros::Subscriber sub;</span><br><span class="line">            <span class="type">double</span> value;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="built_in">MyPlus</span>()&#123;</span><br><span class="line">                value = <span class="number">0.0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">onInit</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="built_in">ROS_INFO</span>(<span class="string">&quot;hello nodelet--------------------------------&quot;</span>);</span><br><span class="line">                <span class="comment">// 2.获取nodehandle 获取私有的</span></span><br><span class="line">                ros::NodeHandle nh = <span class="built_in">getPrivateNodeHandle</span>();</span><br><span class="line">                <span class="comment">// 3.通过nodehandle创建订阅对象和发布对象，解析参数</span></span><br><span class="line">                nh.<span class="built_in">getParam</span>(<span class="string">&quot;value&quot;</span>,value);</span><br><span class="line">                pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::Float64&gt;(<span class="string">&quot;out&quot;</span>,<span class="number">100</span>);<span class="comment">//话题名称 ：/节点名/in</span></span><br><span class="line">                sub = nh.<span class="built_in">subscribe</span>&lt;std_msgs::Float64&gt;(<span class="string">&quot;in&quot;</span>,<span class="number">100</span>,&amp;MyPlus::cb,<span class="keyword">this</span>);</span><br><span class="line">                <span class="comment">// 4.订阅对象回调函数需要处理数据，并通过发布对象发布</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 处理订阅的回调函数</span></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">cb</span><span class="params">(<span class="type">const</span> std_msgs::Float64::ConstPtr&amp; p)</span></span>&#123;</span><br><span class="line">                <span class="comment">//4-1解析订阅的数据</span></span><br><span class="line">                <span class="type">double</span> in = p-&gt;data;</span><br><span class="line">                <span class="comment">// 4-2和参数相加</span></span><br><span class="line">                <span class="type">double</span> out = in+value;</span><br><span class="line">                <span class="comment">// 4-3发布</span></span><br><span class="line">                std_msgs::Float64 out_msg;</span><br><span class="line">                out_msg.data = out;</span><br><span class="line">                pub.<span class="built_in">publish</span>(out_msg);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PLUGINLIB_EXPORT_CLASS</span>(my_nodelet::MyPlus,nodelet::Nodelet)</span><br></pre></td></tr></table></figure><h4 id="配置xml文件"><a href="#配置xml文件" class="headerlink" title="配置xml文件"></a>配置xml文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;library path=&quot;lib/libmyplus&quot; &gt;</span><br><span class="line">    &lt;class type=&quot;my_nodelet::MyPlus&quot; base_class_type=&quot;nodelet::Nodelet&quot; name=&quot;demo04_nodelet/MyPlus&quot;&gt;</span><br><span class="line">        &lt;description&gt;自定义插件&lt;/description&gt;</span><br><span class="line">    &lt;/class&gt;</span><br><span class="line">&lt;/library&gt;</span><br></pre></td></tr></table></figure><h4 id="导出插件-1"><a href="#导出插件-1" class="headerlink" title="导出插件"></a>导出插件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;export&gt;</span><br><span class="line">    &lt;!-- Other tools can request additional information be placed here --&gt;</span><br><span class="line">    &lt;!-- 标签名基类的包名 --&gt;</span><br><span class="line">    &lt;nodelet plugin=&quot;$&#123;prefix&#125;/myplus.xml&quot; /&gt;</span><br><span class="line">  &lt;/export&gt;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ros概述与环境搭建&quot;&gt;&lt;a href=&quot;#ros概述与环境搭建&quot; class=&quot;headerlink&quot; title=&quot;ros概述与环境搭建&quot;&gt;&lt;/a&gt;ros概述与环境搭建&lt;/h1&gt;&lt;div class=&quot;story post-story&quot;&gt;&lt;h2 id=&quot;hel</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>更新日志</title>
    <link href="http://example.com/2022/07/26/%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97/"/>
    <id>http://example.com/2022/07/26/%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97/</id>
    <published>2022-07-26T15:43:08.000Z</published>
    <updated>2022-07-29T14:34:55.883Z</updated>
    
    <content type="html"><![CDATA[<h1 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h1><h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><p><em><strong>hello,欢迎来到迷途的小窝，本站将不定期更新个人生活及学习博客</strong></em></p><h3 id="建站进度"><a href="#建站进度" class="headerlink" title="建站进度"></a>建站进度</h3><p>目前仅搭建博客版块，后续更新其他板块</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;日志&quot;&gt;&lt;a href=&quot;#日志&quot; class=&quot;headerlink&quot; title=&quot;日志&quot;&gt;&lt;/a&gt;日志&lt;/h1&gt;&lt;h3 id=&quot;关于&quot;&gt;&lt;a href=&quot;#关于&quot; class=&quot;headerlink&quot; title=&quot;关于&quot;&gt;&lt;/a&gt;关于&lt;/h3&gt;&lt;p&gt;&lt;em</summary>
      
    
    
    
    
    <category term="迷途" scheme="http://example.com/tags/%E8%BF%B7%E9%80%94/"/>
    
  </entry>
  
  <entry>
    <title>测试</title>
    <link href="http://example.com/2022/07/26/%E6%B5%8B%E8%AF%95/"/>
    <id>http://example.com/2022/07/26/%E6%B5%8B%E8%AF%95/</id>
    <published>2022-07-26T15:43:08.000Z</published>
    <updated>2022-07-29T14:26:03.849Z</updated>
    
    <content type="html"><![CDATA[<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;测试&quot;&gt;&lt;a href=&quot;#测试&quot; class=&quot;headerlink&quot; title=&quot;测试&quot;&gt;&lt;/a&gt;测试&lt;/h1&gt;
</summary>
      
    
    
    
    
  </entry>
  
</feed>
